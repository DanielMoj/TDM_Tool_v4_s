[
  {
    "type": "call",
    "fun": "if",
    "args": [
      {
        "type": "call",
        "fun": "file.exists",
        "args": [
          {
            "type": "literal",
            "value": "R/parallel_utils.R"
          }
        ]
      },
      {
        "type": "call",
        "fun": "{",
        "args": [
          {
            "type": "call",
            "fun": "source",
            "args": [
              {
                "type": "literal",
                "value": "parallel_utils.R"
              }
            ]
          }
        ]
      }
    ]
  },
  {
    "type": "call",
    "fun": "if",
    "args": [
      {
        "type": "call",
        "fun": "file.exists",
        "args": [
          {
            "type": "literal",
            "value": "R/async_fits.R"
          }
        ]
      },
      {
        "type": "call",
        "fun": "{",
        "args": [
          {
            "type": "call",
            "fun": "source",
            "args": [
              {
                "type": "literal",
                "value": "async_fits.R"
              }
            ]
          }
        ]
      }
    ]
  },
  {
    "type": "call",
    "fun": "if",
    "args": [
      {
        "type": "call",
        "fun": "file.exists",
        "args": [
          {
            "type": "literal",
            "value": "R/job_queue.R"
          }
        ]
      },
      {
        "type": "call",
        "fun": "{",
        "args": [
          {
            "type": "call",
            "fun": "source",
            "args": [
              {
                "type": "literal",
                "value": "job_queue.R"
              }
            ]
          }
        ]
      }
    ]
  },
  {
    "type": "call",
    "fun": "if",
    "args": [
      {
        "type": "call",
        "fun": "file.exists",
        "args": [
          {
            "type": "literal",
            "value": "config/optimization_config.yaml"
          }
        ]
      },
      {
        "type": "call",
        "fun": "{",
        "args": [
          {
            "type": "call",
            "fun": "<-",
            "args": [
              {
                "type": "name",
                "value": "optim_config"
              },
              {
                "type": "call",
                "fun": ["::", "yaml", "read_yaml"],
                "args": [
                  {
                    "type": "literal",
                    "value": "config/optimization_config.yaml"
                  }
                ]
              }
            ]
          }
        ]
      },
      {
        "type": "call",
        "fun": "{",
        "args": [
          {
            "type": "call",
            "fun": "<-",
            "args": [
              {
                "type": "name",
                "value": "optim_config"
              },
              {
                "type": "call",
                "fun": "list",
                "args": []
              }
            ]
          }
        ]
      }
    ]
  },
  {
    "type": "call",
    "fun": "<-",
    "args": [
      {
        "type": "name",
        "value": "process_draws_parallel"
      },
      {
        "type": "call",
        "fun": "function",
        "args": [
          {
            "type": "pairlist",
            "value": ["", "", "NULL", "NULL"]
          },
          {
            "type": "call",
            "fun": "{",
            "args": [
              {
                "type": "call",
                "fun": "if",
                "args": [
                  {
                    "type": "call",
                    "fun": "is.null",
                    "args": [
                      {
                        "type": "name",
                        "value": "n_cores"
                      }
                    ]
                  },
                  {
                    "type": "call",
                    "fun": "{",
                    "args": [
                      {
                        "type": "call",
                        "fun": "<-",
                        "args": [
                          {
                            "type": "name",
                            "value": "n_cores"
                          },
                          {
                            "type": "call",
                            "fun": "get_optimal_workers",
                            "args": {
                              "task_type": {
                                "type": "literal",
                                "value": "cpu"
                              }
                            }
                          }
                        ]
                      }
                    ]
                  }
                ]
              },
              {
                "type": "call",
                "fun": "<-",
                "args": [
                  {
                    "type": "name",
                    "value": "n_draws"
                  },
                  {
                    "type": "call",
                    "fun": "nrow",
                    "args": [
                      {
                        "type": "name",
                        "value": "draws"
                      }
                    ]
                  }
                ]
              },
              {
                "type": "call",
                "fun": "if",
                "args": [
                  {
                    "type": "call",
                    "fun": "||",
                    "args": [
                      {
                        "type": "call",
                        "fun": "<",
                        "args": [
                          {
                            "type": "name",
                            "value": "n_draws"
                          },
                          {
                            "type": "literal",
                            "value": 50
                          }
                        ]
                      },
                      {
                        "type": "call",
                        "fun": "==",
                        "args": [
                          {
                            "type": "name",
                            "value": "n_cores"
                          },
                          {
                            "type": "literal",
                            "value": 1
                          }
                        ]
                      }
                    ]
                  },
                  {
                    "type": "call",
                    "fun": "{",
                    "args": [
                      {
                        "type": "call",
                        "fun": "return",
                        "args": [
                          {
                            "type": "call",
                            "fun": "lapply",
                            "args": [
                              {
                                "type": "call",
                                "fun": ":",
                                "args": [
                                  {
                                    "type": "literal",
                                    "value": 1
                                  },
                                  {
                                    "type": "name",
                                    "value": "n_draws"
                                  }
                                ]
                              },
                              {
                                "type": "call",
                                "fun": "function",
                                "args": [
                                  {
                                    "type": "pairlist",
                                    "value": ""
                                  },
                                  {
                                    "type": "call",
                                    "fun": "fun",
                                    "args": [
                                      {
                                        "type": "call",
                                        "fun": "[",
                                        "args": [
                                          {
                                            "type": "name",
                                            "value": "draws"
                                          },
                                          {
                                            "type": "name",
                                            "value": "i"
                                          },
                                          {
                                            "type": "name",
                                            "value": ""
                                          }
                                        ]
                                      }
                                    ]
                                  },
                                  {
                                    "type": "NULL",
                                    "value": []
                                  }
                                ]
                              }
                            ]
                          }
                        ]
                      }
                    ]
                  }
                ]
              },
              {
                "type": "call",
                "fun": "<-",
                "args": [
                  {
                    "type": "name",
                    "value": "chunks"
                  },
                  {
                    "type": "call",
                    "fun": "create_chunks",
                    "args": {
                      "1": {
                        "type": "name",
                        "value": "n_draws"
                      },
                      "2": {
                        "type": "name",
                        "value": "n_cores"
                      },
                      "min_chunk_size": {
                        "type": "call",
                        "fun": "%||%",
                        "args": [
                          {
                            "type": "name",
                            "value": "chunk_size"
                          },
                          {
                            "type": "literal",
                            "value": 10
                          }
                        ]
                      }
                    }
                  }
                ]
              },
              {
                "type": "call",
                "fun": "if",
                "args": [
                  {
                    "type": "call",
                    "fun": "==",
                    "args": [
                      {
                        "type": "call",
                        "fun": "$",
                        "args": [
                          {
                            "type": "name",
                            "value": ".Platform"
                          },
                          {
                            "type": "name",
                            "value": "OS.type"
                          }
                        ]
                      },
                      {
                        "type": "literal",
                        "value": "unix"
                      }
                    ]
                  },
                  {
                    "type": "call",
                    "fun": "{",
                    "args": [
                      {
                        "type": "call",
                        "fun": "<-",
                        "args": [
                          {
                            "type": "name",
                            "value": "results"
                          },
                          {
                            "type": "call",
                            "fun": ["::", "parallel", "mclapply"],
                            "args": {
                              "1": {
                                "type": "name",
                                "value": "chunks"
                              },
                              "2": {
                                "type": "call",
                                "fun": "function",
                                "args": [
                                  {
                                    "type": "pairlist",
                                    "value": ""
                                  },
                                  {
                                    "type": "call",
                                    "fun": "{",
                                    "args": [
                                      {
                                        "type": "call",
                                        "fun": "lapply",
                                        "args": [
                                          {
                                            "type": "name",
                                            "value": "idx"
                                          },
                                          {
                                            "type": "call",
                                            "fun": "function",
                                            "args": [
                                              {
                                                "type": "pairlist",
                                                "value": ""
                                              },
                                              {
                                                "type": "call",
                                                "fun": "fun",
                                                "args": [
                                                  {
                                                    "type": "call",
                                                    "fun": "[",
                                                    "args": [
                                                      {
                                                        "type": "name",
                                                        "value": "draws"
                                                      },
                                                      {
                                                        "type": "name",
                                                        "value": "i"
                                                      },
                                                      {
                                                        "type": "name",
                                                        "value": ""
                                                      }
                                                    ]
                                                  }
                                                ]
                                              },
                                              {
                                                "type": "NULL",
                                                "value": []
                                              }
                                            ]
                                          }
                                        ]
                                      }
                                    ]
                                  },
                                  {
                                    "type": "NULL",
                                    "value": []
                                  }
                                ]
                              },
                              "mc.cores": {
                                "type": "name",
                                "value": "n_cores"
                              }
                            }
                          }
                        ]
                      }
                    ]
                  },
                  {
                    "type": "call",
                    "fun": "{",
                    "args": [
                      {
                        "type": "call",
                        "fun": "<-",
                        "args": [
                          {
                            "type": "name",
                            "value": "cl"
                          },
                          {
                            "type": "call",
                            "fun": ["::", "parallel", "makeCluster"],
                            "args": [
                              {
                                "type": "name",
                                "value": "n_cores"
                              }
                            ]
                          }
                        ]
                      },
                      {
                        "type": "call",
                        "fun": "on.exit",
                        "args": [
                          {
                            "type": "call",
                            "fun": ["::", "parallel", "stopCluster"],
                            "args": [
                              {
                                "type": "name",
                                "value": "cl"
                              }
                            ]
                          }
                        ]
                      },
                      {
                        "type": "call",
                        "fun": ["::", "parallel", "clusterExport"],
                        "args": {
                          "1": {
                            "type": "name",
                            "value": "cl"
                          },
                          "2": {
                            "type": "call",
                            "fun": "c",
                            "args": [
                              {
                                "type": "literal",
                                "value": "draws"
                              },
                              {
                                "type": "literal",
                                "value": "fun"
                              }
                            ]
                          },
                          "envir": {
                            "type": "call",
                            "fun": "environment",
                            "args": []
                          }
                        }
                      },
                      {
                        "type": "call",
                        "fun": "<-",
                        "args": [
                          {
                            "type": "name",
                            "value": "results"
                          },
                          {
                            "type": "call",
                            "fun": ["::", "parallel", "parLapply"],
                            "args": [
                              {
                                "type": "name",
                                "value": "cl"
                              },
                              {
                                "type": "name",
                                "value": "chunks"
                              },
                              {
                                "type": "call",
                                "fun": "function",
                                "args": [
                                  {
                                    "type": "pairlist",
                                    "value": ""
                                  },
                                  {
                                    "type": "call",
                                    "fun": "{",
                                    "args": [
                                      {
                                        "type": "call",
                                        "fun": "lapply",
                                        "args": [
                                          {
                                            "type": "name",
                                            "value": "idx"
                                          },
                                          {
                                            "type": "call",
                                            "fun": "function",
                                            "args": [
                                              {
                                                "type": "pairlist",
                                                "value": ""
                                              },
                                              {
                                                "type": "call",
                                                "fun": "fun",
                                                "args": [
                                                  {
                                                    "type": "call",
                                                    "fun": "[",
                                                    "args": [
                                                      {
                                                        "type": "name",
                                                        "value": "draws"
                                                      },
                                                      {
                                                        "type": "name",
                                                        "value": "i"
                                                      },
                                                      {
                                                        "type": "name",
                                                        "value": ""
                                                      }
                                                    ]
                                                  }
                                                ]
                                              },
                                              {
                                                "type": "NULL",
                                                "value": []
                                              }
                                            ]
                                          }
                                        ]
                                      }
                                    ]
                                  },
                                  {
                                    "type": "NULL",
                                    "value": []
                                  }
                                ]
                              }
                            ]
                          }
                        ]
                      }
                    ]
                  }
                ]
              },
              {
                "type": "call",
                "fun": "unlist",
                "args": {
                  "1": {
                    "type": "name",
                    "value": "results"
                  },
                  "recursive": {
                    "type": "literal",
                    "value": false
                  }
                }
              }
            ]
          },
          {
            "type": "NULL",
            "value": []
          }
        ]
      }
    ]
  },
  {
    "type": "call",
    "fun": "<-",
    "args": [
      {
        "type": "name",
        "value": "run_fit_stan_hmc_parallel"
      },
      {
        "type": "call",
        "fun": "function",
        "args": [
          {
            "type": "pairlist",
            "value": ["", "", "NULL", "NULL", "NULL", "NULL", "sync", "FALSE", "5", ""]
          },
          {
            "type": "call",
            "fun": "{",
            "args": [
              {
                "type": "call",
                "fun": "<-",
                "args": [
                  {
                    "type": "name",
                    "value": "chains"
                  },
                  {
                    "type": "call",
                    "fun": "%||%",
                    "args": [
                      {
                        "type": "call",
                        "fun": "%||%",
                        "args": [
                          {
                            "type": "name",
                            "value": "chains"
                          },
                          {
                            "type": "call",
                            "fun": "$",
                            "args": [
                              {
                                "type": "call",
                                "fun": "$",
                                "args": [
                                  {
                                    "type": "name",
                                    "value": "optim_config"
                                  },
                                  {
                                    "type": "name",
                                    "value": "stan"
                                  }
                                ]
                              },
                              {
                                "type": "name",
                                "value": "chains"
                              }
                            ]
                          }
                        ]
                      },
                      {
                        "type": "literal",
                        "value": 4
                      }
                    ]
                  }
                ]
              },
              {
                "type": "call",
                "fun": "<-",
                "args": [
                  {
                    "type": "name",
                    "value": "iter_warmup"
                  },
                  {
                    "type": "call",
                    "fun": "%||%",
                    "args": [
                      {
                        "type": "call",
                        "fun": "%||%",
                        "args": [
                          {
                            "type": "name",
                            "value": "iter_warmup"
                          },
                          {
                            "type": "call",
                            "fun": "$",
                            "args": [
                              {
                                "type": "call",
                                "fun": "$",
                                "args": [
                                  {
                                    "type": "name",
                                    "value": "optim_config"
                                  },
                                  {
                                    "type": "name",
                                    "value": "stan"
                                  }
                                ]
                              },
                              {
                                "type": "name",
                                "value": "iter_warmup"
                              }
                            ]
                          }
                        ]
                      },
                      {
                        "type": "literal",
                        "value": 1000
                      }
                    ]
                  }
                ]
              },
              {
                "type": "call",
                "fun": "<-",
                "args": [
                  {
                    "type": "name",
                    "value": "iter_sampling"
                  },
                  {
                    "type": "call",
                    "fun": "%||%",
                    "args": [
                      {
                        "type": "call",
                        "fun": "%||%",
                        "args": [
                          {
                            "type": "name",
                            "value": "iter_sampling"
                          },
                          {
                            "type": "call",
                            "fun": "$",
                            "args": [
                              {
                                "type": "call",
                                "fun": "$",
                                "args": [
                                  {
                                    "type": "name",
                                    "value": "optim_config"
                                  },
                                  {
                                    "type": "name",
                                    "value": "stan"
                                  }
                                ]
                              },
                              {
                                "type": "name",
                                "value": "iter_sampling"
                              }
                            ]
                          }
                        ]
                      },
                      {
                        "type": "literal",
                        "value": 1000
                      }
                    ]
                  }
                ]
              },
              {
                "type": "call",
                "fun": "<-",
                "args": [
                  {
                    "type": "name",
                    "value": "parallel_chains"
                  },
                  {
                    "type": "call",
                    "fun": "min",
                    "args": [
                      {
                        "type": "name",
                        "value": "chains"
                      },
                      {
                        "type": "call",
                        "fun": "get_optimal_workers",
                        "args": {
                          "task_type": {
                            "type": "literal",
                            "value": "cpu"
                          }
                        }
                      }
                    ]
                  }
                ]
              },
              {
                "type": "call",
                "fun": "if",
                "args": [
                  {
                    "type": "name",
                    "value": "use_job_queue"
                  },
                  {
                    "type": "call",
                    "fun": "{",
                    "args": [
                      {
                        "type": "call",
                        "fun": "<-",
                        "args": [
                          {
                            "type": "name",
                            "value": "queue"
                          },
                          {
                            "type": "call",
                            "fun": "get_job_queue",
                            "args": []
                          }
                        ]
                      },
                      {
                        "type": "call",
                        "fun": "<-",
                        "args": [
                          {
                            "type": "name",
                            "value": "job_id"
                          },
                          {
                            "type": "call",
                            "fun": ["$", "queue", "submit"],
                            "args": {
                              "type": {
                                "type": "literal",
                                "value": "stan_fit"
                              },
                              "spec": {
                                "type": "call",
                                "fun": "list",
                                "args": {
                                  "model_code": {
                                    "type": "name",
                                    "value": "model_code"
                                  },
                                  "data": {
                                    "type": "name",
                                    "value": "data"
                                  },
                                  "params": {
                                    "type": "name",
                                    "value": "params"
                                  },
                                  "chains": {
                                    "type": "name",
                                    "value": "chains"
                                  },
                                  "iter_warmup": {
                                    "type": "name",
                                    "value": "iter_warmup"
                                  },
                                  "iter_sampling": {
                                    "type": "name",
                                    "value": "iter_sampling"
                                  },
                                  "parallel_chains": {
                                    "type": "name",
                                    "value": "parallel_chains"
                                  },
                                  "8": {
                                    "type": "name",
                                    "value": "..."
                                  }
                                }
                              },
                              "priority": {
                                "type": "name",
                                "value": "priority"
                              },
                              "callback": {
                                "type": "call",
                                "fun": "function",
                                "args": [
                                  {
                                    "type": "pairlist",
                                    "value": ""
                                  },
                                  {
                                    "type": "call",
                                    "fun": "{",
                                    "args": [
                                      {
                                        "type": "call",
                                        "fun": "message",
                                        "args": [
                                          {
                                            "type": "literal",
                                            "value": "Stan fit completed successfully"
                                          }
                                        ]
                                      }
                                    ]
                                  },
                                  {
                                    "type": "NULL",
                                    "value": []
                                  }
                                ]
                              },
                              "error_callback": {
                                "type": "call",
                                "fun": "function",
                                "args": [
                                  {
                                    "type": "pairlist",
                                    "value": ""
                                  },
                                  {
                                    "type": "call",
                                    "fun": "{",
                                    "args": [
                                      {
                                        "type": "call",
                                        "fun": "warning",
                                        "args": [
                                          {
                                            "type": "literal",
                                            "value": "Stan fit failed: "
                                          },
                                          {
                                            "type": "call",
                                            "fun": "$",
                                            "args": [
                                              {
                                                "type": "name",
                                                "value": "error"
                                              },
                                              {
                                                "type": "name",
                                                "value": "message"
                                              }
                                            ]
                                          }
                                        ]
                                      }
                                    ]
                                  },
                                  {
                                    "type": "NULL",
                                    "value": []
                                  }
                                ]
                              }
                            }
                          }
                        ]
                      },
                      {
                        "type": "call",
                        "fun": "return",
                        "args": [
                          {
                            "type": "call",
                            "fun": "list",
                            "args": {
                              "job_id": {
                                "type": "name",
                                "value": "job_id"
                              },
                              "queue": {
                                "type": "name",
                                "value": "queue"
                              }
                            }
                          }
                        ]
                      }
                    ]
                  }
                ]
              },
              {
                "type": "call",
                "fun": "if",
                "args": [
                  {
                    "type": "call",
                    "fun": "==",
                    "args": [
                      {
                        "type": "name",
                        "value": "backend"
                      },
                      {
                        "type": "literal",
                        "value": "async"
                      }
                    ]
                  },
                  {
                    "type": "call",
                    "fun": "{",
                    "args": [
                      {
                        "type": "call",
                        "fun": "return",
                        "args": [
                          {
                            "type": "call",
                            "fun": "fit_stan_async",
                            "args": {
                              "stan_code": {
                                "type": "name",
                                "value": "model_code"
                              },
                              "data": {
                                "type": "name",
                                "value": "data"
                              },
                              "params": {
                                "type": "name",
                                "value": "params"
                              },
                              "chains": {
                                "type": "name",
                                "value": "chains"
                              },
                              "iter_warmup": {
                                "type": "name",
                                "value": "iter_warmup"
                              },
                              "iter_sampling": {
                                "type": "name",
                                "value": "iter_sampling"
                              },
                              "parallel_chains": {
                                "type": "name",
                                "value": "parallel_chains"
                              },
                              "8": {
                                "type": "name",
                                "value": "..."
                              }
                            }
                          }
                        ]
                      }
                    ]
                  }
                ]
              },
              {
                "type": "call",
                "fun": "if",
                "args": [
                  {
                    "type": "call",
                    "fun": "!",
                    "args": [
                      {
                        "type": "call",
                        "fun": "requireNamespace",
                        "args": {
                          "1": {
                            "type": "literal",
                            "value": "cmdstanr"
                          },
                          "quietly": {
                            "type": "literal",
                            "value": true
                          }
                        }
                      }
                    ]
                  },
                  {
                    "type": "call",
                    "fun": "{",
                    "args": [
                      {
                        "type": "call",
                        "fun": "stop",
                        "args": [
                          {
                            "type": "literal",
                            "value": "cmdstanr required for Stan fits"
                          }
                        ]
                      }
                    ]
                  }
                ]
              },
              {
                "type": "call",
                "fun": "if",
                "args": [
                  {
                    "type": "call",
                    "fun": "&&",
                    "args": [
                      {
                        "type": "call",
                        "fun": "is.character",
                        "args": [
                          {
                            "type": "name",
                            "value": "model_code"
                          }
                        ]
                      },
                      {
                        "type": "call",
                        "fun": "file.exists",
                        "args": [
                          {
                            "type": "name",
                            "value": "model_code"
                          }
                        ]
                      }
                    ]
                  },
                  {
                    "type": "call",
                    "fun": "{",
                    "args": [
                      {
                        "type": "call",
                        "fun": "<-",
                        "args": [
                          {
                            "type": "name",
                            "value": "model_file"
                          },
                          {
                            "type": "name",
                            "value": "model_code"
                          }
                        ]
                      }
                    ]
                  },
                  {
                    "type": "call",
                    "fun": "{",
                    "args": [
                      {
                        "type": "call",
                        "fun": "<-",
                        "args": [
                          {
                            "type": "name",
                            "value": "model_file"
                          },
                          {
                            "type": "call",
                            "fun": ["::", "cmdstanr", "write_stan_file"],
                            "args": [
                              {
                                "type": "name",
                                "value": "model_code"
                              }
                            ]
                          }
                        ]
                      }
                    ]
                  }
                ]
              },
              {
                "type": "call",
                "fun": "<-",
                "args": [
                  {
                    "type": "name",
                    "value": "model"
                  },
                  {
                    "type": "call",
                    "fun": ["::", "cmdstanr", "cmdstan_model"],
                    "args": [
                      {
                        "type": "name",
                        "value": "model_file"
                      }
                    ]
                  }
                ]
              },
              {
                "type": "call",
                "fun": "message",
                "args": [
                  {
                    "type": "call",
                    "fun": "sprintf",
                    "args": [
                      {
                        "type": "literal",
                        "value": "Running Stan with %d chains (%d in parallel)..."
                      },
                      {
                        "type": "name",
                        "value": "chains"
                      },
                      {
                        "type": "name",
                        "value": "parallel_chains"
                      }
                    ]
                  }
                ]
              },
              {
                "type": "call",
                "fun": "<-",
                "args": [
                  {
                    "type": "name",
                    "value": "fit"
                  },
                  {
                    "type": "call",
                    "fun": ["$", "model", "sample"],
                    "args": {
                      "data": {
                        "type": "name",
                        "value": "data"
                      },
                      "chains": {
                        "type": "name",
                        "value": "chains"
                      },
                      "parallel_chains": {
                        "type": "name",
                        "value": "parallel_chains"
                      },
                      "iter_warmup": {
                        "type": "name",
                        "value": "iter_warmup"
                      },
                      "iter_sampling": {
                        "type": "name",
                        "value": "iter_sampling"
                      },
                      "adapt_delta": {
                        "type": "call",
                        "fun": "%||%",
                        "args": [
                          {
                            "type": "call",
                            "fun": "$",
                            "args": [
                              {
                                "type": "call",
                                "fun": "$",
                                "args": [
                                  {
                                    "type": "name",
                                    "value": "optim_config"
                                  },
                                  {
                                    "type": "name",
                                    "value": "stan"
                                  }
                                ]
                              },
                              {
                                "type": "name",
                                "value": "adapt_delta"
                              }
                            ]
                          },
                          {
                            "type": "literal",
                            "value": 0.8
                          }
                        ]
                      },
                      "max_treedepth": {
                        "type": "call",
                        "fun": "%||%",
                        "args": [
                          {
                            "type": "call",
                            "fun": "$",
                            "args": [
                              {
                                "type": "call",
                                "fun": "$",
                                "args": [
                                  {
                                    "type": "name",
                                    "value": "optim_config"
                                  },
                                  {
                                    "type": "name",
                                    "value": "stan"
                                  }
                                ]
                              },
                              {
                                "type": "name",
                                "value": "max_treedepth"
                              }
                            ]
                          },
                          {
                            "type": "literal",
                            "value": 10
                          }
                        ]
                      },
                      "refresh": {
                        "type": "literal",
                        "value": 100
                      }
                    }
                  }
                ]
              },
              {
                "type": "call",
                "fun": "<-",
                "args": [
                  {
                    "type": "name",
                    "value": "draws"
                  },
                  {
                    "type": "call",
                    "fun": ["::", "posterior", "as_draws_df"],
                    "args": [
                      {
                        "type": "call",
                        "fun": ["$", "fit", "draws"],
                        "args": {
                          "variables": {
                            "type": "name",
                            "value": "params"
                          }
                        }
                      }
                    ]
                  }
                ]
              },
              {
                "type": "call",
                "fun": "if",
                "args": [
                  {
                    "type": "call",
                    "fun": "exists",
                    "args": [
                      {
                        "type": "literal",
                        "value": "calculate_diagnostics_parallel"
                      }
                    ]
                  },
                  {
                    "type": "call",
                    "fun": "{",
                    "args": [
                      {
                        "type": "call",
                        "fun": "<-",
                        "args": [
                          {
                            "type": "name",
                            "value": "diagnostics"
                          },
                          {
                            "type": "call",
                            "fun": "calculate_diagnostics_parallel",
                            "args": [
                              {
                                "type": "name",
                                "value": "draws"
                              }
                            ]
                          }
                        ]
                      }
                    ]
                  },
                  {
                    "type": "call",
                    "fun": "{",
                    "args": [
                      {
                        "type": "call",
                        "fun": "<-",
                        "args": [
                          {
                            "type": "name",
                            "value": "diagnostics"
                          },
                          {
                            "type": "call",
                            "fun": "list",
                            "args": {
                              "summary": {
                                "type": "call",
                                "fun": ["$", "fit", "summary"],
                                "args": []
                              },
                              "sampler_diagnostics": {
                                "type": "call",
                                "fun": ["$", "fit", "diagnostic_summary"],
                                "args": []
                              }
                            }
                          }
                        ]
                      }
                    ]
                  }
                ]
              },
              {
                "type": "call",
                "fun": "return",
                "args": [
                  {
                    "type": "call",
                    "fun": "list",
                    "args": {
                      "fit": {
                        "type": "name",
                        "value": "fit"
                      },
                      "draws": {
                        "type": "name",
                        "value": "draws"
                      },
                      "diagnostics": {
                        "type": "name",
                        "value": "diagnostics"
                      },
                      "parallel_chains_used": {
                        "type": "name",
                        "value": "parallel_chains"
                      }
                    }
                  }
                ]
              }
            ]
          },
          {
            "type": "NULL",
            "value": []
          }
        ]
      }
    ]
  },
  {
    "type": "call",
    "fun": "<-",
    "args": [
      {
        "type": "name",
        "value": "parallel_laplace"
      },
      {
        "type": "call",
        "fun": "function",
        "args": [
          {
            "type": "pairlist",
            "value": ["", "", "NULL"]
          },
          {
            "type": "call",
            "fun": "{",
            "args": [
              {
                "type": "call",
                "fun": "if",
                "args": [
                  {
                    "type": "call",
                    "fun": "is.null",
                    "args": [
                      {
                        "type": "name",
                        "value": "n_cores"
                      }
                    ]
                  },
                  {
                    "type": "call",
                    "fun": "{",
                    "args": [
                      {
                        "type": "call",
                        "fun": "<-",
                        "args": [
                          {
                            "type": "name",
                            "value": "n_cores"
                          },
                          {
                            "type": "call",
                            "fun": "get_optimal_workers",
                            "args": {
                              "task_type": {
                                "type": "literal",
                                "value": "cpu"
                              }
                            }
                          }
                        ]
                      }
                    ]
                  }
                ]
              },
              {
                "type": "call",
                "fun": "<-",
                "args": [
                  {
                    "type": "name",
                    "value": "n_starts"
                  },
                  {
                    "type": "call",
                    "fun": "length",
                    "args": [
                      {
                        "type": "name",
                        "value": "start_points"
                      }
                    ]
                  }
                ]
              },
              {
                "type": "call",
                "fun": "if",
                "args": [
                  {
                    "type": "call",
                    "fun": "==",
                    "args": [
                      {
                        "type": "call",
                        "fun": "$",
                        "args": [
                          {
                            "type": "name",
                            "value": ".Platform"
                          },
                          {
                            "type": "name",
                            "value": "OS.type"
                          }
                        ]
                      },
                      {
                        "type": "literal",
                        "value": "unix"
                      }
                    ]
                  },
                  {
                    "type": "call",
                    "fun": "{",
                    "args": [
                      {
                        "type": "call",
                        "fun": "<-",
                        "args": [
                          {
                            "type": "name",
                            "value": "results"
                          },
                          {
                            "type": "call",
                            "fun": ["::", "parallel", "mclapply"],
                            "args": {
                              "1": {
                                "type": "name",
                                "value": "start_points"
                              },
                              "2": {
                                "type": "call",
                                "fun": "function",
                                "args": [
                                  {
                                    "type": "pairlist",
                                    "value": ""
                                  },
                                  {
                                    "type": "call",
                                    "fun": "{",
                                    "args": [
                                      {
                                        "type": "call",
                                        "fun": "tryCatch",
                                        "args": {
                                          "1": {
                                            "type": "call",
                                            "fun": "{",
                                            "args": [
                                              {
                                                "type": "call",
                                                "fun": "<-",
                                                "args": [
                                                  {
                                                    "type": "name",
                                                    "value": "optim_result"
                                                  },
                                                  {
                                                    "type": "call",
                                                    "fun": "optim",
                                                    "args": {
                                                      "par": {
                                                        "type": "name",
                                                        "value": "start"
                                                      },
                                                      "fn": {
                                                        "type": "call",
                                                        "fun": "function",
                                                        "args": [
                                                          {
                                                            "type": "pairlist",
                                                            "value": ""
                                                          },
                                                          {
                                                            "type": "call",
                                                            "fun": "-",
                                                            "args": [
                                                              {
                                                                "type": "call",
                                                                "fun": "logpost",
                                                                "args": [
                                                                  {
                                                                    "type": "name",
                                                                    "value": "x"
                                                                  }
                                                                ]
                                                              }
                                                            ]
                                                          },
                                                          {
                                                            "type": "NULL",
                                                            "value": []
                                                          }
                                                        ]
                                                      },
                                                      "method": {
                                                        "type": "literal",
                                                        "value": "L-BFGS-B"
                                                      },
                                                      "hessian": {
                                                        "type": "literal",
                                                        "value": true
                                                      }
                                                    }
                                                  }
                                                ]
                                              },
                                              {
                                                "type": "call",
                                                "fun": "<-",
                                                "args": [
                                                  {
                                                    "type": "name",
                                                    "value": "mode"
                                                  },
                                                  {
                                                    "type": "call",
                                                    "fun": "$",
                                                    "args": [
                                                      {
                                                        "type": "name",
                                                        "value": "optim_result"
                                                      },
                                                      {
                                                        "type": "name",
                                                        "value": "par"
                                                      }
                                                    ]
                                                  }
                                                ]
                                              },
                                              {
                                                "type": "call",
                                                "fun": "<-",
                                                "args": [
                                                  {
                                                    "type": "name",
                                                    "value": "hessian"
                                                  },
                                                  {
                                                    "type": "call",
                                                    "fun": "$",
                                                    "args": [
                                                      {
                                                        "type": "name",
                                                        "value": "optim_result"
                                                      },
                                                      {
                                                        "type": "name",
                                                        "value": "hessian"
                                                      }
                                                    ]
                                                  }
                                                ]
                                              },
                                              {
                                                "type": "call",
                                                "fun": "<-",
                                                "args": [
                                                  {
                                                    "type": "name",
                                                    "value": "eigenvals"
                                                  },
                                                  {
                                                    "type": "call",
                                                    "fun": "$",
                                                    "args": [
                                                      {
                                                        "type": "call",
                                                        "fun": "eigen",
                                                        "args": [
                                                          {
                                                            "type": "name",
                                                            "value": "hessian"
                                                          }
                                                        ]
                                                      },
                                                      {
                                                        "type": "name",
                                                        "value": "values"
                                                      }
                                                    ]
                                                  }
                                                ]
                                              },
                                              {
                                                "type": "call",
                                                "fun": "if",
                                                "args": [
                                                  {
                                                    "type": "call",
                                                    "fun": "all",
                                                    "args": [
                                                      {
                                                        "type": "call",
                                                        "fun": ">",
                                                        "args": [
                                                          {
                                                            "type": "name",
                                                            "value": "eigenvals"
                                                          },
                                                          {
                                                            "type": "literal",
                                                            "value": 0
                                                          }
                                                        ]
                                                      }
                                                    ]
                                                  },
                                                  {
                                                    "type": "call",
                                                    "fun": "{",
                                                    "args": [
                                                      {
                                                        "type": "call",
                                                        "fun": "<-",
                                                        "args": [
                                                          {
                                                            "type": "name",
                                                            "value": "covariance"
                                                          },
                                                          {
                                                            "type": "call",
                                                            "fun": "solve",
                                                            "args": [
                                                              {
                                                                "type": "name",
                                                                "value": "hessian"
                                                              }
                                                            ]
                                                          }
                                                        ]
                                                      },
                                                      {
                                                        "type": "call",
                                                        "fun": "<-",
                                                        "args": [
                                                          {
                                                            "type": "name",
                                                            "value": "log_evidence"
                                                          },
                                                          {
                                                            "type": "call",
                                                            "fun": "+",
                                                            "args": [
                                                              {
                                                                "type": "call",
                                                                "fun": "-",
                                                                "args": [
                                                                  {
                                                                    "type": "call",
                                                                    "fun": "-",
                                                                    "args": [
                                                                      {
                                                                        "type": "call",
                                                                        "fun": "$",
                                                                        "args": [
                                                                          {
                                                                            "type": "name",
                                                                            "value": "optim_result"
                                                                          },
                                                                          {
                                                                            "type": "name",
                                                                            "value": "value"
                                                                          }
                                                                        ]
                                                                      }
                                                                    ]
                                                                  },
                                                                  {
                                                                    "type": "call",
                                                                    "fun": "*",
                                                                    "args": [
                                                                      {
                                                                        "type": "literal",
                                                                        "value": 0.5
                                                                      },
                                                                      {
                                                                        "type": "call",
                                                                        "fun": "log",
                                                                        "args": [
                                                                          {
                                                                            "type": "call",
                                                                            "fun": "det",
                                                                            "args": [
                                                                              {
                                                                                "type": "name",
                                                                                "value": "hessian"
                                                                              }
                                                                            ]
                                                                          }
                                                                        ]
                                                                      }
                                                                    ]
                                                                  }
                                                                ]
                                                              },
                                                              {
                                                                "type": "call",
                                                                "fun": "*",
                                                                "args": [
                                                                  {
                                                                    "type": "call",
                                                                    "fun": "*",
                                                                    "args": [
                                                                      {
                                                                        "type": "literal",
                                                                        "value": 0.5
                                                                      },
                                                                      {
                                                                        "type": "call",
                                                                        "fun": "length",
                                                                        "args": [
                                                                          {
                                                                            "type": "name",
                                                                            "value": "mode"
                                                                          }
                                                                        ]
                                                                      }
                                                                    ]
                                                                  },
                                                                  {
                                                                    "type": "call",
                                                                    "fun": "log",
                                                                    "args": [
                                                                      {
                                                                        "type": "call",
                                                                        "fun": "*",
                                                                        "args": [
                                                                          {
                                                                            "type": "literal",
                                                                            "value": 2
                                                                          },
                                                                          {
                                                                            "type": "name",
                                                                            "value": "pi"
                                                                          }
                                                                        ]
                                                                      }
                                                                    ]
                                                                  }
                                                                ]
                                                              }
                                                            ]
                                                          }
                                                        ]
                                                      }
                                                    ]
                                                  },
                                                  {
                                                    "type": "call",
                                                    "fun": "{",
                                                    "args": [
                                                      {
                                                        "type": "call",
                                                        "fun": "<-",
                                                        "args": [
                                                          {
                                                            "type": "name",
                                                            "value": "covariance"
                                                          },
                                                          {
                                                            "type": "NULL",
                                                            "value": []
                                                          }
                                                        ]
                                                      },
                                                      {
                                                        "type": "call",
                                                        "fun": "<-",
                                                        "args": [
                                                          {
                                                            "type": "name",
                                                            "value": "log_evidence"
                                                          },
                                                          {
                                                            "type": "call",
                                                            "fun": "-",
                                                            "args": [
                                                              {
                                                                "type": "literal",
                                                                "value": "Inf"
                                                              }
                                                            ]
                                                          }
                                                        ]
                                                      }
                                                    ]
                                                  }
                                                ]
                                              },
                                              {
                                                "type": "call",
                                                "fun": "list",
                                                "args": {
                                                  "mode": {
                                                    "type": "name",
                                                    "value": "mode"
                                                  },
                                                  "covariance": {
                                                    "type": "name",
                                                    "value": "covariance"
                                                  },
                                                  "log_evidence": {
                                                    "type": "name",
                                                    "value": "log_evidence"
                                                  },
                                                  "converged": {
                                                    "type": "call",
                                                    "fun": "==",
                                                    "args": [
                                                      {
                                                        "type": "call",
                                                        "fun": "$",
                                                        "args": [
                                                          {
                                                            "type": "name",
                                                            "value": "optim_result"
                                                          },
                                                          {
                                                            "type": "name",
                                                            "value": "convergence"
                                                          }
                                                        ]
                                                      },
                                                      {
                                                        "type": "literal",
                                                        "value": 0
                                                      }
                                                    ]
                                                  }
                                                }
                                              }
                                            ]
                                          },
                                          "error": {
                                            "type": "call",
                                            "fun": "function",
                                            "args": [
                                              {
                                                "type": "pairlist",
                                                "value": ""
                                              },
                                              {
                                                "type": "call",
                                                "fun": "{",
                                                "args": [
                                                  {
                                                    "type": "call",
                                                    "fun": "list",
                                                    "args": {
                                                      "converged": {
                                                        "type": "literal",
                                                        "value": false
                                                      },
                                                      "log_evidence": {
                                                        "type": "call",
                                                        "fun": "-",
                                                        "args": [
                                                          {
                                                            "type": "literal",
                                                            "value": "Inf"
                                                          }
                                                        ]
                                                      }
                                                    }
                                                  }
                                                ]
                                              },
                                              {
                                                "type": "NULL",
                                                "value": []
                                              }
                                            ]
                                          }
                                        }
                                      }
                                    ]
                                  },
                                  {
                                    "type": "NULL",
                                    "value": []
                                  }
                                ]
                              },
                              "mc.cores": {
                                "type": "name",
                                "value": "n_cores"
                              }
                            }
                          }
                        ]
                      }
                    ]
                  },
                  {
                    "type": "call",
                    "fun": "{",
                    "args": [
                      {
                        "type": "call",
                        "fun": "<-",
                        "args": [
                          {
                            "type": "name",
                            "value": "cl"
                          },
                          {
                            "type": "call",
                            "fun": ["::", "parallel", "makeCluster"],
                            "args": [
                              {
                                "type": "name",
                                "value": "n_cores"
                              }
                            ]
                          }
                        ]
                      },
                      {
                        "type": "call",
                        "fun": "on.exit",
                        "args": [
                          {
                            "type": "call",
                            "fun": ["::", "parallel", "stopCluster"],
                            "args": [
                              {
                                "type": "name",
                                "value": "cl"
                              }
                            ]
                          }
                        ]
                      },
                      {
                        "type": "call",
                        "fun": ["::", "parallel", "clusterExport"],
                        "args": {
                          "1": {
                            "type": "name",
                            "value": "cl"
                          },
                          "2": {
                            "type": "literal",
                            "value": "logpost"
                          },
                          "envir": {
                            "type": "call",
                            "fun": "environment",
                            "args": []
                          }
                        }
                      },
                      {
                        "type": "call",
                        "fun": "<-",
                        "args": [
                          {
                            "type": "name",
                            "value": "results"
                          },
                          {
                            "type": "call",
                            "fun": ["::", "parallel", "parLapply"],
                            "args": [
                              {
                                "type": "name",
                                "value": "cl"
                              },
                              {
                                "type": "name",
                                "value": "start_points"
                              },
                              {
                                "type": "call",
                                "fun": "function",
                                "args": [
                                  {
                                    "type": "pairlist",
                                    "value": ""
                                  },
                                  {
                                    "type": "call",
                                    "fun": "{",
                                    "args": [
                                      {
                                        "type": "call",
                                        "fun": "tryCatch",
                                        "args": {
                                          "1": {
                                            "type": "call",
                                            "fun": "{",
                                            "args": [
                                              {
                                                "type": "call",
                                                "fun": "<-",
                                                "args": [
                                                  {
                                                    "type": "name",
                                                    "value": "optim_result"
                                                  },
                                                  {
                                                    "type": "call",
                                                    "fun": "optim",
                                                    "args": {
                                                      "par": {
                                                        "type": "name",
                                                        "value": "start"
                                                      },
                                                      "fn": {
                                                        "type": "call",
                                                        "fun": "function",
                                                        "args": [
                                                          {
                                                            "type": "pairlist",
                                                            "value": ""
                                                          },
                                                          {
                                                            "type": "call",
                                                            "fun": "-",
                                                            "args": [
                                                              {
                                                                "type": "call",
                                                                "fun": "logpost",
                                                                "args": [
                                                                  {
                                                                    "type": "name",
                                                                    "value": "x"
                                                                  }
                                                                ]
                                                              }
                                                            ]
                                                          },
                                                          {
                                                            "type": "NULL",
                                                            "value": []
                                                          }
                                                        ]
                                                      },
                                                      "method": {
                                                        "type": "literal",
                                                        "value": "L-BFGS-B"
                                                      },
                                                      "hessian": {
                                                        "type": "literal",
                                                        "value": true
                                                      }
                                                    }
                                                  }
                                                ]
                                              },
                                              {
                                                "type": "call",
                                                "fun": "<-",
                                                "args": [
                                                  {
                                                    "type": "name",
                                                    "value": "mode"
                                                  },
                                                  {
                                                    "type": "call",
                                                    "fun": "$",
                                                    "args": [
                                                      {
                                                        "type": "name",
                                                        "value": "optim_result"
                                                      },
                                                      {
                                                        "type": "name",
                                                        "value": "par"
                                                      }
                                                    ]
                                                  }
                                                ]
                                              },
                                              {
                                                "type": "call",
                                                "fun": "<-",
                                                "args": [
                                                  {
                                                    "type": "name",
                                                    "value": "hessian"
                                                  },
                                                  {
                                                    "type": "call",
                                                    "fun": "$",
                                                    "args": [
                                                      {
                                                        "type": "name",
                                                        "value": "optim_result"
                                                      },
                                                      {
                                                        "type": "name",
                                                        "value": "hessian"
                                                      }
                                                    ]
                                                  }
                                                ]
                                              },
                                              {
                                                "type": "call",
                                                "fun": "<-",
                                                "args": [
                                                  {
                                                    "type": "name",
                                                    "value": "eigenvals"
                                                  },
                                                  {
                                                    "type": "call",
                                                    "fun": "$",
                                                    "args": [
                                                      {
                                                        "type": "call",
                                                        "fun": "eigen",
                                                        "args": [
                                                          {
                                                            "type": "name",
                                                            "value": "hessian"
                                                          }
                                                        ]
                                                      },
                                                      {
                                                        "type": "name",
                                                        "value": "values"
                                                      }
                                                    ]
                                                  }
                                                ]
                                              },
                                              {
                                                "type": "call",
                                                "fun": "if",
                                                "args": [
                                                  {
                                                    "type": "call",
                                                    "fun": "all",
                                                    "args": [
                                                      {
                                                        "type": "call",
                                                        "fun": ">",
                                                        "args": [
                                                          {
                                                            "type": "name",
                                                            "value": "eigenvals"
                                                          },
                                                          {
                                                            "type": "literal",
                                                            "value": 0
                                                          }
                                                        ]
                                                      }
                                                    ]
                                                  },
                                                  {
                                                    "type": "call",
                                                    "fun": "{",
                                                    "args": [
                                                      {
                                                        "type": "call",
                                                        "fun": "<-",
                                                        "args": [
                                                          {
                                                            "type": "name",
                                                            "value": "covariance"
                                                          },
                                                          {
                                                            "type": "call",
                                                            "fun": "solve",
                                                            "args": [
                                                              {
                                                                "type": "name",
                                                                "value": "hessian"
                                                              }
                                                            ]
                                                          }
                                                        ]
                                                      },
                                                      {
                                                        "type": "call",
                                                        "fun": "<-",
                                                        "args": [
                                                          {
                                                            "type": "name",
                                                            "value": "log_evidence"
                                                          },
                                                          {
                                                            "type": "call",
                                                            "fun": "+",
                                                            "args": [
                                                              {
                                                                "type": "call",
                                                                "fun": "-",
                                                                "args": [
                                                                  {
                                                                    "type": "call",
                                                                    "fun": "-",
                                                                    "args": [
                                                                      {
                                                                        "type": "call",
                                                                        "fun": "$",
                                                                        "args": [
                                                                          {
                                                                            "type": "name",
                                                                            "value": "optim_result"
                                                                          },
                                                                          {
                                                                            "type": "name",
                                                                            "value": "value"
                                                                          }
                                                                        ]
                                                                      }
                                                                    ]
                                                                  },
                                                                  {
                                                                    "type": "call",
                                                                    "fun": "*",
                                                                    "args": [
                                                                      {
                                                                        "type": "literal",
                                                                        "value": 0.5
                                                                      },
                                                                      {
                                                                        "type": "call",
                                                                        "fun": "log",
                                                                        "args": [
                                                                          {
                                                                            "type": "call",
                                                                            "fun": "det",
                                                                            "args": [
                                                                              {
                                                                                "type": "name",
                                                                                "value": "hessian"
                                                                              }
                                                                            ]
                                                                          }
                                                                        ]
                                                                      }
                                                                    ]
                                                                  }
                                                                ]
                                                              },
                                                              {
                                                                "type": "call",
                                                                "fun": "*",
                                                                "args": [
                                                                  {
                                                                    "type": "call",
                                                                    "fun": "*",
                                                                    "args": [
                                                                      {
                                                                        "type": "literal",
                                                                        "value": 0.5
                                                                      },
                                                                      {
                                                                        "type": "call",
                                                                        "fun": "length",
                                                                        "args": [
                                                                          {
                                                                            "type": "name",
                                                                            "value": "mode"
                                                                          }
                                                                        ]
                                                                      }
                                                                    ]
                                                                  },
                                                                  {
                                                                    "type": "call",
                                                                    "fun": "log",
                                                                    "args": [
                                                                      {
                                                                        "type": "call",
                                                                        "fun": "*",
                                                                        "args": [
                                                                          {
                                                                            "type": "literal",
                                                                            "value": 2
                                                                          },
                                                                          {
                                                                            "type": "name",
                                                                            "value": "pi"
                                                                          }
                                                                        ]
                                                                      }
                                                                    ]
                                                                  }
                                                                ]
                                                              }
                                                            ]
                                                          }
                                                        ]
                                                      }
                                                    ]
                                                  },
                                                  {
                                                    "type": "call",
                                                    "fun": "{",
                                                    "args": [
                                                      {
                                                        "type": "call",
                                                        "fun": "<-",
                                                        "args": [
                                                          {
                                                            "type": "name",
                                                            "value": "covariance"
                                                          },
                                                          {
                                                            "type": "NULL",
                                                            "value": []
                                                          }
                                                        ]
                                                      },
                                                      {
                                                        "type": "call",
                                                        "fun": "<-",
                                                        "args": [
                                                          {
                                                            "type": "name",
                                                            "value": "log_evidence"
                                                          },
                                                          {
                                                            "type": "call",
                                                            "fun": "-",
                                                            "args": [
                                                              {
                                                                "type": "literal",
                                                                "value": "Inf"
                                                              }
                                                            ]
                                                          }
                                                        ]
                                                      }
                                                    ]
                                                  }
                                                ]
                                              },
                                              {
                                                "type": "call",
                                                "fun": "list",
                                                "args": {
                                                  "mode": {
                                                    "type": "name",
                                                    "value": "mode"
                                                  },
                                                  "covariance": {
                                                    "type": "name",
                                                    "value": "covariance"
                                                  },
                                                  "log_evidence": {
                                                    "type": "name",
                                                    "value": "log_evidence"
                                                  },
                                                  "converged": {
                                                    "type": "call",
                                                    "fun": "==",
                                                    "args": [
                                                      {
                                                        "type": "call",
                                                        "fun": "$",
                                                        "args": [
                                                          {
                                                            "type": "name",
                                                            "value": "optim_result"
                                                          },
                                                          {
                                                            "type": "name",
                                                            "value": "convergence"
                                                          }
                                                        ]
                                                      },
                                                      {
                                                        "type": "literal",
                                                        "value": 0
                                                      }
                                                    ]
                                                  }
                                                }
                                              }
                                            ]
                                          },
                                          "error": {
                                            "type": "call",
                                            "fun": "function",
                                            "args": [
                                              {
                                                "type": "pairlist",
                                                "value": ""
                                              },
                                              {
                                                "type": "call",
                                                "fun": "{",
                                                "args": [
                                                  {
                                                    "type": "call",
                                                    "fun": "list",
                                                    "args": {
                                                      "converged": {
                                                        "type": "literal",
                                                        "value": false
                                                      },
                                                      "log_evidence": {
                                                        "type": "call",
                                                        "fun": "-",
                                                        "args": [
                                                          {
                                                            "type": "literal",
                                                            "value": "Inf"
                                                          }
                                                        ]
                                                      }
                                                    }
                                                  }
                                                ]
                                              },
                                              {
                                                "type": "NULL",
                                                "value": []
                                              }
                                            ]
                                          }
                                        }
                                      }
                                    ]
                                  },
                                  {
                                    "type": "NULL",
                                    "value": []
                                  }
                                ]
                              }
                            ]
                          }
                        ]
                      }
                    ]
                  }
                ]
              },
              {
                "type": "call",
                "fun": "<-",
                "args": [
                  {
                    "type": "name",
                    "value": "log_evidences"
                  },
                  {
                    "type": "call",
                    "fun": "sapply",
                    "args": [
                      {
                        "type": "name",
                        "value": "results"
                      },
                      {
                        "type": "call",
                        "fun": "function",
                        "args": [
                          {
                            "type": "pairlist",
                            "value": ""
                          },
                          {
                            "type": "call",
                            "fun": "$",
                            "args": [
                              {
                                "type": "name",
                                "value": "r"
                              },
                              {
                                "type": "name",
                                "value": "log_evidence"
                              }
                            ]
                          },
                          {
                            "type": "NULL",
                            "value": []
                          }
                        ]
                      }
                    ]
                  }
                ]
              },
              {
                "type": "call",
                "fun": "<-",
                "args": [
                  {
                    "type": "name",
                    "value": "best_idx"
                  },
                  {
                    "type": "call",
                    "fun": "which.max",
                    "args": [
                      {
                        "type": "name",
                        "value": "log_evidences"
                      }
                    ]
                  }
                ]
              },
              {
                "type": "call",
                "fun": "return",
                "args": [
                  {
                    "type": "call",
                    "fun": "[[",
                    "args": [
                      {
                        "type": "name",
                        "value": "results"
                      },
                      {
                        "type": "name",
                        "value": "best_idx"
                      }
                    ]
                  }
                ]
              }
            ]
          },
          {
            "type": "NULL",
            "value": []
          }
        ]
      }
    ]
  },
  {
    "type": "call",
    "fun": "<-",
    "args": [
      {
        "type": "name",
        "value": "generate_ppc_parallel_bayes"
      },
      {
        "type": "call",
        "fun": "function",
        "args": [
          {
            "type": "pairlist",
            "value": ["", "100", "NULL", "NULL"]
          },
          {
            "type": "call",
            "fun": "{",
            "args": [
              {
                "type": "call",
                "fun": "if",
                "args": [
                  {
                    "type": "call",
                    "fun": "is.null",
                    "args": [
                      {
                        "type": "name",
                        "value": "n_cores"
                      }
                    ]
                  },
                  {
                    "type": "call",
                    "fun": "{",
                    "args": [
                      {
                        "type": "call",
                        "fun": "<-",
                        "args": [
                          {
                            "type": "name",
                            "value": "n_cores"
                          },
                          {
                            "type": "call",
                            "fun": "get_optimal_workers",
                            "args": {
                              "task_type": {
                                "type": "literal",
                                "value": "cpu"
                              }
                            }
                          }
                        ]
                      }
                    ]
                  }
                ]
              },
              {
                "type": "call",
                "fun": "if",
                "args": [
                  {
                    "type": "call",
                    "fun": "&&",
                    "args": [
                      {
                        "type": "call",
                        "fun": "is.list",
                        "args": [
                          {
                            "type": "name",
                            "value": "fit"
                          }
                        ]
                      },
                      {
                        "type": "call",
                        "fun": "%in%",
                        "args": [
                          {
                            "type": "literal",
                            "value": "draws"
                          },
                          {
                            "type": "call",
                            "fun": "names",
                            "args": [
                              {
                                "type": "name",
                                "value": "fit"
                              }
                            ]
                          }
                        ]
                      }
                    ]
                  },
                  {
                    "type": "call",
                    "fun": "{",
                    "args": [
                      {
                        "type": "call",
                        "fun": "<-",
                        "args": [
                          {
                            "type": "name",
                            "value": "draws"
                          },
                          {
                            "type": "call",
                            "fun": "$",
                            "args": [
                              {
                                "type": "name",
                                "value": "fit"
                              },
                              {
                                "type": "name",
                                "value": "draws"
                              }
                            ]
                          }
                        ]
                      }
                    ]
                  },
                  {
                    "type": "call",
                    "fun": "{",
                    "args": [
                      {
                        "type": "call",
                        "fun": "<-",
                        "args": [
                          {
                            "type": "name",
                            "value": "draws"
                          },
                          {
                            "type": "name",
                            "value": "fit"
                          }
                        ]
                      }
                    ]
                  }
                ]
              },
              {
                "type": "call",
                "fun": "<-",
                "args": [
                  {
                    "type": "name",
                    "value": "n_draws"
                  },
                  {
                    "type": "call",
                    "fun": "nrow",
                    "args": [
                      {
                        "type": "name",
                        "value": "draws"
                      }
                    ]
                  }
                ]
              },
              {
                "type": "call",
                "fun": "if",
                "args": [
                  {
                    "type": "call",
                    "fun": ">",
                    "args": [
                      {
                        "type": "name",
                        "value": "n_sims"
                      },
                      {
                        "type": "name",
                        "value": "n_draws"
                      }
                    ]
                  },
                  {
                    "type": "call",
                    "fun": "{",
                    "args": [
                      {
                        "type": "call",
                        "fun": "<-",
                        "args": [
                          {
                            "type": "name",
                            "value": "sim_idx"
                          },
                          {
                            "type": "call",
                            "fun": "sample",
                            "args": {
                              "1": {
                                "type": "name",
                                "value": "n_draws"
                              },
                              "2": {
                                "type": "name",
                                "value": "n_sims"
                              },
                              "replace": {
                                "type": "literal",
                                "value": true
                              }
                            }
                          }
                        ]
                      }
                    ]
                  },
                  {
                    "type": "call",
                    "fun": "{",
                    "args": [
                      {
                        "type": "call",
                        "fun": "<-",
                        "args": [
                          {
                            "type": "name",
                            "value": "sim_idx"
                          },
                          {
                            "type": "call",
                            "fun": "sample",
                            "args": [
                              {
                                "type": "name",
                                "value": "n_draws"
                              },
                              {
                                "type": "name",
                                "value": "n_sims"
                              }
                            ]
                          }
                        ]
                      }
                    ]
                  }
                ]
              },
              {
                "type": "call",
                "fun": "<-",
                "args": [
                  {
                    "type": "name",
                    "value": "chunks"
                  },
                  {
                    "type": "call",
                    "fun": "create_chunks",
                    "args": [
                      {
                        "type": "name",
                        "value": "n_sims"
                      },
                      {
                        "type": "name",
                        "value": "n_cores"
                      }
                    ]
                  }
                ]
              },
              {
                "type": "call",
                "fun": "if",
                "args": [
                  {
                    "type": "call",
                    "fun": "==",
                    "args": [
                      {
                        "type": "call",
                        "fun": "$",
                        "args": [
                          {
                            "type": "name",
                            "value": ".Platform"
                          },
                          {
                            "type": "name",
                            "value": "OS.type"
                          }
                        ]
                      },
                      {
                        "type": "literal",
                        "value": "unix"
                      }
                    ]
                  },
                  {
                    "type": "call",
                    "fun": "{",
                    "args": [
                      {
                        "type": "call",
                        "fun": "<-",
                        "args": [
                          {
                            "type": "name",
                            "value": "ppc_list"
                          },
                          {
                            "type": "call",
                            "fun": ["::", "parallel", "mclapply"],
                            "args": {
                              "1": {
                                "type": "name",
                                "value": "chunks"
                              },
                              "2": {
                                "type": "call",
                                "fun": "function",
                                "args": [
                                  {
                                    "type": "pairlist",
                                    "value": ""
                                  },
                                  {
                                    "type": "call",
                                    "fun": "{",
                                    "args": [
                                      {
                                        "type": "call",
                                        "fun": "<-",
                                        "args": [
                                          {
                                            "type": "name",
                                            "value": "ppc_chunk"
                                          },
                                          {
                                            "type": "call",
                                            "fun": "list",
                                            "args": []
                                          }
                                        ]
                                      },
                                      {
                                        "type": "call",
                                        "fun": "for",
                                        "args": [
                                          {
                                            "type": "name",
                                            "value": "i"
                                          },
                                          {
                                            "type": "call",
                                            "fun": "seq_along",
                                            "args": [
                                              {
                                                "type": "name",
                                                "value": "idx"
                                              }
                                            ]
                                          },
                                          {
                                            "type": "call",
                                            "fun": "{",
                                            "args": [
                                              {
                                                "type": "call",
                                                "fun": "<-",
                                                "args": [
                                                  {
                                                    "type": "name",
                                                    "value": "draw_idx"
                                                  },
                                                  {
                                                    "type": "call",
                                                    "fun": "[",
                                                    "args": [
                                                      {
                                                        "type": "name",
                                                        "value": "sim_idx"
                                                      },
                                                      {
                                                        "type": "call",
                                                        "fun": "[",
                                                        "args": [
                                                          {
                                                            "type": "name",
                                                            "value": "idx"
                                                          },
                                                          {
                                                            "type": "name",
                                                            "value": "i"
                                                          }
                                                        ]
                                                      }
                                                    ]
                                                  }
                                                ]
                                              },
                                              {
                                                "type": "call",
                                                "fun": "<-",
                                                "args": [
                                                  {
                                                    "type": "name",
                                                    "value": "theta"
                                                  },
                                                  {
                                                    "type": "call",
                                                    "fun": "as.list",
                                                    "args": [
                                                      {
                                                        "type": "call",
                                                        "fun": "[",
                                                        "args": [
                                                          {
                                                            "type": "name",
                                                            "value": "draws"
                                                          },
                                                          {
                                                            "type": "name",
                                                            "value": "draw_idx"
                                                          },
                                                          {
                                                            "type": "name",
                                                            "value": ""
                                                          }
                                                        ]
                                                      }
                                                    ]
                                                  }
                                                ]
                                              },
                                              {
                                                "type": "call",
                                                "fun": "if",
                                                "args": [
                                                  {
                                                    "type": "call",
                                                    "fun": "!",
                                                    "args": [
                                                      {
                                                        "type": "call",
                                                        "fun": "is.null",
                                                        "args": [
                                                          {
                                                            "type": "name",
                                                            "value": "obs_data"
                                                          }
                                                        ]
                                                      }
                                                    ]
                                                  },
                                                  {
                                                    "type": "call",
                                                    "fun": "{",
                                                    "args": [
                                                      {
                                                        "type": "call",
                                                        "fun": "<-",
                                                        "args": [
                                                          {
                                                            "type": "name",
                                                            "value": "pred"
                                                          },
                                                          {
                                                            "type": "call",
                                                            "fun": "predict_from_theta",
                                                            "args": [
                                                              {
                                                                "type": "name",
                                                                "value": "theta"
                                                              },
                                                              {
                                                                "type": "name",
                                                                "value": "obs_data"
                                                              }
                                                            ]
                                                          }
                                                        ]
                                                      },
                                                      {
                                                        "type": "call",
                                                        "fun": "<-",
                                                        "args": [
                                                          {
                                                            "type": "name",
                                                            "value": "sigma"
                                                          },
                                                          {
                                                            "type": "call",
                                                            "fun": "%||%",
                                                            "args": [
                                                              {
                                                                "type": "call",
                                                                "fun": "$",
                                                                "args": [
                                                                  {
                                                                    "type": "name",
                                                                    "value": "theta"
                                                                  },
                                                                  {
                                                                    "type": "name",
                                                                    "value": "sigma"
                                                                  }
                                                                ]
                                                              },
                                                              {
                                                                "type": "literal",
                                                                "value": 0.1
                                                              }
                                                            ]
                                                          }
                                                        ]
                                                      },
                                                      {
                                                        "type": "call",
                                                        "fun": "<-",
                                                        "args": [
                                                          {
                                                            "type": "name",
                                                            "value": "y_rep"
                                                          },
                                                          {
                                                            "type": "call",
                                                            "fun": "rnorm",
                                                            "args": [
                                                              {
                                                                "type": "call",
                                                                "fun": "length",
                                                                "args": [
                                                                  {
                                                                    "type": "name",
                                                                    "value": "pred"
                                                                  }
                                                                ]
                                                              },
                                                              {
                                                                "type": "name",
                                                                "value": "pred"
                                                              },
                                                              {
                                                                "type": "name",
                                                                "value": "sigma"
                                                              }
                                                            ]
                                                          }
                                                        ]
                                                      }
                                                    ]
                                                  },
                                                  {
                                                    "type": "call",
                                                    "fun": "{",
                                                    "args": [
                                                      {
                                                        "type": "call",
                                                        "fun": "<-",
                                                        "args": [
                                                          {
                                                            "type": "name",
                                                            "value": "y_rep"
                                                          },
                                                          {
                                                            "type": "call",
                                                            "fun": "rnorm",
                                                            "args": [
                                                              {
                                                                "type": "literal",
                                                                "value": 100
                                                              },
                                                              {
                                                                "type": "call",
                                                                "fun": "%||%",
                                                                "args": [
                                                                  {
                                                                    "type": "call",
                                                                    "fun": "$",
                                                                    "args": [
                                                                      {
                                                                        "type": "name",
                                                                        "value": "theta"
                                                                      },
                                                                      {
                                                                        "type": "name",
                                                                        "value": "mu"
                                                                      }
                                                                    ]
                                                                  },
                                                                  {
                                                                    "type": "literal",
                                                                    "value": 0
                                                                  }
                                                                ]
                                                              },
                                                              {
                                                                "type": "call",
                                                                "fun": "%||%",
                                                                "args": [
                                                                  {
                                                                    "type": "call",
                                                                    "fun": "$",
                                                                    "args": [
                                                                      {
                                                                        "type": "name",
                                                                        "value": "theta"
                                                                      },
                                                                      {
                                                                        "type": "name",
                                                                        "value": "sigma"
                                                                      }
                                                                    ]
                                                                  },
                                                                  {
                                                                    "type": "literal",
                                                                    "value": 1
                                                                  }
                                                                ]
                                                              }
                                                            ]
                                                          }
                                                        ]
                                                      }
                                                    ]
                                                  }
                                                ]
                                              },
                                              {
                                                "type": "call",
                                                "fun": "<-",
                                                "args": [
                                                  {
                                                    "type": "call",
                                                    "fun": "[[",
                                                    "args": [
                                                      {
                                                        "type": "name",
                                                        "value": "ppc_chunk"
                                                      },
                                                      {
                                                        "type": "name",
                                                        "value": "i"
                                                      }
                                                    ]
                                                  },
                                                  {
                                                    "type": "name",
                                                    "value": "y_rep"
                                                  }
                                                ]
                                              }
                                            ]
                                          }
                                        ]
                                      },
                                      {
                                        "type": "call",
                                        "fun": "return",
                                        "args": [
                                          {
                                            "type": "name",
                                            "value": "ppc_chunk"
                                          }
                                        ]
                                      }
                                    ]
                                  },
                                  {
                                    "type": "NULL",
                                    "value": []
                                  }
                                ]
                              },
                              "mc.cores": {
                                "type": "name",
                                "value": "n_cores"
                              }
                            }
                          }
                        ]
                      }
                    ]
                  },
                  {
                    "type": "call",
                    "fun": "{",
                    "args": [
                      {
                        "type": "call",
                        "fun": "<-",
                        "args": [
                          {
                            "type": "name",
                            "value": "cl"
                          },
                          {
                            "type": "call",
                            "fun": ["::", "parallel", "makeCluster"],
                            "args": [
                              {
                                "type": "name",
                                "value": "n_cores"
                              }
                            ]
                          }
                        ]
                      },
                      {
                        "type": "call",
                        "fun": "on.exit",
                        "args": [
                          {
                            "type": "call",
                            "fun": ["::", "parallel", "stopCluster"],
                            "args": [
                              {
                                "type": "name",
                                "value": "cl"
                              }
                            ]
                          }
                        ]
                      },
                      {
                        "type": "call",
                        "fun": ["::", "parallel", "clusterExport"],
                        "args": {
                          "1": {
                            "type": "name",
                            "value": "cl"
                          },
                          "2": {
                            "type": "call",
                            "fun": "c",
                            "args": [
                              {
                                "type": "literal",
                                "value": "draws"
                              },
                              {
                                "type": "literal",
                                "value": "sim_idx"
                              },
                              {
                                "type": "literal",
                                "value": "obs_data"
                              }
                            ]
                          },
                          "envir": {
                            "type": "call",
                            "fun": "environment",
                            "args": []
                          }
                        }
                      },
                      {
                        "type": "call",
                        "fun": "<-",
                        "args": [
                          {
                            "type": "name",
                            "value": "ppc_list"
                          },
                          {
                            "type": "call",
                            "fun": ["::", "parallel", "parLapply"],
                            "args": [
                              {
                                "type": "name",
                                "value": "cl"
                              },
                              {
                                "type": "name",
                                "value": "chunks"
                              },
                              {
                                "type": "call",
                                "fun": "function",
                                "args": [
                                  {
                                    "type": "pairlist",
                                    "value": ""
                                  },
                                  {
                                    "type": "call",
                                    "fun": "{",
                                    "args": [
                                      {
                                        "type": "call",
                                        "fun": "<-",
                                        "args": [
                                          {
                                            "type": "name",
                                            "value": "ppc_chunk"
                                          },
                                          {
                                            "type": "call",
                                            "fun": "list",
                                            "args": []
                                          }
                                        ]
                                      },
                                      {
                                        "type": "call",
                                        "fun": "for",
                                        "args": [
                                          {
                                            "type": "name",
                                            "value": "i"
                                          },
                                          {
                                            "type": "call",
                                            "fun": "seq_along",
                                            "args": [
                                              {
                                                "type": "name",
                                                "value": "idx"
                                              }
                                            ]
                                          },
                                          {
                                            "type": "call",
                                            "fun": "{",
                                            "args": [
                                              {
                                                "type": "call",
                                                "fun": "<-",
                                                "args": [
                                                  {
                                                    "type": "name",
                                                    "value": "draw_idx"
                                                  },
                                                  {
                                                    "type": "call",
                                                    "fun": "[",
                                                    "args": [
                                                      {
                                                        "type": "name",
                                                        "value": "sim_idx"
                                                      },
                                                      {
                                                        "type": "call",
                                                        "fun": "[",
                                                        "args": [
                                                          {
                                                            "type": "name",
                                                            "value": "idx"
                                                          },
                                                          {
                                                            "type": "name",
                                                            "value": "i"
                                                          }
                                                        ]
                                                      }
                                                    ]
                                                  }
                                                ]
                                              },
                                              {
                                                "type": "call",
                                                "fun": "<-",
                                                "args": [
                                                  {
                                                    "type": "name",
                                                    "value": "theta"
                                                  },
                                                  {
                                                    "type": "call",
                                                    "fun": "as.list",
                                                    "args": [
                                                      {
                                                        "type": "call",
                                                        "fun": "[",
                                                        "args": [
                                                          {
                                                            "type": "name",
                                                            "value": "draws"
                                                          },
                                                          {
                                                            "type": "name",
                                                            "value": "draw_idx"
                                                          },
                                                          {
                                                            "type": "name",
                                                            "value": ""
                                                          }
                                                        ]
                                                      }
                                                    ]
                                                  }
                                                ]
                                              },
                                              {
                                                "type": "call",
                                                "fun": "if",
                                                "args": [
                                                  {
                                                    "type": "call",
                                                    "fun": "!",
                                                    "args": [
                                                      {
                                                        "type": "call",
                                                        "fun": "is.null",
                                                        "args": [
                                                          {
                                                            "type": "name",
                                                            "value": "obs_data"
                                                          }
                                                        ]
                                                      }
                                                    ]
                                                  },
                                                  {
                                                    "type": "call",
                                                    "fun": "{",
                                                    "args": [
                                                      {
                                                        "type": "call",
                                                        "fun": "<-",
                                                        "args": [
                                                          {
                                                            "type": "name",
                                                            "value": "pred"
                                                          },
                                                          {
                                                            "type": "call",
                                                            "fun": "predict_from_theta",
                                                            "args": [
                                                              {
                                                                "type": "name",
                                                                "value": "theta"
                                                              },
                                                              {
                                                                "type": "name",
                                                                "value": "obs_data"
                                                              }
                                                            ]
                                                          }
                                                        ]
                                                      },
                                                      {
                                                        "type": "call",
                                                        "fun": "<-",
                                                        "args": [
                                                          {
                                                            "type": "name",
                                                            "value": "sigma"
                                                          },
                                                          {
                                                            "type": "call",
                                                            "fun": "%||%",
                                                            "args": [
                                                              {
                                                                "type": "call",
                                                                "fun": "$",
                                                                "args": [
                                                                  {
                                                                    "type": "name",
                                                                    "value": "theta"
                                                                  },
                                                                  {
                                                                    "type": "name",
                                                                    "value": "sigma"
                                                                  }
                                                                ]
                                                              },
                                                              {
                                                                "type": "literal",
                                                                "value": 0.1
                                                              }
                                                            ]
                                                          }
                                                        ]
                                                      },
                                                      {
                                                        "type": "call",
                                                        "fun": "<-",
                                                        "args": [
                                                          {
                                                            "type": "name",
                                                            "value": "y_rep"
                                                          },
                                                          {
                                                            "type": "call",
                                                            "fun": "rnorm",
                                                            "args": [
                                                              {
                                                                "type": "call",
                                                                "fun": "length",
                                                                "args": [
                                                                  {
                                                                    "type": "name",
                                                                    "value": "pred"
                                                                  }
                                                                ]
                                                              },
                                                              {
                                                                "type": "name",
                                                                "value": "pred"
                                                              },
                                                              {
                                                                "type": "name",
                                                                "value": "sigma"
                                                              }
                                                            ]
                                                          }
                                                        ]
                                                      }
                                                    ]
                                                  },
                                                  {
                                                    "type": "call",
                                                    "fun": "{",
                                                    "args": [
                                                      {
                                                        "type": "call",
                                                        "fun": "<-",
                                                        "args": [
                                                          {
                                                            "type": "name",
                                                            "value": "y_rep"
                                                          },
                                                          {
                                                            "type": "call",
                                                            "fun": "rnorm",
                                                            "args": [
                                                              {
                                                                "type": "literal",
                                                                "value": 100
                                                              },
                                                              {
                                                                "type": "call",
                                                                "fun": "%||%",
                                                                "args": [
                                                                  {
                                                                    "type": "call",
                                                                    "fun": "$",
                                                                    "args": [
                                                                      {
                                                                        "type": "name",
                                                                        "value": "theta"
                                                                      },
                                                                      {
                                                                        "type": "name",
                                                                        "value": "mu"
                                                                      }
                                                                    ]
                                                                  },
                                                                  {
                                                                    "type": "literal",
                                                                    "value": 0
                                                                  }
                                                                ]
                                                              },
                                                              {
                                                                "type": "call",
                                                                "fun": "%||%",
                                                                "args": [
                                                                  {
                                                                    "type": "call",
                                                                    "fun": "$",
                                                                    "args": [
                                                                      {
                                                                        "type": "name",
                                                                        "value": "theta"
                                                                      },
                                                                      {
                                                                        "type": "name",
                                                                        "value": "sigma"
                                                                      }
                                                                    ]
                                                                  },
                                                                  {
                                                                    "type": "literal",
                                                                    "value": 1
                                                                  }
                                                                ]
                                                              }
                                                            ]
                                                          }
                                                        ]
                                                      }
                                                    ]
                                                  }
                                                ]
                                              },
                                              {
                                                "type": "call",
                                                "fun": "<-",
                                                "args": [
                                                  {
                                                    "type": "call",
                                                    "fun": "[[",
                                                    "args": [
                                                      {
                                                        "type": "name",
                                                        "value": "ppc_chunk"
                                                      },
                                                      {
                                                        "type": "name",
                                                        "value": "i"
                                                      }
                                                    ]
                                                  },
                                                  {
                                                    "type": "name",
                                                    "value": "y_rep"
                                                  }
                                                ]
                                              }
                                            ]
                                          }
                                        ]
                                      },
                                      {
                                        "type": "call",
                                        "fun": "return",
                                        "args": [
                                          {
                                            "type": "name",
                                            "value": "ppc_chunk"
                                          }
                                        ]
                                      }
                                    ]
                                  },
                                  {
                                    "type": "NULL",
                                    "value": []
                                  }
                                ]
                              }
                            ]
                          }
                        ]
                      }
                    ]
                  }
                ]
              },
              {
                "type": "call",
                "fun": "<-",
                "args": [
                  {
                    "type": "name",
                    "value": "ppc_samples"
                  },
                  {
                    "type": "call",
                    "fun": "unlist",
                    "args": {
                      "1": {
                        "type": "name",
                        "value": "ppc_list"
                      },
                      "recursive": {
                        "type": "literal",
                        "value": false
                      }
                    }
                  }
                ]
              },
              {
                "type": "call",
                "fun": "return",
                "args": [
                  {
                    "type": "name",
                    "value": "ppc_samples"
                  }
                ]
              }
            ]
          },
          {
            "type": "NULL",
            "value": []
          }
        ]
      }
    ]
  },
  {
    "type": "call",
    "fun": "<-",
    "args": [
      {
        "type": "name",
        "value": "run_fit"
      },
      {
        "type": "call",
        "fun": "function",
        "args": [
          {
            "type": "pairlist",
            "value": ["", "", "", "1C", "kombiniert", "list()", "Laplace", "TRUE", "FALSE", "NULL", ""]
          },
          {
            "type": "call",
            "fun": "{",
            "args": [
              {
                "type": "call",
                "fun": "if",
                "args": [
                  {
                    "type": "call",
                    "fun": "&&",
                    "args": [
                      {
                        "type": "name",
                        "value": "parallel"
                      },
                      {
                        "type": "call",
                        "fun": "is.null",
                        "args": [
                          {
                            "type": "name",
                            "value": "n_cores"
                          }
                        ]
                      }
                    ]
                  },
                  {
                    "type": "call",
                    "fun": "{",
                    "args": [
                      {
                        "type": "call",
                        "fun": "<-",
                        "args": [
                          {
                            "type": "name",
                            "value": "n_cores"
                          },
                          {
                            "type": "call",
                            "fun": "get_optimal_workers",
                            "args": {
                              "task_type": {
                                "type": "literal",
                                "value": "memory"
                              }
                            }
                          }
                        ]
                      }
                    ]
                  },
                  {
                    "type": "call",
                    "fun": "if",
                    "args": [
                      {
                        "type": "call",
                        "fun": "!",
                        "args": [
                          {
                            "type": "name",
                            "value": "parallel"
                          }
                        ]
                      },
                      {
                        "type": "call",
                        "fun": "{",
                        "args": [
                          {
                            "type": "call",
                            "fun": "<-",
                            "args": [
                              {
                                "type": "name",
                                "value": "n_cores"
                              },
                              {
                                "type": "literal",
                                "value": 1
                              }
                            ]
                          }
                        ]
                      }
                    ]
                  }
                ]
              },
              {
                "type": "call",
                "fun": "options",
                "args": {
                  "tdmx_parallel_cores": {
                    "type": "name",
                    "value": "n_cores"
                  }
                }
              },
              {
                "type": "call",
                "fun": "message",
                "args": [
                  {
                    "type": "call",
                    "fun": "sprintf",
                    "args": [
                      {
                        "type": "literal",
                        "value": "Running %s fit with %d cores..."
                      },
                      {
                        "type": "name",
                        "value": "backend"
                      },
                      {
                        "type": "name",
                        "value": "n_cores"
                      }
                    ]
                  }
                ]
              },
              {
                "type": "call",
                "fun": "<-",
                "args": [
                  {
                    "type": "name",
                    "value": "result"
                  },
                  {
                    "type": "call",
                    "fun": "switch",
                    "args": {
                      "1": {
                        "type": "name",
                        "value": "backend"
                      },
                      "Laplace": {
                        "type": "call",
                        "fun": "{",
                        "args": [
                          {
                            "type": "call",
                            "fun": "<-",
                            "args": [
                              {
                                "type": "name",
                                "value": "n_starts"
                              },
                              {
                                "type": "call",
                                "fun": "min",
                                "args": [
                                  {
                                    "type": "call",
                                    "fun": "*",
                                    "args": [
                                      {
                                        "type": "name",
                                        "value": "n_cores"
                                      },
                                      {
                                        "type": "literal",
                                        "value": 2
                                      }
                                    ]
                                  },
                                  {
                                    "type": "literal",
                                    "value": 10
                                  }
                                ]
                              }
                            ]
                          },
                          {
                            "type": "call",
                            "fun": "<-",
                            "args": [
                              {
                                "type": "name",
                                "value": "start_points"
                              },
                              {
                                "type": "call",
                                "fun": "generate_start_points",
                                "args": [
                                  {
                                    "type": "name",
                                    "value": "priors"
                                  },
                                  {
                                    "type": "name",
                                    "value": "n_starts"
                                  }
                                ]
                              }
                            ]
                          },
                          {
                            "type": "call",
                            "fun": "parallel_laplace",
                            "args": {
                              "logpost": {
                                "type": "call",
                                "fun": "function",
                                "args": [
                                  {
                                    "type": "pairlist",
                                    "value": ""
                                  },
                                  {
                                    "type": "call",
                                    "fun": "{",
                                    "args": [
                                      {
                                        "type": "call",
                                        "fun": "compute_logpost",
                                        "args": [
                                          {
                                            "type": "name",
                                            "value": "theta"
                                          },
                                          {
                                            "type": "name",
                                            "value": "obs"
                                          },
                                          {
                                            "type": "name",
                                            "value": "regimen"
                                          },
                                          {
                                            "type": "name",
                                            "value": "priors"
                                          },
                                          {
                                            "type": "name",
                                            "value": "model_type"
                                          },
                                          {
                                            "type": "name",
                                            "value": "error_model"
                                          }
                                        ]
                                      }
                                    ]
                                  },
                                  {
                                    "type": "NULL",
                                    "value": []
                                  }
                                ]
                              },
                              "start_points": {
                                "type": "name",
                                "value": "start_points"
                              },
                              "n_cores": {
                                "type": "name",
                                "value": "n_cores"
                              }
                            }
                          }
                        ]
                      },
                      "Stan-HMC": {
                        "type": "call",
                        "fun": "{",
                        "args": [
                          {
                            "type": "call",
                            "fun": "<-",
                            "args": [
                              {
                                "type": "name",
                                "value": "stan_code"
                              },
                              {
                                "type": "call",
                                "fun": "generate_stan_code",
                                "args": [
                                  {
                                    "type": "name",
                                    "value": "model_type"
                                  },
                                  {
                                    "type": "name",
                                    "value": "error_model"
                                  }
                                ]
                              }
                            ]
                          },
                          {
                            "type": "call",
                            "fun": "<-",
                            "args": [
                              {
                                "type": "name",
                                "value": "stan_data"
                              },
                              {
                                "type": "call",
                                "fun": "prepare_stan_data",
                                "args": [
                                  {
                                    "type": "name",
                                    "value": "obs"
                                  },
                                  {
                                    "type": "name",
                                    "value": "regimen"
                                  },
                                  {
                                    "type": "name",
                                    "value": "priors"
                                  },
                                  {
                                    "type": "name",
                                    "value": "covariates"
                                  }
                                ]
                              }
                            ]
                          },
                          {
                            "type": "call",
                            "fun": "run_fit_stan_hmc_parallel",
                            "args": {
                              "model_code": {
                                "type": "name",
                                "value": "stan_code"
                              },
                              "data": {
                                "type": "name",
                                "value": "stan_data"
                              },
                              "backend": {
                                "type": "call",
                                "fun": "ifelse",
                                "args": [
                                  {
                                    "type": "name",
                                    "value": "async"
                                  },
                                  {
                                    "type": "literal",
                                    "value": "async"
                                  },
                                  {
                                    "type": "literal",
                                    "value": "sync"
                                  }
                                ]
                              },
                              "4": {
                                "type": "name",
                                "value": "..."
                              }
                            }
                          }
                        ]
                      },
                      "Stan-ADVI": {
                        "type": "call",
                        "fun": "{",
                        "args": [
                          {
                            "type": "call",
                            "fun": "<-",
                            "args": [
                              {
                                "type": "name",
                                "value": "stan_code"
                              },
                              {
                                "type": "call",
                                "fun": "generate_stan_code",
                                "args": [
                                  {
                                    "type": "name",
                                    "value": "model_type"
                                  },
                                  {
                                    "type": "name",
                                    "value": "error_model"
                                  }
                                ]
                              }
                            ]
                          },
                          {
                            "type": "call",
                            "fun": "<-",
                            "args": [
                              {
                                "type": "name",
                                "value": "stan_data"
                              },
                              {
                                "type": "call",
                                "fun": "prepare_stan_data",
                                "args": [
                                  {
                                    "type": "name",
                                    "value": "obs"
                                  },
                                  {
                                    "type": "name",
                                    "value": "regimen"
                                  },
                                  {
                                    "type": "name",
                                    "value": "priors"
                                  },
                                  {
                                    "type": "name",
                                    "value": "covariates"
                                  }
                                ]
                              }
                            ]
                          },
                          {
                            "type": "call",
                            "fun": "if",
                            "args": [
                              {
                                "type": "name",
                                "value": "async"
                              },
                              {
                                "type": "call",
                                "fun": "{",
                                "args": [
                                  {
                                    "type": "call",
                                    "fun": "fit_stan_async",
                                    "args": {
                                      "stan_code": {
                                        "type": "name",
                                        "value": "stan_code"
                                      },
                                      "data": {
                                        "type": "name",
                                        "value": "stan_data"
                                      },
                                      "algorithm": {
                                        "type": "literal",
                                        "value": "meanfield"
                                      },
                                      "4": {
                                        "type": "name",
                                        "value": "..."
                                      }
                                    }
                                  }
                                ]
                              },
                              {
                                "type": "call",
                                "fun": "{",
                                "args": [
                                  {
                                    "type": "call",
                                    "fun": "<-",
                                    "args": [
                                      {
                                        "type": "name",
                                        "value": "model"
                                      },
                                      {
                                        "type": "call",
                                        "fun": ["::", "cmdstanr", "cmdstan_model"],
                                        "args": [
                                          {
                                            "type": "call",
                                            "fun": ["::", "cmdstanr", "write_stan_file"],
                                            "args": [
                                              {
                                                "type": "name",
                                                "value": "stan_code"
                                              }
                                            ]
                                          }
                                        ]
                                      }
                                    ]
                                  },
                                  {
                                    "type": "call",
                                    "fun": ["$", "model", "variational"],
                                    "args": {
                                      "data": {
                                        "type": "name",
                                        "value": "stan_data"
                                      },
                                      "algorithm": {
                                        "type": "literal",
                                        "value": "meanfield"
                                      },
                                      "iter": {
                                        "type": "call",
                                        "fun": "%||%",
                                        "args": [
                                          {
                                            "type": "call",
                                            "fun": "$",
                                            "args": [
                                              {
                                                "type": "call",
                                                "fun": "$",
                                                "args": [
                                                  {
                                                    "type": "call",
                                                    "fun": "$",
                                                    "args": [
                                                      {
                                                        "type": "name",
                                                        "value": "optim_config"
                                                      },
                                                      {
                                                        "type": "name",
                                                        "value": "stan"
                                                      }
                                                    ]
                                                  },
                                                  {
                                                    "type": "name",
                                                    "value": "advi"
                                                  }
                                                ]
                                              },
                                              {
                                                "type": "name",
                                                "value": "iter"
                                              }
                                            ]
                                          },
                                          {
                                            "type": "literal",
                                            "value": 10000
                                          }
                                        ]
                                      },
                                      "output_samples": {
                                        "type": "call",
                                        "fun": "%||%",
                                        "args": [
                                          {
                                            "type": "call",
                                            "fun": "$",
                                            "args": [
                                              {
                                                "type": "call",
                                                "fun": "$",
                                                "args": [
                                                  {
                                                    "type": "call",
                                                    "fun": "$",
                                                    "args": [
                                                      {
                                                        "type": "name",
                                                        "value": "optim_config"
                                                      },
                                                      {
                                                        "type": "name",
                                                        "value": "stan"
                                                      }
                                                    ]
                                                  },
                                                  {
                                                    "type": "name",
                                                    "value": "advi"
                                                  }
                                                ]
                                              },
                                              {
                                                "type": "name",
                                                "value": "output_samples"
                                              }
                                            ]
                                          },
                                          {
                                            "type": "literal",
                                            "value": 1000
                                          }
                                        ]
                                      }
                                    }
                                  }
                                ]
                              }
                            ]
                          }
                        ]
                      },
                      "5": {
                        "type": "call",
                        "fun": "stop",
                        "args": [
                          {
                            "type": "literal",
                            "value": "Unknown backend: "
                          },
                          {
                            "type": "name",
                            "value": "backend"
                          }
                        ]
                      }
                    }
                  }
                ]
              },
              {
                "type": "call",
                "fun": "if",
                "args": [
                  {
                    "type": "call",
                    "fun": "!",
                    "args": [
                      {
                        "type": "call",
                        "fun": "is.null",
                        "args": [
                          {
                            "type": "call",
                            "fun": "$",
                            "args": [
                              {
                                "type": "name",
                                "value": "result"
                              },
                              {
                                "type": "name",
                                "value": "draws"
                              }
                            ]
                          }
                        ]
                      }
                    ]
                  },
                  {
                    "type": "call",
                    "fun": "{",
                    "args": [
                      {
                        "type": "call",
                        "fun": "<-",
                        "args": [
                          {
                            "type": "call",
                            "fun": "$",
                            "args": [
                              {
                                "type": "name",
                                "value": "result"
                              },
                              {
                                "type": "name",
                                "value": "diagnostics"
                              }
                            ]
                          },
                          {
                            "type": "call",
                            "fun": "calculate_diagnostics_parallel",
                            "args": [
                              {
                                "type": "call",
                                "fun": "$",
                                "args": [
                                  {
                                    "type": "name",
                                    "value": "result"
                                  },
                                  {
                                    "type": "name",
                                    "value": "draws"
                                  }
                                ]
                              },
                              {
                                "type": "name",
                                "value": "n_cores"
                              }
                            ]
                          }
                        ]
                      },
                      {
                        "type": "call",
                        "fun": "<-",
                        "args": [
                          {
                            "type": "call",
                            "fun": "$",
                            "args": [
                              {
                                "type": "name",
                                "value": "result"
                              },
                              {
                                "type": "name",
                                "value": "ppc"
                              }
                            ]
                          },
                          {
                            "type": "call",
                            "fun": "generate_ppc_parallel_bayes",
                            "args": {
                              "1": {
                                "type": "name",
                                "value": "result"
                              },
                              "n_sims": {
                                "type": "literal",
                                "value": 100
                              },
                              "obs_data": {
                                "type": "name",
                                "value": "obs"
                              },
                              "n_cores": {
                                "type": "name",
                                "value": "n_cores"
                              }
                            }
                          }
                        ]
                      }
                    ]
                  }
                ]
              },
              {
                "type": "call",
                "fun": "return",
                "args": [
                  {
                    "type": "name",
                    "value": "result"
                  }
                ]
              }
            ]
          },
          {
            "type": "NULL",
            "value": []
          }
        ]
      }
    ]
  },
  {
    "type": "call",
    "fun": "<-",
    "args": [
      {
        "type": "name",
        "value": "generate_start_points"
      },
      {
        "type": "call",
        "fun": "function",
        "args": [
          {
            "type": "pairlist",
            "value": ["", ""]
          },
          {
            "type": "call",
            "fun": "{",
            "args": [
              {
                "type": "call",
                "fun": "lapply",
                "args": [
                  {
                    "type": "call",
                    "fun": ":",
                    "args": [
                      {
                        "type": "literal",
                        "value": 1
                      },
                      {
                        "type": "name",
                        "value": "n_points"
                      }
                    ]
                  },
                  {
                    "type": "call",
                    "fun": "function",
                    "args": [
                      {
                        "type": "pairlist",
                        "value": ""
                      },
                      {
                        "type": "call",
                        "fun": "{",
                        "args": [
                          {
                            "type": "call",
                            "fun": "rnorm",
                            "args": [
                              {
                                "type": "call",
                                "fun": "length",
                                "args": [
                                  {
                                    "type": "call",
                                    "fun": "$",
                                    "args": [
                                      {
                                        "type": "name",
                                        "value": "priors"
                                      },
                                      {
                                        "type": "name",
                                        "value": "theta"
                                      }
                                    ]
                                  }
                                ]
                              }
                            ]
                          }
                        ]
                      },
                      {
                        "type": "NULL",
                        "value": []
                      }
                    ]
                  }
                ]
              }
            ]
          },
          {
            "type": "NULL",
            "value": []
          }
        ]
      }
    ]
  },
  {
    "type": "call",
    "fun": "<-",
    "args": [
      {
        "type": "name",
        "value": "compute_logpost"
      },
      {
        "type": "call",
        "fun": "function",
        "args": [
          {
            "type": "pairlist",
            "value": ["", "", "", "", "", ""]
          },
          {
            "type": "call",
            "fun": "{",
            "args": [
              {
                "type": "call",
                "fun": "sum",
                "args": [
                  {
                    "type": "call",
                    "fun": "dnorm",
                    "args": {
                      "1": {
                        "type": "name",
                        "value": "theta"
                      },
                      "2": {
                        "type": "literal",
                        "value": 0
                      },
                      "3": {
                        "type": "literal",
                        "value": 1
                      },
                      "log": {
                        "type": "literal",
                        "value": true
                      }
                    }
                  }
                ]
              }
            ]
          },
          {
            "type": "NULL",
            "value": []
          }
        ]
      }
    ]
  },
  {
    "type": "call",
    "fun": "<-",
    "args": [
      {
        "type": "name",
        "value": "generate_stan_code"
      },
      {
        "type": "call",
        "fun": "function",
        "args": [
          {
            "type": "pairlist",
            "value": ["", ""]
          },
          {
            "type": "call",
            "fun": "{",
            "args": [
              {
                "type": "literal",
                "value": ""
              }
            ]
          },
          {
            "type": "NULL",
            "value": []
          }
        ]
      }
    ]
  },
  {
    "type": "call",
    "fun": "<-",
    "args": [
      {
        "type": "name",
        "value": "prepare_stan_data"
      },
      {
        "type": "call",
        "fun": "function",
        "args": [
          {
            "type": "pairlist",
            "value": ["", "", "", ""]
          },
          {
            "type": "call",
            "fun": "{",
            "args": [
              {
                "type": "call",
                "fun": "list",
                "args": {
                  "N": {
                    "type": "call",
                    "fun": "nrow",
                    "args": [
                      {
                        "type": "name",
                        "value": "obs"
                      }
                    ]
                  }
                }
              }
            ]
          },
          {
            "type": "NULL",
            "value": []
          }
        ]
      }
    ]
  },
  {
    "type": "call",
    "fun": "<-",
    "args": [
      {
        "type": "name",
        "value": "predict_from_theta"
      },
      {
        "type": "call",
        "fun": "function",
        "args": [
          {
            "type": "pairlist",
            "value": ["", ""]
          },
          {
            "type": "call",
            "fun": "{",
            "args": [
              {
                "type": "call",
                "fun": "rep",
                "args": [
                  {
                    "type": "literal",
                    "value": 0
                  },
                  {
                    "type": "call",
                    "fun": "nrow",
                    "args": [
                      {
                        "type": "name",
                        "value": "data"
                      }
                    ]
                  }
                ]
              }
            ]
          },
          {
            "type": "NULL",
            "value": []
          }
        ]
      }
    ]
  },
  {
    "type": "call",
    "fun": "message",
    "args": [
      {
        "type": "literal",
        "value": "Parallelized backend_bayes loaded. Detected "
      },
      {
        "type": "call",
        "fun": ["::", "parallel", "detectCores"],
        "args": []
      },
      {
        "type": "literal",
        "value": " cores."
      }
    ]
  },
  {
    "type": "call",
    "fun": "if",
    "args": [
      {
        "type": "call",
        "fun": "&&",
        "args": [
          {
            "type": "call",
            "fun": "exists",
            "args": [
              {
                "type": "literal",
                "value": "optim_config"
              }
            ]
          },
          {
            "type": "call",
            "fun": "!",
            "args": [
              {
                "type": "call",
                "fun": "is.null",
                "args": [
                  {
                    "type": "name",
                    "value": "optim_config"
                  }
                ]
              }
            ]
          }
        ]
      },
      {
        "type": "call",
        "fun": "{",
        "args": [
          {
            "type": "call",
            "fun": "message",
            "args": [
              {
                "type": "literal",
                "value": "Configuration loaded from optimization_config.yaml"
              }
            ]
          }
        ]
      }
    ]
  }
]

[
  {
    "type": "call",
    "fun": "library",
    "args": [
      {
        "type": "name",
        "value": "testthat"
      }
    ]
  },
  {
    "type": "call",
    "fun": "library",
    "args": [
      {
        "type": "name",
        "value": "mockery"
      }
    ]
  },
  {
    "type": "call",
    "fun": "<-",
    "args": [
      {
        "type": "name",
        "value": "check_required_packages"
      },
      {
        "type": "call",
        "fun": "function",
        "args": [
          {
            "type": "NULL",
            "value": []
          },
          {
            "type": "call",
            "fun": "{",
            "args": [
              {
                "type": "call",
                "fun": "<-",
                "args": [
                  {
                    "type": "name",
                    "value": "required_packages"
                  },
                  {
                    "type": "call",
                    "fun": "c",
                    "args": [
                      {
                        "type": "literal",
                        "value": "shiny"
                      },
                      {
                        "type": "literal",
                        "value": "shinydashboard"
                      },
                      {
                        "type": "literal",
                        "value": "shinyWidgets"
                      },
                      {
                        "type": "literal",
                        "value": "ggplot2"
                      },
                      {
                        "type": "literal",
                        "value": "plotly"
                      },
                      {
                        "type": "literal",
                        "value": "DT"
                      },
                      {
                        "type": "literal",
                        "value": "dplyr"
                      },
                      {
                        "type": "literal",
                        "value": "tidyr"
                      },
                      {
                        "type": "literal",
                        "value": "data.table"
                      },
                      {
                        "type": "literal",
                        "value": "DBI"
                      },
                      {
                        "type": "literal",
                        "value": "RSQLite"
                      },
                      {
                        "type": "literal",
                        "value": "rstan"
                      },
                      {
                        "type": "literal",
                        "value": "posterior"
                      }
                    ]
                  }
                ]
              },
              {
                "type": "call",
                "fun": "<-",
                "args": [
                  {
                    "type": "name",
                    "value": "missing_packages"
                  },
                  {
                    "type": "call",
                    "fun": "[",
                    "args": [
                      {
                        "type": "name",
                        "value": "required_packages"
                      },
                      {
                        "type": "call",
                        "fun": "!",
                        "args": [
                          {
                            "type": "call",
                            "fun": "%in%",
                            "args": [
                              {
                                "type": "name",
                                "value": "required_packages"
                              },
                              {
                                "type": "call",
                                "fun": "[",
                                "args": [
                                  {
                                    "type": "call",
                                    "fun": "installed.packages",
                                    "args": []
                                  },
                                  {
                                    "type": "name",
                                    "value": ""
                                  },
                                  {
                                    "type": "literal",
                                    "value": "Package"
                                  }
                                ]
                              }
                            ]
                          }
                        ]
                      }
                    ]
                  }
                ]
              },
              {
                "type": "call",
                "fun": "if",
                "args": [
                  {
                    "type": "call",
                    "fun": ">",
                    "args": [
                      {
                        "type": "call",
                        "fun": "length",
                        "args": [
                          {
                            "type": "name",
                            "value": "missing_packages"
                          }
                        ]
                      },
                      {
                        "type": "literal",
                        "value": 0
                      }
                    ]
                  },
                  {
                    "type": "call",
                    "fun": "{",
                    "args": [
                      {
                        "type": "call",
                        "fun": "skip",
                        "args": [
                          {
                            "type": "call",
                            "fun": "paste",
                            "args": [
                              {
                                "type": "literal",
                                "value": "Missing required packages:"
                              },
                              {
                                "type": "call",
                                "fun": "paste",
                                "args": {
                                  "1": {
                                    "type": "name",
                                    "value": "missing_packages"
                                  },
                                  "collapse": {
                                    "type": "literal",
                                    "value": ", "
                                  }
                                }
                              }
                            ]
                          }
                        ]
                      }
                    ]
                  }
                ]
              }
            ]
          },
          {
            "type": "NULL",
            "value": []
          }
        ]
      }
    ]
  },
  {
    "type": "call",
    "fun": "test_that",
    "args": [
      {
        "type": "literal",
        "value": "App starts without errors"
      },
      {
        "type": "call",
        "fun": "{",
        "args": [
          {
            "type": "call",
            "fun": "<-",
            "args": [
              {
                "type": "name",
                "value": "required_files"
              },
              {
                "type": "call",
                "fun": "c",
                "args": [
                  {
                    "type": "literal",
                    "value": "R/load_all.R"
                  },
                  {
                    "type": "literal",
                    "value": "R/utils.R"
                  },
                  {
                    "type": "literal",
                    "value": "R/pk_calculations.R"
                  },
                  {
                    "type": "literal",
                    "value": "R/plotting_functions.R"
                  }
                ]
              }
            ]
          },
          {
            "type": "call",
            "fun": "<-",
            "args": [
              {
                "type": "name",
                "value": "mock_exists"
              },
              {
                "type": "call",
                "fun": "mock",
                "args": [
                  {
                    "type": "call",
                    "fun": "rep",
                    "args": [
                      {
                        "type": "literal",
                        "value": true
                      },
                      {
                        "type": "call",
                        "fun": "length",
                        "args": [
                          {
                            "type": "name",
                            "value": "required_files"
                          }
                        ]
                      }
                    ]
                  }
                ]
              }
            ]
          },
          {
            "type": "call",
            "fun": "stub",
            "args": [
              {
                "type": "name",
                "value": "file.exists"
              },
              {
                "type": "literal",
                "value": "base::file.exists"
              },
              {
                "type": "name",
                "value": "mock_exists"
              }
            ]
          },
          {
            "type": "call",
            "fun": "<-",
            "args": [
              {
                "type": "name",
                "value": "load_all_sources"
              },
              {
                "type": "call",
                "fun": "function",
                "args": [
                  {
                    "type": "NULL",
                    "value": []
                  },
                  {
                    "type": "call",
                    "fun": "{",
                    "args": [
                      {
                        "type": "call",
                        "fun": "<-",
                        "args": [
                          {
                            "type": "name",
                            "value": "source_files"
                          },
                          {
                            "type": "call",
                            "fun": "list.files",
                            "args": {
                              "1": {
                                "type": "literal",
                                "value": "R"
                              },
                              "pattern": {
                                "type": "literal",
                                "value": "\\.R$"
                              },
                              "full.names": {
                                "type": "literal",
                                "value": true
                              }
                            }
                          }
                        ]
                      },
                      {
                        "type": "call",
                        "fun": "if",
                        "args": [
                          {
                            "type": "call",
                            "fun": "==",
                            "args": [
                              {
                                "type": "call",
                                "fun": "length",
                                "args": [
                                  {
                                    "type": "name",
                                    "value": "source_files"
                                  }
                                ]
                              },
                              {
                                "type": "literal",
                                "value": 0
                              }
                            ]
                          },
                          {
                            "type": "call",
                            "fun": "{",
                            "args": [
                              {
                                "type": "call",
                                "fun": "warning",
                                "args": [
                                  {
                                    "type": "literal",
                                    "value": "No R files found in R/ directory"
                                  }
                                ]
                              },
                              {
                                "type": "call",
                                "fun": "return",
                                "args": [
                                  {
                                    "type": "literal",
                                    "value": false
                                  }
                                ]
                              }
                            ]
                          }
                        ]
                      },
                      {
                        "type": "call",
                        "fun": "for",
                        "args": [
                          {
                            "type": "name",
                            "value": "file"
                          },
                          {
                            "type": "name",
                            "value": "source_files"
                          },
                          {
                            "type": "call",
                            "fun": "{",
                            "args": [
                              {
                                "type": "call",
                                "fun": "tryCatch",
                                "args": {
                                  "1": {
                                    "type": "call",
                                    "fun": "{",
                                    "args": [
                                      {
                                        "type": "call",
                                        "fun": "if",
                                        "args": [
                                          {
                                            "type": "call",
                                            "fun": "!",
                                            "args": [
                                              {
                                                "type": "call",
                                                "fun": "file.exists",
                                                "args": [
                                                  {
                                                    "type": "name",
                                                    "value": "file"
                                                  }
                                                ]
                                              }
                                            ]
                                          },
                                          {
                                            "type": "call",
                                            "fun": "{",
                                            "args": [
                                              {
                                                "type": "call",
                                                "fun": "stop",
                                                "args": [
                                                  {
                                                    "type": "literal",
                                                    "value": "File not found: "
                                                  },
                                                  {
                                                    "type": "name",
                                                    "value": "file"
                                                  }
                                                ]
                                              }
                                            ]
                                          }
                                        ]
                                      }
                                    ]
                                  },
                                  "error": {
                                    "type": "call",
                                    "fun": "function",
                                    "args": [
                                      {
                                        "type": "pairlist",
                                        "value": ""
                                      },
                                      {
                                        "type": "call",
                                        "fun": "{",
                                        "args": [
                                          {
                                            "type": "call",
                                            "fun": "stop",
                                            "args": [
                                              {
                                                "type": "literal",
                                                "value": "Error loading "
                                              },
                                              {
                                                "type": "name",
                                                "value": "file"
                                              },
                                              {
                                                "type": "literal",
                                                "value": ": "
                                              },
                                              {
                                                "type": "call",
                                                "fun": "$",
                                                "args": [
                                                  {
                                                    "type": "name",
                                                    "value": "e"
                                                  },
                                                  {
                                                    "type": "name",
                                                    "value": "message"
                                                  }
                                                ]
                                              }
                                            ]
                                          }
                                        ]
                                      },
                                      {
                                        "type": "NULL",
                                        "value": []
                                      }
                                    ]
                                  }
                                }
                              }
                            ]
                          }
                        ]
                      },
                      {
                        "type": "call",
                        "fun": "return",
                        "args": [
                          {
                            "type": "literal",
                            "value": true
                          }
                        ]
                      }
                    ]
                  },
                  {
                    "type": "NULL",
                    "value": []
                  }
                ]
              }
            ]
          },
          {
            "type": "call",
            "fun": "expect_no_error",
            "args": [
              {
                "type": "call",
                "fun": "{",
                "args": [
                  {
                    "type": "call",
                    "fun": "<-",
                    "args": [
                      {
                        "type": "name",
                        "value": "result"
                      },
                      {
                        "type": "call",
                        "fun": "load_all_sources",
                        "args": []
                      }
                    ]
                  }
                ]
              }
            ]
          }
        ]
      }
    ]
  },
  {
    "type": "call",
    "fun": "test_that",
    "args": [
      {
        "type": "literal",
        "value": "Database connection and initialization works"
      },
      {
        "type": "call",
        "fun": "{",
        "args": [
          {
            "type": "call",
            "fun": "skip_if_not_installed",
            "args": [
              {
                "type": "literal",
                "value": "DBI"
              }
            ]
          },
          {
            "type": "call",
            "fun": "skip_if_not_installed",
            "args": [
              {
                "type": "literal",
                "value": "RSQLite"
              }
            ]
          },
          {
            "type": "call",
            "fun": "library",
            "args": [
              {
                "type": "name",
                "value": "DBI"
              }
            ]
          },
          {
            "type": "call",
            "fun": "library",
            "args": [
              {
                "type": "name",
                "value": "RSQLite"
              }
            ]
          },
          {
            "type": "call",
            "fun": "<-",
            "args": [
              {
                "type": "name",
                "value": "init_database"
              },
              {
                "type": "call",
                "fun": "function",
                "args": [
                  {
                    "type": "pairlist",
                    "value": ":memory:"
                  },
                  {
                    "type": "call",
                    "fun": "{",
                    "args": [
                      {
                        "type": "call",
                        "fun": "<-",
                        "args": [
                          {
                            "type": "name",
                            "value": "con"
                          },
                          {
                            "type": "call",
                            "fun": "dbConnect",
                            "args": [
                              {
                                "type": "call",
                                "fun": ["::", "RSQLite", "SQLite"],
                                "args": []
                              },
                              {
                                "type": "name",
                                "value": "db_path"
                              }
                            ]
                          }
                        ]
                      },
                      {
                        "type": "call",
                        "fun": "<-",
                        "args": [
                          {
                            "type": "name",
                            "value": "queries"
                          },
                          {
                            "type": "call",
                            "fun": "list",
                            "args": {
                              "users": {
                                "type": "literal",
                                "value": "\n        CREATE TABLE IF NOT EXISTS users (\n          id INTEGER PRIMARY KEY AUTOINCREMENT,\n          username TEXT UNIQUE NOT NULL,\n          password_hash TEXT NOT NULL,\n          email TEXT,\n          role TEXT DEFAULT 'user',\n          created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\n          last_login TIMESTAMP\n        )\n      "
                              },
                              "sessions": {
                                "type": "literal",
                                "value": "\n        CREATE TABLE IF NOT EXISTS sessions (\n          id INTEGER PRIMARY KEY AUTOINCREMENT,\n          user_id INTEGER,\n          session_token TEXT UNIQUE NOT NULL,\n          created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\n          expires_at TIMESTAMP,\n          ip_address TEXT,\n          FOREIGN KEY (user_id) REFERENCES users(id)\n        )\n      "
                              },
                              "audit_log": {
                                "type": "literal",
                                "value": "\n        CREATE TABLE IF NOT EXISTS audit_log (\n          id INTEGER PRIMARY KEY AUTOINCREMENT,\n          user_id INTEGER,\n          action TEXT NOT NULL,\n          details TEXT,\n          timestamp TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\n          ip_address TEXT,\n          FOREIGN KEY (user_id) REFERENCES users(id)\n        )\n      "
                              },
                              "pk_models": {
                                "type": "literal",
                                "value": "\n        CREATE TABLE IF NOT EXISTS pk_models (\n          id INTEGER PRIMARY KEY AUTOINCREMENT,\n          name TEXT NOT NULL,\n          description TEXT,\n          model_type TEXT,\n          parameters TEXT,\n          created_by INTEGER,\n          created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\n          FOREIGN KEY (created_by) REFERENCES users(id)\n        )\n      "
                              },
                              "simulation_results": {
                                "type": "literal",
                                "value": "\n        CREATE TABLE IF NOT EXISTS simulation_results (\n          id INTEGER PRIMARY KEY AUTOINCREMENT,\n          model_id INTEGER,\n          user_id INTEGER,\n          parameters TEXT,\n          results TEXT,\n          created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\n          FOREIGN KEY (model_id) REFERENCES pk_models(id),\n          FOREIGN KEY (user_id) REFERENCES users(id)\n        )\n      "
                              }
                            }
                          }
                        ]
                      },
                      {
                        "type": "call",
                        "fun": "for",
                        "args": [
                          {
                            "type": "name",
                            "value": "table_name"
                          },
                          {
                            "type": "call",
                            "fun": "names",
                            "args": [
                              {
                                "type": "name",
                                "value": "queries"
                              }
                            ]
                          },
                          {
                            "type": "call",
                            "fun": "{",
                            "args": [
                              {
                                "type": "call",
                                "fun": "dbExecute",
                                "args": [
                                  {
                                    "type": "name",
                                    "value": "con"
                                  },
                                  {
                                    "type": "call",
                                    "fun": "[[",
                                    "args": [
                                      {
                                        "type": "name",
                                        "value": "queries"
                                      },
                                      {
                                        "type": "name",
                                        "value": "table_name"
                                      }
                                    ]
                                  }
                                ]
                              }
                            ]
                          }
                        ]
                      },
                      {
                        "type": "call",
                        "fun": "<-",
                        "args": [
                          {
                            "type": "name",
                            "value": "indices"
                          },
                          {
                            "type": "call",
                            "fun": "c",
                            "args": [
                              {
                                "type": "literal",
                                "value": "CREATE INDEX IF NOT EXISTS idx_sessions_token ON sessions(session_token)"
                              },
                              {
                                "type": "literal",
                                "value": "CREATE INDEX IF NOT EXISTS idx_sessions_user ON sessions(user_id)"
                              },
                              {
                                "type": "literal",
                                "value": "CREATE INDEX IF NOT EXISTS idx_audit_user ON audit_log(user_id)"
                              },
                              {
                                "type": "literal",
                                "value": "CREATE INDEX IF NOT EXISTS idx_audit_timestamp ON audit_log(timestamp)"
                              },
                              {
                                "type": "literal",
                                "value": "CREATE INDEX IF NOT EXISTS idx_simulations_user ON simulation_results(user_id)"
                              }
                            ]
                          }
                        ]
                      },
                      {
                        "type": "call",
                        "fun": "for",
                        "args": [
                          {
                            "type": "name",
                            "value": "idx"
                          },
                          {
                            "type": "name",
                            "value": "indices"
                          },
                          {
                            "type": "call",
                            "fun": "{",
                            "args": [
                              {
                                "type": "call",
                                "fun": "dbExecute",
                                "args": [
                                  {
                                    "type": "name",
                                    "value": "con"
                                  },
                                  {
                                    "type": "name",
                                    "value": "idx"
                                  }
                                ]
                              }
                            ]
                          }
                        ]
                      },
                      {
                        "type": "call",
                        "fun": "return",
                        "args": [
                          {
                            "type": "name",
                            "value": "con"
                          }
                        ]
                      }
                    ]
                  },
                  {
                    "type": "NULL",
                    "value": []
                  }
                ]
              }
            ]
          },
          {
            "type": "call",
            "fun": "expect_no_error",
            "args": [
              {
                "type": "call",
                "fun": "{",
                "args": [
                  {
                    "type": "call",
                    "fun": "<-",
                    "args": [
                      {
                        "type": "name",
                        "value": "con"
                      },
                      {
                        "type": "call",
                        "fun": "init_database",
                        "args": []
                      }
                    ]
                  }
                ]
              }
            ]
          },
          {
            "type": "call",
            "fun": "<-",
            "args": [
              {
                "type": "name",
                "value": "con"
              },
              {
                "type": "call",
                "fun": "init_database",
                "args": []
              }
            ]
          },
          {
            "type": "call",
            "fun": "<-",
            "args": [
              {
                "type": "name",
                "value": "tables"
              },
              {
                "type": "call",
                "fun": "dbListTables",
                "args": [
                  {
                    "type": "name",
                    "value": "con"
                  }
                ]
              }
            ]
          },
          {
            "type": "call",
            "fun": "expect_true",
            "args": [
              {
                "type": "call",
                "fun": "%in%",
                "args": [
                  {
                    "type": "literal",
                    "value": "users"
                  },
                  {
                    "type": "name",
                    "value": "tables"
                  }
                ]
              }
            ]
          },
          {
            "type": "call",
            "fun": "expect_true",
            "args": [
              {
                "type": "call",
                "fun": "%in%",
                "args": [
                  {
                    "type": "literal",
                    "value": "sessions"
                  },
                  {
                    "type": "name",
                    "value": "tables"
                  }
                ]
              }
            ]
          },
          {
            "type": "call",
            "fun": "expect_true",
            "args": [
              {
                "type": "call",
                "fun": "%in%",
                "args": [
                  {
                    "type": "literal",
                    "value": "audit_log"
                  },
                  {
                    "type": "name",
                    "value": "tables"
                  }
                ]
              }
            ]
          },
          {
            "type": "call",
            "fun": "expect_true",
            "args": [
              {
                "type": "call",
                "fun": "%in%",
                "args": [
                  {
                    "type": "literal",
                    "value": "pk_models"
                  },
                  {
                    "type": "name",
                    "value": "tables"
                  }
                ]
              }
            ]
          },
          {
            "type": "call",
            "fun": "expect_true",
            "args": [
              {
                "type": "call",
                "fun": "%in%",
                "args": [
                  {
                    "type": "literal",
                    "value": "simulation_results"
                  },
                  {
                    "type": "name",
                    "value": "tables"
                  }
                ]
              }
            ]
          },
          {
            "type": "call",
            "fun": "expect_no_error",
            "args": [
              {
                "type": "call",
                "fun": "{",
                "args": [
                  {
                    "type": "call",
                    "fun": "dbExecute",
                    "args": {
                      "1": {
                        "type": "name",
                        "value": "con"
                      },
                      "2": {
                        "type": "literal",
                        "value": "INSERT INTO users (username, password_hash, email) VALUES (?, ?, ?)"
                      },
                      "params": {
                        "type": "call",
                        "fun": "list",
                        "args": [
                          {
                            "type": "literal",
                            "value": "testuser"
                          },
                          {
                            "type": "literal",
                            "value": "hash123"
                          },
                          {
                            "type": "literal",
                            "value": "test@example.com"
                          }
                        ]
                      }
                    }
                  }
                ]
              }
            ]
          },
          {
            "type": "call",
            "fun": "<-",
            "args": [
              {
                "type": "name",
                "value": "users"
              },
              {
                "type": "call",
                "fun": "dbGetQuery",
                "args": [
                  {
                    "type": "name",
                    "value": "con"
                  },
                  {
                    "type": "literal",
                    "value": "SELECT * FROM users"
                  }
                ]
              }
            ]
          },
          {
            "type": "call",
            "fun": "expect_equal",
            "args": [
              {
                "type": "call",
                "fun": "nrow",
                "args": [
                  {
                    "type": "name",
                    "value": "users"
                  }
                ]
              },
              {
                "type": "literal",
                "value": 1
              }
            ]
          },
          {
            "type": "call",
            "fun": "expect_equal",
            "args": [
              {
                "type": "call",
                "fun": "[",
                "args": [
                  {
                    "type": "call",
                    "fun": "$",
                    "args": [
                      {
                        "type": "name",
                        "value": "users"
                      },
                      {
                        "type": "name",
                        "value": "username"
                      }
                    ]
                  },
                  {
                    "type": "literal",
                    "value": 1
                  }
                ]
              },
              {
                "type": "literal",
                "value": "testuser"
              }
            ]
          },
          {
            "type": "call",
            "fun": "dbDisconnect",
            "args": [
              {
                "type": "name",
                "value": "con"
              }
            ]
          }
        ]
      }
    ]
  },
  {
    "type": "call",
    "fun": "test_that",
    "args": [
      {
        "type": "literal",
        "value": "Complete PK simulation workflow executes successfully"
      },
      {
        "type": "call",
        "fun": "{",
        "args": [
          {
            "type": "call",
            "fun": "<-",
            "args": [
              {
                "type": "name",
                "value": "run_pk_simulation"
              },
              {
                "type": "call",
                "fun": "function",
                "args": [
                  {
                    "type": "pairlist",
                    "value": ["", "", "1C"]
                  },
                  {
                    "type": "call",
                    "fun": "{",
                    "args": [
                      {
                        "type": "call",
                        "fun": "if",
                        "args": [
                          {
                            "type": "call",
                            "fun": "||",
                            "args": [
                              {
                                "type": "call",
                                "fun": "is.null",
                                "args": [
                                  {
                                    "type": "name",
                                    "value": "params"
                                  }
                                ]
                              },
                              {
                                "type": "call",
                                "fun": "is.null",
                                "args": [
                                  {
                                    "type": "name",
                                    "value": "regimen"
                                  }
                                ]
                              }
                            ]
                          },
                          {
                            "type": "call",
                            "fun": "{",
                            "args": [
                              {
                                "type": "call",
                                "fun": "stop",
                                "args": [
                                  {
                                    "type": "literal",
                                    "value": "Parameters and regimen are required"
                                  }
                                ]
                              }
                            ]
                          }
                        ]
                      },
                      {
                        "type": "call",
                        "fun": "<-",
                        "args": [
                          {
                            "type": "name",
                            "value": "required_params"
                          },
                          {
                            "type": "call",
                            "fun": "switch",
                            "args": {
                              "1": {
                                "type": "name",
                                "value": "model_type"
                              },
                              "1C": {
                                "type": "call",
                                "fun": "c",
                                "args": [
                                  {
                                    "type": "literal",
                                    "value": "CL"
                                  },
                                  {
                                    "type": "literal",
                                    "value": "Vc"
                                  }
                                ]
                              },
                              "2C": {
                                "type": "call",
                                "fun": "c",
                                "args": [
                                  {
                                    "type": "literal",
                                    "value": "CL"
                                  },
                                  {
                                    "type": "literal",
                                    "value": "Vc"
                                  },
                                  {
                                    "type": "literal",
                                    "value": "Q"
                                  },
                                  {
                                    "type": "literal",
                                    "value": "Vp"
                                  }
                                ]
                              },
                              "3C": {
                                "type": "call",
                                "fun": "c",
                                "args": [
                                  {
                                    "type": "literal",
                                    "value": "CL"
                                  },
                                  {
                                    "type": "literal",
                                    "value": "Vc"
                                  },
                                  {
                                    "type": "literal",
                                    "value": "Q1"
                                  },
                                  {
                                    "type": "literal",
                                    "value": "Vp1"
                                  },
                                  {
                                    "type": "literal",
                                    "value": "Q2"
                                  },
                                  {
                                    "type": "literal",
                                    "value": "Vp2"
                                  }
                                ]
                              },
                              "5": {
                                "type": "call",
                                "fun": "stop",
                                "args": [
                                  {
                                    "type": "literal",
                                    "value": "Unknown model type"
                                  }
                                ]
                              }
                            }
                          }
                        ]
                      },
                      {
                        "type": "call",
                        "fun": "if",
                        "args": [
                          {
                            "type": "call",
                            "fun": "!",
                            "args": [
                              {
                                "type": "call",
                                "fun": "all",
                                "args": [
                                  {
                                    "type": "call",
                                    "fun": "%in%",
                                    "args": [
                                      {
                                        "type": "name",
                                        "value": "required_params"
                                      },
                                      {
                                        "type": "call",
                                        "fun": "names",
                                        "args": [
                                          {
                                            "type": "name",
                                            "value": "params"
                                          }
                                        ]
                                      }
                                    ]
                                  }
                                ]
                              }
                            ]
                          },
                          {
                            "type": "call",
                            "fun": "{",
                            "args": [
                              {
                                "type": "call",
                                "fun": "stop",
                                "args": [
                                  {
                                    "type": "literal",
                                    "value": "Missing required parameters for model type "
                                  },
                                  {
                                    "type": "name",
                                    "value": "model_type"
                                  }
                                ]
                              }
                            ]
                          }
                        ]
                      },
                      {
                        "type": "call",
                        "fun": "<-",
                        "args": [
                          {
                            "type": "name",
                            "value": "required_regimen"
                          },
                          {
                            "type": "call",
                            "fun": "c",
                            "args": [
                              {
                                "type": "literal",
                                "value": "dose"
                              },
                              {
                                "type": "literal",
                                "value": "tau"
                              },
                              {
                                "type": "literal",
                                "value": "n_doses"
                              }
                            ]
                          }
                        ]
                      },
                      {
                        "type": "call",
                        "fun": "if",
                        "args": [
                          {
                            "type": "call",
                            "fun": "!",
                            "args": [
                              {
                                "type": "call",
                                "fun": "all",
                                "args": [
                                  {
                                    "type": "call",
                                    "fun": "%in%",
                                    "args": [
                                      {
                                        "type": "name",
                                        "value": "required_regimen"
                                      },
                                      {
                                        "type": "call",
                                        "fun": "names",
                                        "args": [
                                          {
                                            "type": "name",
                                            "value": "regimen"
                                          }
                                        ]
                                      }
                                    ]
                                  }
                                ]
                              }
                            ]
                          },
                          {
                            "type": "call",
                            "fun": "{",
                            "args": [
                              {
                                "type": "call",
                                "fun": "stop",
                                "args": [
                                  {
                                    "type": "literal",
                                    "value": "Missing required regimen parameters"
                                  }
                                ]
                              }
                            ]
                          }
                        ]
                      },
                      {
                        "type": "call",
                        "fun": "<-",
                        "args": [
                          {
                            "type": "name",
                            "value": "n_time_points"
                          },
                          {
                            "type": "literal",
                            "value": 1000
                          }
                        ]
                      },
                      {
                        "type": "call",
                        "fun": "<-",
                        "args": [
                          {
                            "type": "name",
                            "value": "t_max"
                          },
                          {
                            "type": "call",
                            "fun": "*",
                            "args": [
                              {
                                "type": "call",
                                "fun": "$",
                                "args": [
                                  {
                                    "type": "name",
                                    "value": "regimen"
                                  },
                                  {
                                    "type": "name",
                                    "value": "n_doses"
                                  }
                                ]
                              },
                              {
                                "type": "call",
                                "fun": "$",
                                "args": [
                                  {
                                    "type": "name",
                                    "value": "regimen"
                                  },
                                  {
                                    "type": "name",
                                    "value": "tau"
                                  }
                                ]
                              }
                            ]
                          }
                        ]
                      },
                      {
                        "type": "call",
                        "fun": "<-",
                        "args": [
                          {
                            "type": "name",
                            "value": "times"
                          },
                          {
                            "type": "call",
                            "fun": "seq",
                            "args": {
                              "1": {
                                "type": "literal",
                                "value": 0
                              },
                              "2": {
                                "type": "name",
                                "value": "t_max"
                              },
                              "length.out": {
                                "type": "name",
                                "value": "n_time_points"
                              }
                            }
                          }
                        ]
                      },
                      {
                        "type": "call",
                        "fun": "if",
                        "args": [
                          {
                            "type": "call",
                            "fun": "==",
                            "args": [
                              {
                                "type": "name",
                                "value": "model_type"
                              },
                              {
                                "type": "literal",
                                "value": "1C"
                              }
                            ]
                          },
                          {
                            "type": "call",
                            "fun": "{",
                            "args": [
                              {
                                "type": "call",
                                "fun": "<-",
                                "args": [
                                  {
                                    "type": "name",
                                    "value": "k_el"
                                  },
                                  {
                                    "type": "call",
                                    "fun": "/",
                                    "args": [
                                      {
                                        "type": "call",
                                        "fun": "$",
                                        "args": [
                                          {
                                            "type": "name",
                                            "value": "params"
                                          },
                                          {
                                            "type": "name",
                                            "value": "CL"
                                          }
                                        ]
                                      },
                                      {
                                        "type": "call",
                                        "fun": "$",
                                        "args": [
                                          {
                                            "type": "name",
                                            "value": "params"
                                          },
                                          {
                                            "type": "name",
                                            "value": "Vc"
                                          }
                                        ]
                                      }
                                    ]
                                  }
                                ]
                              },
                              {
                                "type": "call",
                                "fun": "<-",
                                "args": [
                                  {
                                    "type": "name",
                                    "value": "concentrations"
                                  },
                                  {
                                    "type": "call",
                                    "fun": "numeric",
                                    "args": [
                                      {
                                        "type": "call",
                                        "fun": "length",
                                        "args": [
                                          {
                                            "type": "name",
                                            "value": "times"
                                          }
                                        ]
                                      }
                                    ]
                                  }
                                ]
                              },
                              {
                                "type": "call",
                                "fun": "for",
                                "args": [
                                  {
                                    "type": "name",
                                    "value": "dose_num"
                                  },
                                  {
                                    "type": "call",
                                    "fun": ":",
                                    "args": [
                                      {
                                        "type": "literal",
                                        "value": 1
                                      },
                                      {
                                        "type": "call",
                                        "fun": "$",
                                        "args": [
                                          {
                                            "type": "name",
                                            "value": "regimen"
                                          },
                                          {
                                            "type": "name",
                                            "value": "n_doses"
                                          }
                                        ]
                                      }
                                    ]
                                  },
                                  {
                                    "type": "call",
                                    "fun": "{",
                                    "args": [
                                      {
                                        "type": "call",
                                        "fun": "<-",
                                        "args": [
                                          {
                                            "type": "name",
                                            "value": "dose_time"
                                          },
                                          {
                                            "type": "call",
                                            "fun": "*",
                                            "args": [
                                              {
                                                "type": "call",
                                                "fun": "(",
                                                "args": [
                                                  {
                                                    "type": "call",
                                                    "fun": "-",
                                                    "args": [
                                                      {
                                                        "type": "name",
                                                        "value": "dose_num"
                                                      },
                                                      {
                                                        "type": "literal",
                                                        "value": 1
                                                      }
                                                    ]
                                                  }
                                                ]
                                              },
                                              {
                                                "type": "call",
                                                "fun": "$",
                                                "args": [
                                                  {
                                                    "type": "name",
                                                    "value": "regimen"
                                                  },
                                                  {
                                                    "type": "name",
                                                    "value": "tau"
                                                  }
                                                ]
                                              }
                                            ]
                                          }
                                        ]
                                      },
                                      {
                                        "type": "call",
                                        "fun": "for",
                                        "args": [
                                          {
                                            "type": "name",
                                            "value": "i"
                                          },
                                          {
                                            "type": "call",
                                            "fun": ":",
                                            "args": [
                                              {
                                                "type": "literal",
                                                "value": 1
                                              },
                                              {
                                                "type": "call",
                                                "fun": "length",
                                                "args": [
                                                  {
                                                    "type": "name",
                                                    "value": "times"
                                                  }
                                                ]
                                              }
                                            ]
                                          },
                                          {
                                            "type": "call",
                                            "fun": "{",
                                            "args": [
                                              {
                                                "type": "call",
                                                "fun": "if",
                                                "args": [
                                                  {
                                                    "type": "call",
                                                    "fun": ">=",
                                                    "args": [
                                                      {
                                                        "type": "call",
                                                        "fun": "[",
                                                        "args": [
                                                          {
                                                            "type": "name",
                                                            "value": "times"
                                                          },
                                                          {
                                                            "type": "name",
                                                            "value": "i"
                                                          }
                                                        ]
                                                      },
                                                      {
                                                        "type": "name",
                                                        "value": "dose_time"
                                                      }
                                                    ]
                                                  },
                                                  {
                                                    "type": "call",
                                                    "fun": "{",
                                                    "args": [
                                                      {
                                                        "type": "call",
                                                        "fun": "<-",
                                                        "args": [
                                                          {
                                                            "type": "name",
                                                            "value": "t_after_dose"
                                                          },
                                                          {
                                                            "type": "call",
                                                            "fun": "-",
                                                            "args": [
                                                              {
                                                                "type": "call",
                                                                "fun": "[",
                                                                "args": [
                                                                  {
                                                                    "type": "name",
                                                                    "value": "times"
                                                                  },
                                                                  {
                                                                    "type": "name",
                                                                    "value": "i"
                                                                  }
                                                                ]
                                                              },
                                                              {
                                                                "type": "name",
                                                                "value": "dose_time"
                                                              }
                                                            ]
                                                          }
                                                        ]
                                                      },
                                                      {
                                                        "type": "call",
                                                        "fun": "if",
                                                        "args": [
                                                          {
                                                            "type": "call",
                                                            "fun": "<",
                                                            "args": [
                                                              {
                                                                "type": "name",
                                                                "value": "t_after_dose"
                                                              },
                                                              {
                                                                "type": "call",
                                                                "fun": "$",
                                                                "args": [
                                                                  {
                                                                    "type": "name",
                                                                    "value": "regimen"
                                                                  },
                                                                  {
                                                                    "type": "name",
                                                                    "value": "tau"
                                                                  }
                                                                ]
                                                              }
                                                            ]
                                                          },
                                                          {
                                                            "type": "call",
                                                            "fun": "{",
                                                            "args": [
                                                              {
                                                                "type": "call",
                                                                "fun": "<-",
                                                                "args": [
                                                                  {
                                                                    "type": "name",
                                                                    "value": "C_single"
                                                                  },
                                                                  {
                                                                    "type": "call",
                                                                    "fun": "*",
                                                                    "args": [
                                                                      {
                                                                        "type": "call",
                                                                        "fun": "(",
                                                                        "args": [
                                                                          {
                                                                            "type": "call",
                                                                            "fun": "/",
                                                                            "args": [
                                                                              {
                                                                                "type": "call",
                                                                                "fun": "$",
                                                                                "args": [
                                                                                  {
                                                                                    "type": "name",
                                                                                    "value": "regimen"
                                                                                  },
                                                                                  {
                                                                                    "type": "name",
                                                                                    "value": "dose"
                                                                                  }
                                                                                ]
                                                                              },
                                                                              {
                                                                                "type": "call",
                                                                                "fun": "$",
                                                                                "args": [
                                                                                  {
                                                                                    "type": "name",
                                                                                    "value": "params"
                                                                                  },
                                                                                  {
                                                                                    "type": "name",
                                                                                    "value": "Vc"
                                                                                  }
                                                                                ]
                                                                              }
                                                                            ]
                                                                          }
                                                                        ]
                                                                      },
                                                                      {
                                                                        "type": "call",
                                                                        "fun": "exp",
                                                                        "args": [
                                                                          {
                                                                            "type": "call",
                                                                            "fun": "*",
                                                                            "args": [
                                                                              {
                                                                                "type": "call",
                                                                                "fun": "-",
                                                                                "args": [
                                                                                  {
                                                                                    "type": "name",
                                                                                    "value": "k_el"
                                                                                  }
                                                                                ]
                                                                              },
                                                                              {
                                                                                "type": "name",
                                                                                "value": "t_after_dose"
                                                                              }
                                                                            ]
                                                                          }
                                                                        ]
                                                                      }
                                                                    ]
                                                                  }
                                                                ]
                                                              },
                                                              {
                                                                "type": "call",
                                                                "fun": "<-",
                                                                "args": [
                                                                  {
                                                                    "type": "call",
                                                                    "fun": "[",
                                                                    "args": [
                                                                      {
                                                                        "type": "name",
                                                                        "value": "concentrations"
                                                                      },
                                                                      {
                                                                        "type": "name",
                                                                        "value": "i"
                                                                      }
                                                                    ]
                                                                  },
                                                                  {
                                                                    "type": "call",
                                                                    "fun": "+",
                                                                    "args": [
                                                                      {
                                                                        "type": "call",
                                                                        "fun": "[",
                                                                        "args": [
                                                                          {
                                                                            "type": "name",
                                                                            "value": "concentrations"
                                                                          },
                                                                          {
                                                                            "type": "name",
                                                                            "value": "i"
                                                                          }
                                                                        ]
                                                                      },
                                                                      {
                                                                        "type": "name",
                                                                        "value": "C_single"
                                                                      }
                                                                    ]
                                                                  }
                                                                ]
                                                              }
                                                            ]
                                                          }
                                                        ]
                                                      }
                                                    ]
                                                  }
                                                ]
                                              }
                                            ]
                                          }
                                        ]
                                      }
                                    ]
                                  }
                                ]
                              }
                            ]
                          },
                          {
                            "type": "call",
                            "fun": "{",
                            "args": [
                              {
                                "type": "call",
                                "fun": "stop",
                                "args": [
                                  {
                                    "type": "literal",
                                    "value": "Only 1C model implemented in test"
                                  }
                                ]
                              }
                            ]
                          }
                        ]
                      },
                      {
                        "type": "call",
                        "fun": "<-",
                        "args": [
                          {
                            "type": "name",
                            "value": "Cmax"
                          },
                          {
                            "type": "call",
                            "fun": "max",
                            "args": [
                              {
                                "type": "name",
                                "value": "concentrations"
                              }
                            ]
                          }
                        ]
                      },
                      {
                        "type": "call",
                        "fun": "<-",
                        "args": [
                          {
                            "type": "name",
                            "value": "Cmin"
                          },
                          {
                            "type": "call",
                            "fun": "min",
                            "args": [
                              {
                                "type": "call",
                                "fun": "[",
                                "args": [
                                  {
                                    "type": "name",
                                    "value": "concentrations"
                                  },
                                  {
                                    "type": "call",
                                    "fun": ">",
                                    "args": [
                                      {
                                        "type": "name",
                                        "value": "concentrations"
                                      },
                                      {
                                        "type": "literal",
                                        "value": 0
                                      }
                                    ]
                                  }
                                ]
                              }
                            ]
                          }
                        ]
                      },
                      {
                        "type": "call",
                        "fun": "<-",
                        "args": [
                          {
                            "type": "name",
                            "value": "AUC"
                          },
                          {
                            "type": "call",
                            "fun": "sum",
                            "args": [
                              {
                                "type": "call",
                                "fun": "/",
                                "args": [
                                  {
                                    "type": "call",
                                    "fun": "*",
                                    "args": [
                                      {
                                        "type": "call",
                                        "fun": "diff",
                                        "args": [
                                          {
                                            "type": "name",
                                            "value": "times"
                                          }
                                        ]
                                      },
                                      {
                                        "type": "call",
                                        "fun": "(",
                                        "args": [
                                          {
                                            "type": "call",
                                            "fun": "+",
                                            "args": [
                                              {
                                                "type": "call",
                                                "fun": "[",
                                                "args": [
                                                  {
                                                    "type": "name",
                                                    "value": "concentrations"
                                                  },
                                                  {
                                                    "type": "call",
                                                    "fun": "-",
                                                    "args": [
                                                      {
                                                        "type": "literal",
                                                        "value": 1
                                                      }
                                                    ]
                                                  }
                                                ]
                                              },
                                              {
                                                "type": "call",
                                                "fun": "[",
                                                "args": [
                                                  {
                                                    "type": "name",
                                                    "value": "concentrations"
                                                  },
                                                  {
                                                    "type": "call",
                                                    "fun": "-",
                                                    "args": [
                                                      {
                                                        "type": "call",
                                                        "fun": "length",
                                                        "args": [
                                                          {
                                                            "type": "name",
                                                            "value": "concentrations"
                                                          }
                                                        ]
                                                      }
                                                    ]
                                                  }
                                                ]
                                              }
                                            ]
                                          }
                                        ]
                                      }
                                    ]
                                  },
                                  {
                                    "type": "literal",
                                    "value": 2
                                  }
                                ]
                              }
                            ]
                          }
                        ]
                      },
                      {
                        "type": "call",
                        "fun": "return",
                        "args": [
                          {
                            "type": "call",
                            "fun": "list",
                            "args": {
                              "times": {
                                "type": "name",
                                "value": "times"
                              },
                              "concentrations": {
                                "type": "name",
                                "value": "concentrations"
                              },
                              "metrics": {
                                "type": "call",
                                "fun": "list",
                                "args": {
                                  "Cmax": {
                                    "type": "name",
                                    "value": "Cmax"
                                  },
                                  "Cmin": {
                                    "type": "name",
                                    "value": "Cmin"
                                  },
                                  "AUC": {
                                    "type": "name",
                                    "value": "AUC"
                                  },
                                  "CL_calculated": {
                                    "type": "call",
                                    "fun": "/",
                                    "args": [
                                      {
                                        "type": "call",
                                        "fun": "*",
                                        "args": [
                                          {
                                            "type": "call",
                                            "fun": "$",
                                            "args": [
                                              {
                                                "type": "name",
                                                "value": "regimen"
                                              },
                                              {
                                                "type": "name",
                                                "value": "dose"
                                              }
                                            ]
                                          },
                                          {
                                            "type": "call",
                                            "fun": "$",
                                            "args": [
                                              {
                                                "type": "name",
                                                "value": "regimen"
                                              },
                                              {
                                                "type": "name",
                                                "value": "n_doses"
                                              }
                                            ]
                                          }
                                        ]
                                      },
                                      {
                                        "type": "name",
                                        "value": "AUC"
                                      }
                                    ]
                                  }
                                }
                              },
                              "params": {
                                "type": "name",
                                "value": "params"
                              },
                              "regimen": {
                                "type": "name",
                                "value": "regimen"
                              },
                              "model_type": {
                                "type": "name",
                                "value": "model_type"
                              }
                            }
                          }
                        ]
                      }
                    ]
                  },
                  {
                    "type": "NULL",
                    "value": []
                  }
                ]
              }
            ]
          },
          {
            "type": "call",
            "fun": "<-",
            "args": [
              {
                "type": "name",
                "value": "test_params"
              },
              {
                "type": "call",
                "fun": "list",
                "args": {
                  "CL": {
                    "type": "literal",
                    "value": 5
                  },
                  "Vc": {
                    "type": "literal",
                    "value": 30
                  }
                }
              }
            ]
          },
          {
            "type": "call",
            "fun": "<-",
            "args": [
              {
                "type": "name",
                "value": "test_regimen"
              },
              {
                "type": "call",
                "fun": "list",
                "args": {
                  "dose": {
                    "type": "literal",
                    "value": 1000
                  },
                  "tau": {
                    "type": "literal",
                    "value": 8
                  },
                  "n_doses": {
                    "type": "literal",
                    "value": 3
                  }
                }
              }
            ]
          },
          {
            "type": "call",
            "fun": "expect_no_error",
            "args": [
              {
                "type": "call",
                "fun": "{",
                "args": [
                  {
                    "type": "call",
                    "fun": "<-",
                    "args": [
                      {
                        "type": "name",
                        "value": "result"
                      },
                      {
                        "type": "call",
                        "fun": "run_pk_simulation",
                        "args": [
                          {
                            "type": "name",
                            "value": "test_params"
                          },
                          {
                            "type": "name",
                            "value": "test_regimen"
                          },
                          {
                            "type": "literal",
                            "value": "1C"
                          }
                        ]
                      }
                    ]
                  }
                ]
              }
            ]
          },
          {
            "type": "call",
            "fun": "<-",
            "args": [
              {
                "type": "name",
                "value": "result"
              },
              {
                "type": "call",
                "fun": "run_pk_simulation",
                "args": [
                  {
                    "type": "name",
                    "value": "test_params"
                  },
                  {
                    "type": "name",
                    "value": "test_regimen"
                  },
                  {
                    "type": "literal",
                    "value": "1C"
                  }
                ]
              }
            ]
          },
          {
            "type": "call",
            "fun": "expect_true",
            "args": [
              {
                "type": "call",
                "fun": "!",
                "args": [
                  {
                    "type": "call",
                    "fun": "is.null",
                    "args": [
                      {
                        "type": "call",
                        "fun": "$",
                        "args": [
                          {
                            "type": "name",
                            "value": "result"
                          },
                          {
                            "type": "name",
                            "value": "times"
                          }
                        ]
                      }
                    ]
                  }
                ]
              }
            ]
          },
          {
            "type": "call",
            "fun": "expect_true",
            "args": [
              {
                "type": "call",
                "fun": "!",
                "args": [
                  {
                    "type": "call",
                    "fun": "is.null",
                    "args": [
                      {
                        "type": "call",
                        "fun": "$",
                        "args": [
                          {
                            "type": "name",
                            "value": "result"
                          },
                          {
                            "type": "name",
                            "value": "concentrations"
                          }
                        ]
                      }
                    ]
                  }
                ]
              }
            ]
          },
          {
            "type": "call",
            "fun": "expect_true",
            "args": [
              {
                "type": "call",
                "fun": "!",
                "args": [
                  {
                    "type": "call",
                    "fun": "is.null",
                    "args": [
                      {
                        "type": "call",
                        "fun": "$",
                        "args": [
                          {
                            "type": "name",
                            "value": "result"
                          },
                          {
                            "type": "name",
                            "value": "metrics"
                          }
                        ]
                      }
                    ]
                  }
                ]
              }
            ]
          },
          {
            "type": "call",
            "fun": "expect_equal",
            "args": [
              {
                "type": "call",
                "fun": "length",
                "args": [
                  {
                    "type": "call",
                    "fun": "$",
                    "args": [
                      {
                        "type": "name",
                        "value": "result"
                      },
                      {
                        "type": "name",
                        "value": "times"
                      }
                    ]
                  }
                ]
              },
              {
                "type": "call",
                "fun": "length",
                "args": [
                  {
                    "type": "call",
                    "fun": "$",
                    "args": [
                      {
                        "type": "name",
                        "value": "result"
                      },
                      {
                        "type": "name",
                        "value": "concentrations"
                      }
                    ]
                  }
                ]
              }
            ]
          },
          {
            "type": "call",
            "fun": "expect_true",
            "args": [
              {
                "type": "call",
                "fun": ">",
                "args": [
                  {
                    "type": "call",
                    "fun": "$",
                    "args": [
                      {
                        "type": "call",
                        "fun": "$",
                        "args": [
                          {
                            "type": "name",
                            "value": "result"
                          },
                          {
                            "type": "name",
                            "value": "metrics"
                          }
                        ]
                      },
                      {
                        "type": "name",
                        "value": "Cmax"
                      }
                    ]
                  },
                  {
                    "type": "literal",
                    "value": 0
                  }
                ]
              }
            ]
          },
          {
            "type": "call",
            "fun": "expect_true",
            "args": [
              {
                "type": "call",
                "fun": ">=",
                "args": [
                  {
                    "type": "call",
                    "fun": "$",
                    "args": [
                      {
                        "type": "call",
                        "fun": "$",
                        "args": [
                          {
                            "type": "name",
                            "value": "result"
                          },
                          {
                            "type": "name",
                            "value": "metrics"
                          }
                        ]
                      },
                      {
                        "type": "name",
                        "value": "Cmin"
                      }
                    ]
                  },
                  {
                    "type": "literal",
                    "value": 0
                  }
                ]
              }
            ]
          },
          {
            "type": "call",
            "fun": "expect_true",
            "args": [
              {
                "type": "call",
                "fun": ">",
                "args": [
                  {
                    "type": "call",
                    "fun": "$",
                    "args": [
                      {
                        "type": "call",
                        "fun": "$",
                        "args": [
                          {
                            "type": "name",
                            "value": "result"
                          },
                          {
                            "type": "name",
                            "value": "metrics"
                          }
                        ]
                      },
                      {
                        "type": "name",
                        "value": "AUC"
                      }
                    ]
                  },
                  {
                    "type": "literal",
                    "value": 0
                  }
                ]
              }
            ]
          },
          {
            "type": "call",
            "fun": "expect_true",
            "args": [
              {
                "type": "call",
                "fun": ">",
                "args": [
                  {
                    "type": "call",
                    "fun": "$",
                    "args": [
                      {
                        "type": "call",
                        "fun": "$",
                        "args": [
                          {
                            "type": "name",
                            "value": "result"
                          },
                          {
                            "type": "name",
                            "value": "metrics"
                          }
                        ]
                      },
                      {
                        "type": "name",
                        "value": "Cmax"
                      }
                    ]
                  },
                  {
                    "type": "call",
                    "fun": "$",
                    "args": [
                      {
                        "type": "call",
                        "fun": "$",
                        "args": [
                          {
                            "type": "name",
                            "value": "result"
                          },
                          {
                            "type": "name",
                            "value": "metrics"
                          }
                        ]
                      },
                      {
                        "type": "name",
                        "value": "Cmin"
                      }
                    ]
                  }
                ]
              }
            ]
          }
        ]
      }
    ]
  },
  {
    "type": "call",
    "fun": "test_that",
    "args": [
      {
        "type": "literal",
        "value": "Error handling and recovery works properly"
      },
      {
        "type": "call",
        "fun": "{",
        "args": [
          {
            "type": "call",
            "fun": "<-",
            "args": [
              {
                "type": "name",
                "value": "safe_computation"
              },
              {
                "type": "call",
                "fun": "function",
                "args": [
                  {
                    "type": "pairlist",
                    "value": ["", "", "NULL"]
                  },
                  {
                    "type": "call",
                    "fun": "{",
                    "args": [
                      {
                        "type": "call",
                        "fun": "tryCatch",
                        "args": {
                          "1": {
                            "type": "call",
                            "fun": "{",
                            "args": [
                              {
                                "type": "call",
                                "fun": "<-",
                                "args": [
                                  {
                                    "type": "name",
                                    "value": "result"
                                  },
                                  {
                                    "type": "call",
                                    "fun": "func",
                                    "args": [
                                      {
                                        "type": "name",
                                        "value": "..."
                                      }
                                    ]
                                  }
                                ]
                              },
                              {
                                "type": "call",
                                "fun": "return",
                                "args": [
                                  {
                                    "type": "call",
                                    "fun": "list",
                                    "args": {
                                      "success": {
                                        "type": "literal",
                                        "value": true
                                      },
                                      "result": {
                                        "type": "name",
                                        "value": "result"
                                      },
                                      "error": {
                                        "type": "NULL",
                                        "value": []
                                      }
                                    }
                                  }
                                ]
                              }
                            ]
                          },
                          "error": {
                            "type": "call",
                            "fun": "function",
                            "args": [
                              {
                                "type": "pairlist",
                                "value": ""
                              },
                              {
                                "type": "call",
                                "fun": "{",
                                "args": [
                                  {
                                    "type": "call",
                                    "fun": "return",
                                    "args": [
                                      {
                                        "type": "call",
                                        "fun": "list",
                                        "args": {
                                          "success": {
                                            "type": "literal",
                                            "value": false
                                          },
                                          "result": {
                                            "type": "name",
                                            "value": "default"
                                          },
                                          "error": {
                                            "type": "call",
                                            "fun": "as.character",
                                            "args": [
                                              {
                                                "type": "call",
                                                "fun": "$",
                                                "args": [
                                                  {
                                                    "type": "name",
                                                    "value": "e"
                                                  },
                                                  {
                                                    "type": "name",
                                                    "value": "message"
                                                  }
                                                ]
                                              }
                                            ]
                                          }
                                        }
                                      }
                                    ]
                                  }
                                ]
                              },
                              {
                                "type": "NULL",
                                "value": []
                              }
                            ]
                          }
                        }
                      }
                    ]
                  },
                  {
                    "type": "NULL",
                    "value": []
                  }
                ]
              }
            ]
          },
          {
            "type": "call",
            "fun": "<-",
            "args": [
              {
                "type": "name",
                "value": "success_result"
              },
              {
                "type": "call",
                "fun": "safe_computation",
                "args": {
                  "1": {
                    "type": "call",
                    "fun": "function",
                    "args": [
                      {
                        "type": "pairlist",
                        "value": ""
                      },
                      {
                        "type": "call",
                        "fun": "*",
                        "args": [
                          {
                            "type": "name",
                            "value": "x"
                          },
                          {
                            "type": "literal",
                            "value": 2
                          }
                        ]
                      },
                      {
                        "type": "NULL",
                        "value": []
                      }
                    ]
                  },
                  "x": {
                    "type": "literal",
                    "value": 5
                  }
                }
              }
            ]
          },
          {
            "type": "call",
            "fun": "expect_true",
            "args": [
              {
                "type": "call",
                "fun": "$",
                "args": [
                  {
                    "type": "name",
                    "value": "success_result"
                  },
                  {
                    "type": "name",
                    "value": "success"
                  }
                ]
              }
            ]
          },
          {
            "type": "call",
            "fun": "expect_equal",
            "args": [
              {
                "type": "call",
                "fun": "$",
                "args": [
                  {
                    "type": "name",
                    "value": "success_result"
                  },
                  {
                    "type": "name",
                    "value": "result"
                  }
                ]
              },
              {
                "type": "literal",
                "value": 10
              }
            ]
          },
          {
            "type": "call",
            "fun": "expect_null",
            "args": [
              {
                "type": "call",
                "fun": "$",
                "args": [
                  {
                    "type": "name",
                    "value": "success_result"
                  },
                  {
                    "type": "name",
                    "value": "error"
                  }
                ]
              }
            ]
          },
          {
            "type": "call",
            "fun": "<-",
            "args": [
              {
                "type": "name",
                "value": "error_result"
              },
              {
                "type": "call",
                "fun": "safe_computation",
                "args": {
                  "1": {
                    "type": "call",
                    "fun": "function",
                    "args": [
                      {
                        "type": "NULL",
                        "value": []
                      },
                      {
                        "type": "call",
                        "fun": "stop",
                        "args": [
                          {
                            "type": "literal",
                            "value": "Test error"
                          }
                        ]
                      },
                      {
                        "type": "NULL",
                        "value": []
                      }
                    ]
                  },
                  "default": {
                    "type": "literal",
                    "value": 0
                  }
                }
              }
            ]
          },
          {
            "type": "call",
            "fun": "expect_false",
            "args": [
              {
                "type": "call",
                "fun": "$",
                "args": [
                  {
                    "type": "name",
                    "value": "error_result"
                  },
                  {
                    "type": "name",
                    "value": "success"
                  }
                ]
              }
            ]
          },
          {
            "type": "call",
            "fun": "expect_equal",
            "args": [
              {
                "type": "call",
                "fun": "$",
                "args": [
                  {
                    "type": "name",
                    "value": "error_result"
                  },
                  {
                    "type": "name",
                    "value": "result"
                  }
                ]
              },
              {
                "type": "literal",
                "value": 0
              }
            ]
          },
          {
            "type": "call",
            "fun": "expect_true",
            "args": [
              {
                "type": "call",
                "fun": "grepl",
                "args": [
                  {
                    "type": "literal",
                    "value": "Test error"
                  },
                  {
                    "type": "call",
                    "fun": "$",
                    "args": [
                      {
                        "type": "name",
                        "value": "error_result"
                      },
                      {
                        "type": "name",
                        "value": "error"
                      }
                    ]
                  }
                ]
              }
            ]
          },
          {
            "type": "call",
            "fun": "<-",
            "args": [
              {
                "type": "name",
                "value": "attempts"
              },
              {
                "type": "literal",
                "value": 0
              }
            ]
          },
          {
            "type": "call",
            "fun": "<-",
            "args": [
              {
                "type": "name",
                "value": "retry_computation"
              },
              {
                "type": "call",
                "fun": "function",
                "args": [
                  {
                    "type": "pairlist",
                    "value": ["", "3"]
                  },
                  {
                    "type": "call",
                    "fun": "{",
                    "args": [
                      {
                        "type": "call",
                        "fun": "for",
                        "args": [
                          {
                            "type": "name",
                            "value": "attempt"
                          },
                          {
                            "type": "call",
                            "fun": ":",
                            "args": [
                              {
                                "type": "literal",
                                "value": 1
                              },
                              {
                                "type": "name",
                                "value": "max_attempts"
                              }
                            ]
                          },
                          {
                            "type": "call",
                            "fun": "{",
                            "args": [
                              {
                                "type": "call",
                                "fun": "<-",
                                "args": [
                                  {
                                    "type": "name",
                                    "value": "result"
                                  },
                                  {
                                    "type": "call",
                                    "fun": "safe_computation",
                                    "args": [
                                      {
                                        "type": "name",
                                        "value": "func"
                                      }
                                    ]
                                  }
                                ]
                              },
                              {
                                "type": "call",
                                "fun": "if",
                                "args": [
                                  {
                                    "type": "call",
                                    "fun": "$",
                                    "args": [
                                      {
                                        "type": "name",
                                        "value": "result"
                                      },
                                      {
                                        "type": "name",
                                        "value": "success"
                                      }
                                    ]
                                  },
                                  {
                                    "type": "call",
                                    "fun": "{",
                                    "args": [
                                      {
                                        "type": "call",
                                        "fun": "return",
                                        "args": [
                                          {
                                            "type": "name",
                                            "value": "result"
                                          }
                                        ]
                                      }
                                    ]
                                  }
                                ]
                              },
                              {
                                "type": "call",
                                "fun": "Sys.sleep",
                                "args": [
                                  {
                                    "type": "call",
                                    "fun": "*",
                                    "args": [
                                      {
                                        "type": "literal",
                                        "value": 0.1
                                      },
                                      {
                                        "type": "name",
                                        "value": "attempt"
                                      }
                                    ]
                                  }
                                ]
                              }
                            ]
                          }
                        ]
                      },
                      {
                        "type": "call",
                        "fun": "return",
                        "args": [
                          {
                            "type": "name",
                            "value": "result"
                          }
                        ]
                      }
                    ]
                  },
                  {
                    "type": "NULL",
                    "value": []
                  }
                ]
              }
            ]
          },
          {
            "type": "call",
            "fun": "<-",
            "args": [
              {
                "type": "name",
                "value": "flaky_function"
              },
              {
                "type": "call",
                "fun": "function",
                "args": [
                  {
                    "type": "NULL",
                    "value": []
                  },
                  {
                    "type": "call",
                    "fun": "{",
                    "args": [
                      {
                        "type": "call",
                        "fun": "<<-",
                        "args": [
                          {
                            "type": "name",
                            "value": "attempts"
                          },
                          {
                            "type": "call",
                            "fun": "+",
                            "args": [
                              {
                                "type": "name",
                                "value": "attempts"
                              },
                              {
                                "type": "literal",
                                "value": 1
                              }
                            ]
                          }
                        ]
                      },
                      {
                        "type": "call",
                        "fun": "if",
                        "args": [
                          {
                            "type": "call",
                            "fun": "<",
                            "args": [
                              {
                                "type": "name",
                                "value": "attempts"
                              },
                              {
                                "type": "literal",
                                "value": 3
                              }
                            ]
                          },
                          {
                            "type": "call",
                            "fun": "{",
                            "args": [
                              {
                                "type": "call",
                                "fun": "stop",
                                "args": [
                                  {
                                    "type": "literal",
                                    "value": "Temporary failure"
                                  }
                                ]
                              }
                            ]
                          }
                        ]
                      },
                      {
                        "type": "call",
                        "fun": "return",
                        "args": [
                          {
                            "type": "literal",
                            "value": "Success"
                          }
                        ]
                      }
                    ]
                  },
                  {
                    "type": "NULL",
                    "value": []
                  }
                ]
              }
            ]
          },
          {
            "type": "call",
            "fun": "<-",
            "args": [
              {
                "type": "name",
                "value": "result"
              },
              {
                "type": "call",
                "fun": "retry_computation",
                "args": [
                  {
                    "type": "name",
                    "value": "flaky_function"
                  }
                ]
              }
            ]
          },
          {
            "type": "call",
            "fun": "expect_true",
            "args": [
              {
                "type": "call",
                "fun": "$",
                "args": [
                  {
                    "type": "name",
                    "value": "result"
                  },
                  {
                    "type": "name",
                    "value": "success"
                  }
                ]
              }
            ]
          },
          {
            "type": "call",
            "fun": "expect_equal",
            "args": [
              {
                "type": "call",
                "fun": "$",
                "args": [
                  {
                    "type": "name",
                    "value": "result"
                  },
                  {
                    "type": "name",
                    "value": "result"
                  }
                ]
              },
              {
                "type": "literal",
                "value": "Success"
              }
            ]
          },
          {
            "type": "call",
            "fun": "expect_equal",
            "args": [
              {
                "type": "name",
                "value": "attempts"
              },
              {
                "type": "literal",
                "value": 3
              }
            ]
          }
        ]
      }
    ]
  },
  {
    "type": "call",
    "fun": "test_that",
    "args": [
      {
        "type": "literal",
        "value": "User input validation prevents invalid states"
      },
      {
        "type": "call",
        "fun": "{",
        "args": [
          {
            "type": "call",
            "fun": "<-",
            "args": [
              {
                "type": "name",
                "value": "validate_inputs"
              },
              {
                "type": "call",
                "fun": "function",
                "args": [
                  {
                    "type": "pairlist",
                    "value": ""
                  },
                  {
                    "type": "call",
                    "fun": "{",
                    "args": [
                      {
                        "type": "call",
                        "fun": "<-",
                        "args": [
                          {
                            "type": "name",
                            "value": "errors"
                          },
                          {
                            "type": "call",
                            "fun": "list",
                            "args": []
                          }
                        ]
                      },
                      {
                        "type": "call",
                        "fun": "<-",
                        "args": [
                          {
                            "type": "name",
                            "value": "numeric_fields"
                          },
                          {
                            "type": "call",
                            "fun": "c",
                            "args": [
                              {
                                "type": "literal",
                                "value": "dose"
                              },
                              {
                                "type": "literal",
                                "value": "weight"
                              },
                              {
                                "type": "literal",
                                "value": "clearance"
                              },
                              {
                                "type": "literal",
                                "value": "volume"
                              }
                            ]
                          }
                        ]
                      },
                      {
                        "type": "call",
                        "fun": "for",
                        "args": [
                          {
                            "type": "name",
                            "value": "field"
                          },
                          {
                            "type": "name",
                            "value": "numeric_fields"
                          },
                          {
                            "type": "call",
                            "fun": "{",
                            "args": [
                              {
                                "type": "call",
                                "fun": "if",
                                "args": [
                                  {
                                    "type": "call",
                                    "fun": "%in%",
                                    "args": [
                                      {
                                        "type": "name",
                                        "value": "field"
                                      },
                                      {
                                        "type": "call",
                                        "fun": "names",
                                        "args": [
                                          {
                                            "type": "name",
                                            "value": "inputs"
                                          }
                                        ]
                                      }
                                    ]
                                  },
                                  {
                                    "type": "call",
                                    "fun": "{",
                                    "args": [
                                      {
                                        "type": "call",
                                        "fun": "<-",
                                        "args": [
                                          {
                                            "type": "name",
                                            "value": "val"
                                          },
                                          {
                                            "type": "call",
                                            "fun": "[[",
                                            "args": [
                                              {
                                                "type": "name",
                                                "value": "inputs"
                                              },
                                              {
                                                "type": "name",
                                                "value": "field"
                                              }
                                            ]
                                          }
                                        ]
                                      },
                                      {
                                        "type": "call",
                                        "fun": "if",
                                        "args": [
                                          {
                                            "type": "call",
                                            "fun": "is.na",
                                            "args": [
                                              {
                                                "type": "call",
                                                "fun": "as.numeric",
                                                "args": [
                                                  {
                                                    "type": "name",
                                                    "value": "val"
                                                  }
                                                ]
                                              }
                                            ]
                                          },
                                          {
                                            "type": "call",
                                            "fun": "{",
                                            "args": [
                                              {
                                                "type": "call",
                                                "fun": "<-",
                                                "args": [
                                                  {
                                                    "type": "call",
                                                    "fun": "[[",
                                                    "args": [
                                                      {
                                                        "type": "name",
                                                        "value": "errors"
                                                      },
                                                      {
                                                        "type": "name",
                                                        "value": "field"
                                                      }
                                                    ]
                                                  },
                                                  {
                                                    "type": "call",
                                                    "fun": "paste",
                                                    "args": [
                                                      {
                                                        "type": "name",
                                                        "value": "field"
                                                      },
                                                      {
                                                        "type": "literal",
                                                        "value": "must be numeric"
                                                      }
                                                    ]
                                                  }
                                                ]
                                              }
                                            ]
                                          },
                                          {
                                            "type": "call",
                                            "fun": "if",
                                            "args": [
                                              {
                                                "type": "call",
                                                "fun": "<=",
                                                "args": [
                                                  {
                                                    "type": "call",
                                                    "fun": "as.numeric",
                                                    "args": [
                                                      {
                                                        "type": "name",
                                                        "value": "val"
                                                      }
                                                    ]
                                                  },
                                                  {
                                                    "type": "literal",
                                                    "value": 0
                                                  }
                                                ]
                                              },
                                              {
                                                "type": "call",
                                                "fun": "{",
                                                "args": [
                                                  {
                                                    "type": "call",
                                                    "fun": "<-",
                                                    "args": [
                                                      {
                                                        "type": "call",
                                                        "fun": "[[",
                                                        "args": [
                                                          {
                                                            "type": "name",
                                                            "value": "errors"
                                                          },
                                                          {
                                                            "type": "name",
                                                            "value": "field"
                                                          }
                                                        ]
                                                      },
                                                      {
                                                        "type": "call",
                                                        "fun": "paste",
                                                        "args": [
                                                          {
                                                            "type": "name",
                                                            "value": "field"
                                                          },
                                                          {
                                                            "type": "literal",
                                                            "value": "must be positive"
                                                          }
                                                        ]
                                                      }
                                                    ]
                                                  }
                                                ]
                                              }
                                            ]
                                          }
                                        ]
                                      }
                                    ]
                                  }
                                ]
                              }
                            ]
                          }
                        ]
                      },
                      {
                        "type": "call",
                        "fun": "<-",
                        "args": [
                          {
                            "type": "name",
                            "value": "required_fields"
                          },
                          {
                            "type": "call",
                            "fun": "c",
                            "args": [
                              {
                                "type": "literal",
                                "value": "dose"
                              },
                              {
                                "type": "literal",
                                "value": "weight"
                              }
                            ]
                          }
                        ]
                      },
                      {
                        "type": "call",
                        "fun": "for",
                        "args": [
                          {
                            "type": "name",
                            "value": "field"
                          },
                          {
                            "type": "name",
                            "value": "required_fields"
                          },
                          {
                            "type": "call",
                            "fun": "{",
                            "args": [
                              {
                                "type": "call",
                                "fun": "if",
                                "args": [
                                  {
                                    "type": "call",
                                    "fun": "||",
                                    "args": [
                                      {
                                        "type": "call",
                                        "fun": "||",
                                        "args": [
                                          {
                                            "type": "call",
                                            "fun": "!",
                                            "args": [
                                              {
                                                "type": "call",
                                                "fun": "%in%",
                                                "args": [
                                                  {
                                                    "type": "name",
                                                    "value": "field"
                                                  },
                                                  {
                                                    "type": "call",
                                                    "fun": "names",
                                                    "args": [
                                                      {
                                                        "type": "name",
                                                        "value": "inputs"
                                                      }
                                                    ]
                                                  }
                                                ]
                                              }
                                            ]
                                          },
                                          {
                                            "type": "call",
                                            "fun": "is.null",
                                            "args": [
                                              {
                                                "type": "call",
                                                "fun": "[[",
                                                "args": [
                                                  {
                                                    "type": "name",
                                                    "value": "inputs"
                                                  },
                                                  {
                                                    "type": "name",
                                                    "value": "field"
                                                  }
                                                ]
                                              }
                                            ]
                                          }
                                        ]
                                      },
                                      {
                                        "type": "call",
                                        "fun": "==",
                                        "args": [
                                          {
                                            "type": "call",
                                            "fun": "[[",
                                            "args": [
                                              {
                                                "type": "name",
                                                "value": "inputs"
                                              },
                                              {
                                                "type": "name",
                                                "value": "field"
                                              }
                                            ]
                                          },
                                          {
                                            "type": "literal",
                                            "value": ""
                                          }
                                        ]
                                      }
                                    ]
                                  },
                                  {
                                    "type": "call",
                                    "fun": "{",
                                    "args": [
                                      {
                                        "type": "call",
                                        "fun": "<-",
                                        "args": [
                                          {
                                            "type": "call",
                                            "fun": "[[",
                                            "args": [
                                              {
                                                "type": "name",
                                                "value": "errors"
                                              },
                                              {
                                                "type": "name",
                                                "value": "field"
                                              }
                                            ]
                                          },
                                          {
                                            "type": "call",
                                            "fun": "paste",
                                            "args": [
                                              {
                                                "type": "name",
                                                "value": "field"
                                              },
                                              {
                                                "type": "literal",
                                                "value": "is required"
                                              }
                                            ]
                                          }
                                        ]
                                      }
                                    ]
                                  }
                                ]
                              }
                            ]
                          }
                        ]
                      },
                      {
                        "type": "call",
                        "fun": "if",
                        "args": [
                          {
                            "type": "call",
                            "fun": "&&",
                            "args": [
                              {
                                "type": "call",
                                "fun": "%in%",
                                "args": [
                                  {
                                    "type": "literal",
                                    "value": "weight"
                                  },
                                  {
                                    "type": "call",
                                    "fun": "names",
                                    "args": [
                                      {
                                        "type": "name",
                                        "value": "inputs"
                                      }
                                    ]
                                  }
                                ]
                              },
                              {
                                "type": "call",
                                "fun": "!",
                                "args": [
                                  {
                                    "type": "call",
                                    "fun": "is.na",
                                    "args": [
                                      {
                                        "type": "call",
                                        "fun": "as.numeric",
                                        "args": [
                                          {
                                            "type": "call",
                                            "fun": "$",
                                            "args": [
                                              {
                                                "type": "name",
                                                "value": "inputs"
                                              },
                                              {
                                                "type": "name",
                                                "value": "weight"
                                              }
                                            ]
                                          }
                                        ]
                                      }
                                    ]
                                  }
                                ]
                              }
                            ]
                          },
                          {
                            "type": "call",
                            "fun": "{",
                            "args": [
                              {
                                "type": "call",
                                "fun": "<-",
                                "args": [
                                  {
                                    "type": "name",
                                    "value": "weight"
                                  },
                                  {
                                    "type": "call",
                                    "fun": "as.numeric",
                                    "args": [
                                      {
                                        "type": "call",
                                        "fun": "$",
                                        "args": [
                                          {
                                            "type": "name",
                                            "value": "inputs"
                                          },
                                          {
                                            "type": "name",
                                            "value": "weight"
                                          }
                                        ]
                                      }
                                    ]
                                  }
                                ]
                              },
                              {
                                "type": "call",
                                "fun": "if",
                                "args": [
                                  {
                                    "type": "call",
                                    "fun": "||",
                                    "args": [
                                      {
                                        "type": "call",
                                        "fun": "<",
                                        "args": [
                                          {
                                            "type": "name",
                                            "value": "weight"
                                          },
                                          {
                                            "type": "literal",
                                            "value": 1
                                          }
                                        ]
                                      },
                                      {
                                        "type": "call",
                                        "fun": ">",
                                        "args": [
                                          {
                                            "type": "name",
                                            "value": "weight"
                                          },
                                          {
                                            "type": "literal",
                                            "value": 500
                                          }
                                        ]
                                      }
                                    ]
                                  },
                                  {
                                    "type": "call",
                                    "fun": "{",
                                    "args": [
                                      {
                                        "type": "call",
                                        "fun": "<-",
                                        "args": [
                                          {
                                            "type": "call",
                                            "fun": "$",
                                            "args": [
                                              {
                                                "type": "name",
                                                "value": "errors"
                                              },
                                              {
                                                "type": "name",
                                                "value": "weight"
                                              }
                                            ]
                                          },
                                          {
                                            "type": "literal",
                                            "value": "Weight must be between 1 and 500 kg"
                                          }
                                        ]
                                      }
                                    ]
                                  }
                                ]
                              }
                            ]
                          }
                        ]
                      },
                      {
                        "type": "call",
                        "fun": "if",
                        "args": [
                          {
                            "type": "call",
                            "fun": "&&",
                            "args": [
                              {
                                "type": "call",
                                "fun": "%in%",
                                "args": [
                                  {
                                    "type": "literal",
                                    "value": "dose"
                                  },
                                  {
                                    "type": "call",
                                    "fun": "names",
                                    "args": [
                                      {
                                        "type": "name",
                                        "value": "inputs"
                                      }
                                    ]
                                  }
                                ]
                              },
                              {
                                "type": "call",
                                "fun": "!",
                                "args": [
                                  {
                                    "type": "call",
                                    "fun": "is.na",
                                    "args": [
                                      {
                                        "type": "call",
                                        "fun": "as.numeric",
                                        "args": [
                                          {
                                            "type": "call",
                                            "fun": "$",
                                            "args": [
                                              {
                                                "type": "name",
                                                "value": "inputs"
                                              },
                                              {
                                                "type": "name",
                                                "value": "dose"
                                              }
                                            ]
                                          }
                                        ]
                                      }
                                    ]
                                  }
                                ]
                              }
                            ]
                          },
                          {
                            "type": "call",
                            "fun": "{",
                            "args": [
                              {
                                "type": "call",
                                "fun": "<-",
                                "args": [
                                  {
                                    "type": "name",
                                    "value": "dose"
                                  },
                                  {
                                    "type": "call",
                                    "fun": "as.numeric",
                                    "args": [
                                      {
                                        "type": "call",
                                        "fun": "$",
                                        "args": [
                                          {
                                            "type": "name",
                                            "value": "inputs"
                                          },
                                          {
                                            "type": "name",
                                            "value": "dose"
                                          }
                                        ]
                                      }
                                    ]
                                  }
                                ]
                              },
                              {
                                "type": "call",
                                "fun": "if",
                                "args": [
                                  {
                                    "type": "call",
                                    "fun": ">",
                                    "args": [
                                      {
                                        "type": "name",
                                        "value": "dose"
                                      },
                                      {
                                        "type": "literal",
                                        "value": 10000
                                      }
                                    ]
                                  },
                                  {
                                    "type": "call",
                                    "fun": "{",
                                    "args": [
                                      {
                                        "type": "call",
                                        "fun": "<-",
                                        "args": [
                                          {
                                            "type": "call",
                                            "fun": "$",
                                            "args": [
                                              {
                                                "type": "name",
                                                "value": "errors"
                                              },
                                              {
                                                "type": "name",
                                                "value": "dose"
                                              }
                                            ]
                                          },
                                          {
                                            "type": "literal",
                                            "value": "Dose seems unusually high. Please verify."
                                          }
                                        ]
                                      }
                                    ]
                                  }
                                ]
                              }
                            ]
                          }
                        ]
                      },
                      {
                        "type": "call",
                        "fun": "return",
                        "args": [
                          {
                            "type": "call",
                            "fun": "list",
                            "args": {
                              "valid": {
                                "type": "call",
                                "fun": "==",
                                "args": [
                                  {
                                    "type": "call",
                                    "fun": "length",
                                    "args": [
                                      {
                                        "type": "name",
                                        "value": "errors"
                                      }
                                    ]
                                  },
                                  {
                                    "type": "literal",
                                    "value": 0
                                  }
                                ]
                              },
                              "errors": {
                                "type": "name",
                                "value": "errors"
                              }
                            }
                          }
                        ]
                      }
                    ]
                  },
                  {
                    "type": "NULL",
                    "value": []
                  }
                ]
              }
            ]
          },
          {
            "type": "call",
            "fun": "<-",
            "args": [
              {
                "type": "name",
                "value": "valid_inputs"
              },
              {
                "type": "call",
                "fun": "list",
                "args": {
                  "dose": {
                    "type": "literal",
                    "value": "500"
                  },
                  "weight": {
                    "type": "literal",
                    "value": "70"
                  },
                  "clearance": {
                    "type": "literal",
                    "value": "5"
                  },
                  "volume": {
                    "type": "literal",
                    "value": "30"
                  }
                }
              }
            ]
          },
          {
            "type": "call",
            "fun": "<-",
            "args": [
              {
                "type": "name",
                "value": "validation"
              },
              {
                "type": "call",
                "fun": "validate_inputs",
                "args": [
                  {
                    "type": "name",
                    "value": "valid_inputs"
                  }
                ]
              }
            ]
          },
          {
            "type": "call",
            "fun": "expect_true",
            "args": [
              {
                "type": "call",
                "fun": "$",
                "args": [
                  {
                    "type": "name",
                    "value": "validation"
                  },
                  {
                    "type": "name",
                    "value": "valid"
                  }
                ]
              }
            ]
          },
          {
            "type": "call",
            "fun": "expect_equal",
            "args": [
              {
                "type": "call",
                "fun": "length",
                "args": [
                  {
                    "type": "call",
                    "fun": "$",
                    "args": [
                      {
                        "type": "name",
                        "value": "validation"
                      },
                      {
                        "type": "name",
                        "value": "errors"
                      }
                    ]
                  }
                ]
              },
              {
                "type": "literal",
                "value": 0
              }
            ]
          },
          {
            "type": "call",
            "fun": "<-",
            "args": [
              {
                "type": "name",
                "value": "invalid_inputs"
              },
              {
                "type": "call",
                "fun": "list",
                "args": {
                  "dose": {
                    "type": "literal",
                    "value": "abc"
                  },
                  "weight": {
                    "type": "literal",
                    "value": "-10"
                  }
                }
              }
            ]
          },
          {
            "type": "call",
            "fun": "<-",
            "args": [
              {
                "type": "name",
                "value": "validation"
              },
              {
                "type": "call",
                "fun": "validate_inputs",
                "args": [
                  {
                    "type": "name",
                    "value": "invalid_inputs"
                  }
                ]
              }
            ]
          },
          {
            "type": "call",
            "fun": "expect_false",
            "args": [
              {
                "type": "call",
                "fun": "$",
                "args": [
                  {
                    "type": "name",
                    "value": "validation"
                  },
                  {
                    "type": "name",
                    "value": "valid"
                  }
                ]
              }
            ]
          },
          {
            "type": "call",
            "fun": "expect_true",
            "args": [
              {
                "type": "call",
                "fun": "%in%",
                "args": [
                  {
                    "type": "literal",
                    "value": "dose"
                  },
                  {
                    "type": "call",
                    "fun": "names",
                    "args": [
                      {
                        "type": "call",
                        "fun": "$",
                        "args": [
                          {
                            "type": "name",
                            "value": "validation"
                          },
                          {
                            "type": "name",
                            "value": "errors"
                          }
                        ]
                      }
                    ]
                  }
                ]
              }
            ]
          },
          {
            "type": "call",
            "fun": "expect_true",
            "args": [
              {
                "type": "call",
                "fun": "%in%",
                "args": [
                  {
                    "type": "literal",
                    "value": "weight"
                  },
                  {
                    "type": "call",
                    "fun": "names",
                    "args": [
                      {
                        "type": "call",
                        "fun": "$",
                        "args": [
                          {
                            "type": "name",
                            "value": "validation"
                          },
                          {
                            "type": "name",
                            "value": "errors"
                          }
                        ]
                      }
                    ]
                  }
                ]
              }
            ]
          },
          {
            "type": "call",
            "fun": "<-",
            "args": [
              {
                "type": "name",
                "value": "incomplete_inputs"
              },
              {
                "type": "call",
                "fun": "list",
                "args": {
                  "clearance": {
                    "type": "literal",
                    "value": "5"
                  }
                }
              }
            ]
          },
          {
            "type": "call",
            "fun": "<-",
            "args": [
              {
                "type": "name",
                "value": "validation"
              },
              {
                "type": "call",
                "fun": "validate_inputs",
                "args": [
                  {
                    "type": "name",
                    "value": "incomplete_inputs"
                  }
                ]
              }
            ]
          },
          {
            "type": "call",
            "fun": "expect_false",
            "args": [
              {
                "type": "call",
                "fun": "$",
                "args": [
                  {
                    "type": "name",
                    "value": "validation"
                  },
                  {
                    "type": "name",
                    "value": "valid"
                  }
                ]
              }
            ]
          },
          {
            "type": "call",
            "fun": "expect_true",
            "args": [
              {
                "type": "call",
                "fun": "%in%",
                "args": [
                  {
                    "type": "literal",
                    "value": "dose"
                  },
                  {
                    "type": "call",
                    "fun": "names",
                    "args": [
                      {
                        "type": "call",
                        "fun": "$",
                        "args": [
                          {
                            "type": "name",
                            "value": "validation"
                          },
                          {
                            "type": "name",
                            "value": "errors"
                          }
                        ]
                      }
                    ]
                  }
                ]
              }
            ]
          },
          {
            "type": "call",
            "fun": "expect_true",
            "args": [
              {
                "type": "call",
                "fun": "%in%",
                "args": [
                  {
                    "type": "literal",
                    "value": "weight"
                  },
                  {
                    "type": "call",
                    "fun": "names",
                    "args": [
                      {
                        "type": "call",
                        "fun": "$",
                        "args": [
                          {
                            "type": "name",
                            "value": "validation"
                          },
                          {
                            "type": "name",
                            "value": "errors"
                          }
                        ]
                      }
                    ]
                  }
                ]
              }
            ]
          },
          {
            "type": "call",
            "fun": "<-",
            "args": [
              {
                "type": "name",
                "value": "edge_inputs"
              },
              {
                "type": "call",
                "fun": "list",
                "args": {
                  "dose": {
                    "type": "literal",
                    "value": "10001"
                  },
                  "weight": {
                    "type": "literal",
                    "value": "501"
                  }
                }
              }
            ]
          },
          {
            "type": "call",
            "fun": "<-",
            "args": [
              {
                "type": "name",
                "value": "validation"
              },
              {
                "type": "call",
                "fun": "validate_inputs",
                "args": [
                  {
                    "type": "name",
                    "value": "edge_inputs"
                  }
                ]
              }
            ]
          },
          {
            "type": "call",
            "fun": "expect_false",
            "args": [
              {
                "type": "call",
                "fun": "$",
                "args": [
                  {
                    "type": "name",
                    "value": "validation"
                  },
                  {
                    "type": "name",
                    "value": "valid"
                  }
                ]
              }
            ]
          }
        ]
      }
    ]
  },
  {
    "type": "call",
    "fun": "test_that",
    "args": [
      {
        "type": "literal",
        "value": "Session management maintains state correctly"
      },
      {
        "type": "call",
        "fun": "{",
        "args": [
          {
            "type": "call",
            "fun": "<-",
            "args": [
              {
                "type": "name",
                "value": "create_session_manager"
              },
              {
                "type": "call",
                "fun": "function",
                "args": [
                  {
                    "type": "NULL",
                    "value": []
                  },
                  {
                    "type": "call",
                    "fun": "{",
                    "args": [
                      {
                        "type": "call",
                        "fun": "<-",
                        "args": [
                          {
                            "type": "name",
                            "value": "sessions"
                          },
                          {
                            "type": "call",
                            "fun": "new.env",
                            "args": {
                              "parent": {
                                "type": "call",
                                "fun": "emptyenv",
                                "args": []
                              }
                            }
                          }
                        ]
                      },
                      {
                        "type": "call",
                        "fun": "<-",
                        "args": [
                          {
                            "type": "name",
                            "value": "create_session"
                          },
                          {
                            "type": "call",
                            "fun": "function",
                            "args": [
                              {
                                "type": "pairlist",
                                "value": ""
                              },
                              {
                                "type": "call",
                                "fun": "{",
                                "args": [
                                  {
                                    "type": "call",
                                    "fun": "<-",
                                    "args": [
                                      {
                                        "type": "name",
                                        "value": "session_id"
                                      },
                                      {
                                        "type": "call",
                                        "fun": "paste0",
                                        "args": [
                                          {
                                            "type": "literal",
                                            "value": "session_"
                                          },
                                          {
                                            "type": "call",
                                            "fun": "format",
                                            "args": [
                                              {
                                                "type": "call",
                                                "fun": "Sys.time",
                                                "args": []
                                              },
                                              {
                                                "type": "literal",
                                                "value": "%Y%m%d%H%M%S"
                                              }
                                            ]
                                          },
                                          {
                                            "type": "literal",
                                            "value": "_"
                                          },
                                          {
                                            "type": "call",
                                            "fun": "sample",
                                            "args": [
                                              {
                                                "type": "call",
                                                "fun": ":",
                                                "args": [
                                                  {
                                                    "type": "literal",
                                                    "value": 1000
                                                  },
                                                  {
                                                    "type": "literal",
                                                    "value": 9999
                                                  }
                                                ]
                                              },
                                              {
                                                "type": "literal",
                                                "value": 1
                                              }
                                            ]
                                          }
                                        ]
                                      }
                                    ]
                                  },
                                  {
                                    "type": "call",
                                    "fun": "<-",
                                    "args": [
                                      {
                                        "type": "call",
                                        "fun": "[[",
                                        "args": [
                                          {
                                            "type": "name",
                                            "value": "sessions"
                                          },
                                          {
                                            "type": "name",
                                            "value": "session_id"
                                          }
                                        ]
                                      },
                                      {
                                        "type": "call",
                                        "fun": "list",
                                        "args": {
                                          "user_id": {
                                            "type": "name",
                                            "value": "user_id"
                                          },
                                          "created_at": {
                                            "type": "call",
                                            "fun": "Sys.time",
                                            "args": []
                                          },
                                          "last_activity": {
                                            "type": "call",
                                            "fun": "Sys.time",
                                            "args": []
                                          },
                                          "data": {
                                            "type": "call",
                                            "fun": "list",
                                            "args": []
                                          }
                                        }
                                      }
                                    ]
                                  },
                                  {
                                    "type": "call",
                                    "fun": "return",
                                    "args": [
                                      {
                                        "type": "name",
                                        "value": "session_id"
                                      }
                                    ]
                                  }
                                ]
                              },
                              {
                                "type": "NULL",
                                "value": []
                              }
                            ]
                          }
                        ]
                      },
                      {
                        "type": "call",
                        "fun": "<-",
                        "args": [
                          {
                            "type": "name",
                            "value": "get_session"
                          },
                          {
                            "type": "call",
                            "fun": "function",
                            "args": [
                              {
                                "type": "pairlist",
                                "value": ""
                              },
                              {
                                "type": "call",
                                "fun": "{",
                                "args": [
                                  {
                                    "type": "call",
                                    "fun": "if",
                                    "args": [
                                      {
                                        "type": "call",
                                        "fun": "!",
                                        "args": [
                                          {
                                            "type": "call",
                                            "fun": "exists",
                                            "args": {
                                              "1": {
                                                "type": "name",
                                                "value": "session_id"
                                              },
                                              "envir": {
                                                "type": "name",
                                                "value": "sessions"
                                              }
                                            }
                                          }
                                        ]
                                      },
                                      {
                                        "type": "call",
                                        "fun": "{",
                                        "args": [
                                          {
                                            "type": "call",
                                            "fun": "return",
                                            "args": [
                                              {
                                                "type": "NULL",
                                                "value": []
                                              }
                                            ]
                                          }
                                        ]
                                      }
                                    ]
                                  },
                                  {
                                    "type": "call",
                                    "fun": "<-",
                                    "args": [
                                      {
                                        "type": "name",
                                        "value": "session"
                                      },
                                      {
                                        "type": "call",
                                        "fun": "[[",
                                        "args": [
                                          {
                                            "type": "name",
                                            "value": "sessions"
                                          },
                                          {
                                            "type": "name",
                                            "value": "session_id"
                                          }
                                        ]
                                      }
                                    ]
                                  },
                                  {
                                    "type": "call",
                                    "fun": "if",
                                    "args": [
                                      {
                                        "type": "call",
                                        "fun": ">",
                                        "args": [
                                          {
                                            "type": "call",
                                            "fun": "difftime",
                                            "args": {
                                              "1": {
                                                "type": "call",
                                                "fun": "Sys.time",
                                                "args": []
                                              },
                                              "2": {
                                                "type": "call",
                                                "fun": "$",
                                                "args": [
                                                  {
                                                    "type": "name",
                                                    "value": "session"
                                                  },
                                                  {
                                                    "type": "name",
                                                    "value": "last_activity"
                                                  }
                                                ]
                                              },
                                              "units": {
                                                "type": "literal",
                                                "value": "mins"
                                              }
                                            }
                                          },
                                          {
                                            "type": "literal",
                                            "value": 30
                                          }
                                        ]
                                      },
                                      {
                                        "type": "call",
                                        "fun": "{",
                                        "args": [
                                          {
                                            "type": "call",
                                            "fun": "remove_session",
                                            "args": [
                                              {
                                                "type": "name",
                                                "value": "session_id"
                                              }
                                            ]
                                          },
                                          {
                                            "type": "call",
                                            "fun": "return",
                                            "args": [
                                              {
                                                "type": "NULL",
                                                "value": []
                                              }
                                            ]
                                          }
                                        ]
                                      }
                                    ]
                                  },
                                  {
                                    "type": "call",
                                    "fun": "<-",
                                    "args": [
                                      {
                                        "type": "call",
                                        "fun": "$",
                                        "args": [
                                          {
                                            "type": "name",
                                            "value": "session"
                                          },
                                          {
                                            "type": "name",
                                            "value": "last_activity"
                                          }
                                        ]
                                      },
                                      {
                                        "type": "call",
                                        "fun": "Sys.time",
                                        "args": []
                                      }
                                    ]
                                  },
                                  {
                                    "type": "call",
                                    "fun": "<-",
                                    "args": [
                                      {
                                        "type": "call",
                                        "fun": "[[",
                                        "args": [
                                          {
                                            "type": "name",
                                            "value": "sessions"
                                          },
                                          {
                                            "type": "name",
                                            "value": "session_id"
                                          }
                                        ]
                                      },
                                      {
                                        "type": "name",
                                        "value": "session"
                                      }
                                    ]
                                  },
                                  {
                                    "type": "call",
                                    "fun": "return",
                                    "args": [
                                      {
                                        "type": "name",
                                        "value": "session"
                                      }
                                    ]
                                  }
                                ]
                              },
                              {
                                "type": "NULL",
                                "value": []
                              }
                            ]
                          }
                        ]
                      },
                      {
                        "type": "call",
                        "fun": "<-",
                        "args": [
                          {
                            "type": "name",
                            "value": "update_session_data"
                          },
                          {
                            "type": "call",
                            "fun": "function",
                            "args": [
                              {
                                "type": "pairlist",
                                "value": ["", "", ""]
                              },
                              {
                                "type": "call",
                                "fun": "{",
                                "args": [
                                  {
                                    "type": "call",
                                    "fun": "<-",
                                    "args": [
                                      {
                                        "type": "name",
                                        "value": "session"
                                      },
                                      {
                                        "type": "call",
                                        "fun": "get_session",
                                        "args": [
                                          {
                                            "type": "name",
                                            "value": "session_id"
                                          }
                                        ]
                                      }
                                    ]
                                  },
                                  {
                                    "type": "call",
                                    "fun": "if",
                                    "args": [
                                      {
                                        "type": "call",
                                        "fun": "is.null",
                                        "args": [
                                          {
                                            "type": "name",
                                            "value": "session"
                                          }
                                        ]
                                      },
                                      {
                                        "type": "call",
                                        "fun": "{",
                                        "args": [
                                          {
                                            "type": "call",
                                            "fun": "return",
                                            "args": [
                                              {
                                                "type": "literal",
                                                "value": false
                                              }
                                            ]
                                          }
                                        ]
                                      }
                                    ]
                                  },
                                  {
                                    "type": "call",
                                    "fun": "<-",
                                    "args": [
                                      {
                                        "type": "call",
                                        "fun": "[[",
                                        "args": [
                                          {
                                            "type": "call",
                                            "fun": "$",
                                            "args": [
                                              {
                                                "type": "name",
                                                "value": "session"
                                              },
                                              {
                                                "type": "name",
                                                "value": "data"
                                              }
                                            ]
                                          },
                                          {
                                            "type": "name",
                                            "value": "key"
                                          }
                                        ]
                                      },
                                      {
                                        "type": "name",
                                        "value": "value"
                                      }
                                    ]
                                  },
                                  {
                                    "type": "call",
                                    "fun": "<-",
                                    "args": [
                                      {
                                        "type": "call",
                                        "fun": "[[",
                                        "args": [
                                          {
                                            "type": "name",
                                            "value": "sessions"
                                          },
                                          {
                                            "type": "name",
                                            "value": "session_id"
                                          }
                                        ]
                                      },
                                      {
                                        "type": "name",
                                        "value": "session"
                                      }
                                    ]
                                  },
                                  {
                                    "type": "call",
                                    "fun": "return",
                                    "args": [
                                      {
                                        "type": "literal",
                                        "value": true
                                      }
                                    ]
                                  }
                                ]
                              },
                              {
                                "type": "NULL",
                                "value": []
                              }
                            ]
                          }
                        ]
                      },
                      {
                        "type": "call",
                        "fun": "<-",
                        "args": [
                          {
                            "type": "name",
                            "value": "remove_session"
                          },
                          {
                            "type": "call",
                            "fun": "function",
                            "args": [
                              {
                                "type": "pairlist",
                                "value": ""
                              },
                              {
                                "type": "call",
                                "fun": "{",
                                "args": [
                                  {
                                    "type": "call",
                                    "fun": "if",
                                    "args": [
                                      {
                                        "type": "call",
                                        "fun": "exists",
                                        "args": {
                                          "1": {
                                            "type": "name",
                                            "value": "session_id"
                                          },
                                          "envir": {
                                            "type": "name",
                                            "value": "sessions"
                                          }
                                        }
                                      },
                                      {
                                        "type": "call",
                                        "fun": "{",
                                        "args": [
                                          {
                                            "type": "call",
                                            "fun": "rm",
                                            "args": {
                                              "list": {
                                                "type": "name",
                                                "value": "session_id"
                                              },
                                              "envir": {
                                                "type": "name",
                                                "value": "sessions"
                                              }
                                            }
                                          },
                                          {
                                            "type": "call",
                                            "fun": "return",
                                            "args": [
                                              {
                                                "type": "literal",
                                                "value": true
                                              }
                                            ]
                                          }
                                        ]
                                      }
                                    ]
                                  },
                                  {
                                    "type": "call",
                                    "fun": "return",
                                    "args": [
                                      {
                                        "type": "literal",
                                        "value": false
                                      }
                                    ]
                                  }
                                ]
                              },
                              {
                                "type": "NULL",
                                "value": []
                              }
                            ]
                          }
                        ]
                      },
                      {
                        "type": "call",
                        "fun": "<-",
                        "args": [
                          {
                            "type": "name",
                            "value": "list_sessions"
                          },
                          {
                            "type": "call",
                            "fun": "function",
                            "args": [
                              {
                                "type": "NULL",
                                "value": []
                              },
                              {
                                "type": "call",
                                "fun": "{",
                                "args": [
                                  {
                                    "type": "call",
                                    "fun": "return",
                                    "args": [
                                      {
                                        "type": "call",
                                        "fun": "ls",
                                        "args": {
                                          "envir": {
                                            "type": "name",
                                            "value": "sessions"
                                          }
                                        }
                                      }
                                    ]
                                  }
                                ]
                              },
                              {
                                "type": "NULL",
                                "value": []
                              }
                            ]
                          }
                        ]
                      },
                      {
                        "type": "call",
                        "fun": "return",
                        "args": [
                          {
                            "type": "call",
                            "fun": "list",
                            "args": {
                              "create": {
                                "type": "name",
                                "value": "create_session"
                              },
                              "get": {
                                "type": "name",
                                "value": "get_session"
                              },
                              "update": {
                                "type": "name",
                                "value": "update_session_data"
                              },
                              "remove": {
                                "type": "name",
                                "value": "remove_session"
                              },
                              "list": {
                                "type": "name",
                                "value": "list_sessions"
                              }
                            }
                          }
                        ]
                      }
                    ]
                  },
                  {
                    "type": "NULL",
                    "value": []
                  }
                ]
              }
            ]
          },
          {
            "type": "call",
            "fun": "<-",
            "args": [
              {
                "type": "name",
                "value": "sm"
              },
              {
                "type": "call",
                "fun": "create_session_manager",
                "args": []
              }
            ]
          },
          {
            "type": "call",
            "fun": "<-",
            "args": [
              {
                "type": "name",
                "value": "session_id"
              },
              {
                "type": "call",
                "fun": ["$", "sm", "create"],
                "args": [
                  {
                    "type": "literal",
                    "value": "user123"
                  }
                ]
              }
            ]
          },
          {
            "type": "call",
            "fun": "expect_true",
            "args": [
              {
                "type": "call",
                "fun": "!",
                "args": [
                  {
                    "type": "call",
                    "fun": "is.null",
                    "args": [
                      {
                        "type": "name",
                        "value": "session_id"
                      }
                    ]
                  }
                ]
              }
            ]
          },
          {
            "type": "call",
            "fun": "expect_true",
            "args": [
              {
                "type": "call",
                "fun": "grepl",
                "args": [
                  {
                    "type": "literal",
                    "value": "^session_"
                  },
                  {
                    "type": "name",
                    "value": "session_id"
                  }
                ]
              }
            ]
          },
          {
            "type": "call",
            "fun": "<-",
            "args": [
              {
                "type": "name",
                "value": "session"
              },
              {
                "type": "call",
                "fun": ["$", "sm", "get"],
                "args": [
                  {
                    "type": "name",
                    "value": "session_id"
                  }
                ]
              }
            ]
          },
          {
            "type": "call",
            "fun": "expect_true",
            "args": [
              {
                "type": "call",
                "fun": "!",
                "args": [
                  {
                    "type": "call",
                    "fun": "is.null",
                    "args": [
                      {
                        "type": "name",
                        "value": "session"
                      }
                    ]
                  }
                ]
              }
            ]
          },
          {
            "type": "call",
            "fun": "expect_equal",
            "args": [
              {
                "type": "call",
                "fun": "$",
                "args": [
                  {
                    "type": "name",
                    "value": "session"
                  },
                  {
                    "type": "name",
                    "value": "user_id"
                  }
                ]
              },
              {
                "type": "literal",
                "value": "user123"
              }
            ]
          },
          {
            "type": "call",
            "fun": "<-",
            "args": [
              {
                "type": "name",
                "value": "success"
              },
              {
                "type": "call",
                "fun": ["$", "sm", "update"],
                "args": [
                  {
                    "type": "name",
                    "value": "session_id"
                  },
                  {
                    "type": "literal",
                    "value": "test_value"
                  },
                  {
                    "type": "literal",
                    "value": 42
                  }
                ]
              }
            ]
          },
          {
            "type": "call",
            "fun": "expect_true",
            "args": [
              {
                "type": "name",
                "value": "success"
              }
            ]
          },
          {
            "type": "call",
            "fun": "<-",
            "args": [
              {
                "type": "name",
                "value": "session"
              },
              {
                "type": "call",
                "fun": ["$", "sm", "get"],
                "args": [
                  {
                    "type": "name",
                    "value": "session_id"
                  }
                ]
              }
            ]
          },
          {
            "type": "call",
            "fun": "expect_equal",
            "args": [
              {
                "type": "call",
                "fun": "$",
                "args": [
                  {
                    "type": "call",
                    "fun": "$",
                    "args": [
                      {
                        "type": "name",
                        "value": "session"
                      },
                      {
                        "type": "name",
                        "value": "data"
                      }
                    ]
                  },
                  {
                    "type": "name",
                    "value": "test_value"
                  }
                ]
              },
              {
                "type": "literal",
                "value": 42
              }
            ]
          },
          {
            "type": "call",
            "fun": "<-",
            "args": [
              {
                "type": "name",
                "value": "sessions"
              },
              {
                "type": "call",
                "fun": ["$", "sm", "list"],
                "args": []
              }
            ]
          },
          {
            "type": "call",
            "fun": "expect_true",
            "args": [
              {
                "type": "call",
                "fun": "%in%",
                "args": [
                  {
                    "type": "name",
                    "value": "session_id"
                  },
                  {
                    "type": "name",
                    "value": "sessions"
                  }
                ]
              }
            ]
          },
          {
            "type": "call",
            "fun": "<-",
            "args": [
              {
                "type": "name",
                "value": "removed"
              },
              {
                "type": "call",
                "fun": ["$", "sm", "remove"],
                "args": [
                  {
                    "type": "name",
                    "value": "session_id"
                  }
                ]
              }
            ]
          },
          {
            "type": "call",
            "fun": "expect_true",
            "args": [
              {
                "type": "name",
                "value": "removed"
              }
            ]
          },
          {
            "type": "call",
            "fun": "expect_null",
            "args": [
              {
                "type": "call",
                "fun": ["$", "sm", "get"],
                "args": [
                  {
                    "type": "name",
                    "value": "session_id"
                  }
                ]
              }
            ]
          }
        ]
      }
    ]
  },
  {
    "type": "call",
    "fun": "test_that",
    "args": [
      {
        "type": "literal",
        "value": "Data export functionality works correctly"
      },
      {
        "type": "call",
        "fun": "{",
        "args": [
          {
            "type": "call",
            "fun": "<-",
            "args": [
              {
                "type": "name",
                "value": "export_to_csv"
              },
              {
                "type": "call",
                "fun": "function",
                "args": [
                  {
                    "type": "pairlist",
                    "value": ["", ""]
                  },
                  {
                    "type": "call",
                    "fun": "{",
                    "args": [
                      {
                        "type": "call",
                        "fun": "if",
                        "args": [
                          {
                            "type": "call",
                            "fun": "||",
                            "args": [
                              {
                                "type": "call",
                                "fun": "is.null",
                                "args": [
                                  {
                                    "type": "name",
                                    "value": "data"
                                  }
                                ]
                              },
                              {
                                "type": "call",
                                "fun": "==",
                                "args": [
                                  {
                                    "type": "call",
                                    "fun": "nrow",
                                    "args": [
                                      {
                                        "type": "name",
                                        "value": "data"
                                      }
                                    ]
                                  },
                                  {
                                    "type": "literal",
                                    "value": 0
                                  }
                                ]
                              }
                            ]
                          },
                          {
                            "type": "call",
                            "fun": "{",
                            "args": [
                              {
                                "type": "call",
                                "fun": "stop",
                                "args": [
                                  {
                                    "type": "literal",
                                    "value": "No data to export"
                                  }
                                ]
                              }
                            ]
                          }
                        ]
                      },
                      {
                        "type": "call",
                        "fun": "return",
                        "args": [
                          {
                            "type": "literal",
                            "value": true
                          }
                        ]
                      }
                    ]
                  },
                  {
                    "type": "NULL",
                    "value": []
                  }
                ]
              }
            ]
          },
          {
            "type": "call",
            "fun": "<-",
            "args": [
              {
                "type": "name",
                "value": "export_to_excel"
              },
              {
                "type": "call",
                "fun": "function",
                "args": [
                  {
                    "type": "pairlist",
                    "value": ["", ""]
                  },
                  {
                    "type": "call",
                    "fun": "{",
                    "args": [
                      {
                        "type": "call",
                        "fun": "skip_if_not_installed",
                        "args": [
                          {
                            "type": "literal",
                            "value": "openxlsx"
                          }
                        ]
                      },
                      {
                        "type": "call",
                        "fun": "if",
                        "args": [
                          {
                            "type": "call",
                            "fun": "!",
                            "args": [
                              {
                                "type": "call",
                                "fun": "is.list",
                                "args": [
                                  {
                                    "type": "name",
                                    "value": "data_list"
                                  }
                                ]
                              }
                            ]
                          },
                          {
                            "type": "call",
                            "fun": "{",
                            "args": [
                              {
                                "type": "call",
                                "fun": "<-",
                                "args": [
                                  {
                                    "type": "name",
                                    "value": "data_list"
                                  },
                                  {
                                    "type": "call",
                                    "fun": "list",
                                    "args": {
                                      "Sheet1": {
                                        "type": "name",
                                        "value": "data_list"
                                      }
                                    }
                                  }
                                ]
                              }
                            ]
                          }
                        ]
                      },
                      {
                        "type": "call",
                        "fun": "return",
                        "args": [
                          {
                            "type": "literal",
                            "value": true
                          }
                        ]
                      }
                    ]
                  },
                  {
                    "type": "NULL",
                    "value": []
                  }
                ]
              }
            ]
          },
          {
            "type": "call",
            "fun": "<-",
            "args": [
              {
                "type": "name",
                "value": "export_report"
              },
              {
                "type": "call",
                "fun": "function",
                "args": [
                  {
                    "type": "pairlist",
                    "value": ["", "html"]
                  },
                  {
                    "type": "call",
                    "fun": "{",
                    "args": [
                      {
                        "type": "call",
                        "fun": "skip_if_not_installed",
                        "args": [
                          {
                            "type": "literal",
                            "value": "rmarkdown"
                          }
                        ]
                      },
                      {
                        "type": "call",
                        "fun": "<-",
                        "args": [
                          {
                            "type": "name",
                            "value": "required_fields"
                          },
                          {
                            "type": "call",
                            "fun": "c",
                            "args": [
                              {
                                "type": "literal",
                                "value": "parameters"
                              },
                              {
                                "type": "literal",
                                "value": "metrics"
                              },
                              {
                                "type": "literal",
                                "value": "plots"
                              }
                            ]
                          }
                        ]
                      },
                      {
                        "type": "call",
                        "fun": "if",
                        "args": [
                          {
                            "type": "call",
                            "fun": "!",
                            "args": [
                              {
                                "type": "call",
                                "fun": "all",
                                "args": [
                                  {
                                    "type": "call",
                                    "fun": "%in%",
                                    "args": [
                                      {
                                        "type": "name",
                                        "value": "required_fields"
                                      },
                                      {
                                        "type": "call",
                                        "fun": "names",
                                        "args": [
                                          {
                                            "type": "name",
                                            "value": "results"
                                          }
                                        ]
                                      }
                                    ]
                                  }
                                ]
                              }
                            ]
                          },
                          {
                            "type": "call",
                            "fun": "{",
                            "args": [
                              {
                                "type": "call",
                                "fun": "stop",
                                "args": [
                                  {
                                    "type": "literal",
                                    "value": "Results missing required fields"
                                  }
                                ]
                              }
                            ]
                          }
                        ]
                      },
                      {
                        "type": "call",
                        "fun": "<-",
                        "args": [
                          {
                            "type": "name",
                            "value": "report_content"
                          },
                          {
                            "type": "call",
                            "fun": "list",
                            "args": {
                              "title": {
                                "type": "literal",
                                "value": "PK/PD Analysis Report"
                              },
                              "date": {
                                "type": "call",
                                "fun": "Sys.Date",
                                "args": []
                              },
                              "parameters": {
                                "type": "call",
                                "fun": "$",
                                "args": [
                                  {
                                    "type": "name",
                                    "value": "results"
                                  },
                                  {
                                    "type": "name",
                                    "value": "parameters"
                                  }
                                ]
                              },
                              "metrics": {
                                "type": "call",
                                "fun": "$",
                                "args": [
                                  {
                                    "type": "name",
                                    "value": "results"
                                  },
                                  {
                                    "type": "name",
                                    "value": "metrics"
                                  }
                                ]
                              },
                              "format": {
                                "type": "name",
                                "value": "format"
                              }
                            }
                          }
                        ]
                      },
                      {
                        "type": "call",
                        "fun": "return",
                        "args": [
                          {
                            "type": "name",
                            "value": "report_content"
                          }
                        ]
                      }
                    ]
                  },
                  {
                    "type": "NULL",
                    "value": []
                  }
                ]
              }
            ]
          },
          {
            "type": "call",
            "fun": "<-",
            "args": [
              {
                "type": "name",
                "value": "test_data"
              },
              {
                "type": "call",
                "fun": "data.frame",
                "args": {
                  "time": {
                    "type": "call",
                    "fun": "c",
                    "args": [
                      {
                        "type": "literal",
                        "value": 0
                      },
                      {
                        "type": "literal",
                        "value": 1
                      },
                      {
                        "type": "literal",
                        "value": 2
                      },
                      {
                        "type": "literal",
                        "value": 4
                      },
                      {
                        "type": "literal",
                        "value": 8
                      }
                    ]
                  },
                  "concentration": {
                    "type": "call",
                    "fun": "c",
                    "args": [
                      {
                        "type": "literal",
                        "value": 0
                      },
                      {
                        "type": "literal",
                        "value": 10
                      },
                      {
                        "type": "literal",
                        "value": 8
                      },
                      {
                        "type": "literal",
                        "value": 5
                      },
                      {
                        "type": "literal",
                        "value": 2
                      }
                    ]
                  }
                }
              }
            ]
          },
          {
            "type": "call",
            "fun": "<-",
            "args": [
              {
                "type": "name",
                "value": "test_results"
              },
              {
                "type": "call",
                "fun": "list",
                "args": {
                  "parameters": {
                    "type": "call",
                    "fun": "list",
                    "args": {
                      "CL": {
                        "type": "literal",
                        "value": 5
                      },
                      "Vc": {
                        "type": "literal",
                        "value": 30
                      }
                    }
                  },
                  "metrics": {
                    "type": "call",
                    "fun": "list",
                    "args": {
                      "Cmax": {
                        "type": "literal",
                        "value": 10
                      },
                      "Cmin": {
                        "type": "literal",
                        "value": 2
                      },
                      "AUC": {
                        "type": "literal",
                        "value": 40
                      }
                    }
                  },
                  "plots": {
                    "type": "call",
                    "fun": "list",
                    "args": []
                  }
                }
              }
            ]
          },
          {
            "type": "call",
            "fun": "expect_true",
            "args": [
              {
                "type": "call",
                "fun": "export_to_csv",
                "args": [
                  {
                    "type": "name",
                    "value": "test_data"
                  },
                  {
                    "type": "literal",
                    "value": "test.csv"
                  }
                ]
              }
            ]
          },
          {
            "type": "call",
            "fun": "expect_error",
            "args": [
              {
                "type": "call",
                "fun": "export_to_csv",
                "args": [
                  {
                    "type": "NULL",
                    "value": []
                  },
                  {
                    "type": "literal",
                    "value": "test.csv"
                  }
                ]
              }
            ]
          },
          {
            "type": "call",
            "fun": "expect_error",
            "args": [
              {
                "type": "call",
                "fun": "export_to_csv",
                "args": [
                  {
                    "type": "call",
                    "fun": "data.frame",
                    "args": []
                  },
                  {
                    "type": "literal",
                    "value": "test.csv"
                  }
                ]
              }
            ]
          },
          {
            "type": "call",
            "fun": "if",
            "args": [
              {
                "type": "call",
                "fun": "%in%",
                "args": [
                  {
                    "type": "literal",
                    "value": "openxlsx"
                  },
                  {
                    "type": "call",
                    "fun": "[",
                    "args": [
                      {
                        "type": "call",
                        "fun": "installed.packages",
                        "args": []
                      },
                      {
                        "type": "name",
                        "value": ""
                      },
                      {
                        "type": "literal",
                        "value": "Package"
                      }
                    ]
                  }
                ]
              },
              {
                "type": "call",
                "fun": "{",
                "args": [
                  {
                    "type": "call",
                    "fun": "expect_true",
                    "args": [
                      {
                        "type": "call",
                        "fun": "export_to_excel",
                        "args": [
                          {
                            "type": "name",
                            "value": "test_data"
                          },
                          {
                            "type": "literal",
                            "value": "test.xlsx"
                          }
                        ]
                      }
                    ]
                  },
                  {
                    "type": "call",
                    "fun": "expect_true",
                    "args": [
                      {
                        "type": "call",
                        "fun": "export_to_excel",
                        "args": [
                          {
                            "type": "call",
                            "fun": "list",
                            "args": {
                              "Data": {
                                "type": "name",
                                "value": "test_data"
                              },
                              "Summary": {
                                "type": "name",
                                "value": "test_data"
                              }
                            }
                          },
                          {
                            "type": "literal",
                            "value": "test.xlsx"
                          }
                        ]
                      }
                    ]
                  }
                ]
              }
            ]
          },
          {
            "type": "call",
            "fun": "if",
            "args": [
              {
                "type": "call",
                "fun": "%in%",
                "args": [
                  {
                    "type": "literal",
                    "value": "rmarkdown"
                  },
                  {
                    "type": "call",
                    "fun": "[",
                    "args": [
                      {
                        "type": "call",
                        "fun": "installed.packages",
                        "args": []
                      },
                      {
                        "type": "name",
                        "value": ""
                      },
                      {
                        "type": "literal",
                        "value": "Package"
                      }
                    ]
                  }
                ]
              },
              {
                "type": "call",
                "fun": "{",
                "args": [
                  {
                    "type": "call",
                    "fun": "<-",
                    "args": [
                      {
                        "type": "name",
                        "value": "report"
                      },
                      {
                        "type": "call",
                        "fun": "export_report",
                        "args": [
                          {
                            "type": "name",
                            "value": "test_results"
                          }
                        ]
                      }
                    ]
                  },
                  {
                    "type": "call",
                    "fun": "expect_equal",
                    "args": [
                      {
                        "type": "call",
                        "fun": "$",
                        "args": [
                          {
                            "type": "name",
                            "value": "report"
                          },
                          {
                            "type": "name",
                            "value": "format"
                          }
                        ]
                      },
                      {
                        "type": "literal",
                        "value": "html"
                      }
                    ]
                  },
                  {
                    "type": "call",
                    "fun": "expect_equal",
                    "args": [
                      {
                        "type": "call",
                        "fun": "$",
                        "args": [
                          {
                            "type": "call",
                            "fun": "$",
                            "args": [
                              {
                                "type": "name",
                                "value": "report"
                              },
                              {
                                "type": "name",
                                "value": "parameters"
                              }
                            ]
                          },
                          {
                            "type": "name",
                            "value": "CL"
                          }
                        ]
                      },
                      {
                        "type": "literal",
                        "value": 5
                      }
                    ]
                  }
                ]
              }
            ]
          }
        ]
      }
    ]
  },
  {
    "type": "call",
    "fun": "test_that",
    "args": [
      {
        "type": "literal",
        "value": "Concurrent user operations are handled safely"
      },
      {
        "type": "call",
        "fun": "{",
        "args": [
          {
            "type": "call",
            "fun": "<-",
            "args": [
              {
                "type": "name",
                "value": "create_operation_queue"
              },
              {
                "type": "call",
                "fun": "function",
                "args": [
                  {
                    "type": "NULL",
                    "value": []
                  },
                  {
                    "type": "call",
                    "fun": "{",
                    "args": [
                      {
                        "type": "call",
                        "fun": "<-",
                        "args": [
                          {
                            "type": "name",
                            "value": "queue"
                          },
                          {
                            "type": "call",
                            "fun": "new.env",
                            "args": {
                              "parent": {
                                "type": "call",
                                "fun": "emptyenv",
                                "args": []
                              }
                            }
                          }
                        ]
                      },
                      {
                        "type": "call",
                        "fun": "<-",
                        "args": [
                          {
                            "type": "call",
                            "fun": "$",
                            "args": [
                              {
                                "type": "name",
                                "value": "queue"
                              },
                              {
                                "type": "name",
                                "value": "operations"
                              }
                            ]
                          },
                          {
                            "type": "call",
                            "fun": "list",
                            "args": []
                          }
                        ]
                      },
                      {
                        "type": "call",
                        "fun": "<-",
                        "args": [
                          {
                            "type": "call",
                            "fun": "$",
                            "args": [
                              {
                                "type": "name",
                                "value": "queue"
                              },
                              {
                                "type": "name",
                                "value": "processing"
                              }
                            ]
                          },
                          {
                            "type": "literal",
                            "value": false
                          }
                        ]
                      },
                      {
                        "type": "call",
                        "fun": "<-",
                        "args": [
                          {
                            "type": "call",
                            "fun": "$",
                            "args": [
                              {
                                "type": "name",
                                "value": "queue"
                              },
                              {
                                "type": "name",
                                "value": "lock"
                              }
                            ]
                          },
                          {
                            "type": "literal",
                            "value": 0
                          }
                        ]
                      },
                      {
                        "type": "call",
                        "fun": "<-",
                        "args": [
                          {
                            "type": "name",
                            "value": "add_operation"
                          },
                          {
                            "type": "call",
                            "fun": "function",
                            "args": [
                              {
                                "type": "pairlist",
                                "value": ["", "", ""]
                              },
                              {
                                "type": "call",
                                "fun": "{",
                                "args": [
                                  {
                                    "type": "call",
                                    "fun": "while",
                                    "args": [
                                      {
                                        "type": "call",
                                        "fun": ">",
                                        "args": [
                                          {
                                            "type": "call",
                                            "fun": "$",
                                            "args": [
                                              {
                                                "type": "name",
                                                "value": "queue"
                                              },
                                              {
                                                "type": "name",
                                                "value": "lock"
                                              }
                                            ]
                                          },
                                          {
                                            "type": "literal",
                                            "value": 0
                                          }
                                        ]
                                      },
                                      {
                                        "type": "call",
                                        "fun": "{",
                                        "args": [
                                          {
                                            "type": "call",
                                            "fun": "Sys.sleep",
                                            "args": [
                                              {
                                                "type": "literal",
                                                "value": 0.01
                                              }
                                            ]
                                          }
                                        ]
                                      }
                                    ]
                                  },
                                  {
                                    "type": "call",
                                    "fun": "<-",
                                    "args": [
                                      {
                                        "type": "call",
                                        "fun": "$",
                                        "args": [
                                          {
                                            "type": "name",
                                            "value": "queue"
                                          },
                                          {
                                            "type": "name",
                                            "value": "lock"
                                          }
                                        ]
                                      },
                                      {
                                        "type": "literal",
                                        "value": 1
                                      }
                                    ]
                                  },
                                  {
                                    "type": "call",
                                    "fun": "<-",
                                    "args": [
                                      {
                                        "type": "name",
                                        "value": "op_id"
                                      },
                                      {
                                        "type": "call",
                                        "fun": "paste0",
                                        "args": [
                                          {
                                            "type": "literal",
                                            "value": "op_"
                                          },
                                          {
                                            "type": "call",
                                            "fun": "+",
                                            "args": [
                                              {
                                                "type": "call",
                                                "fun": "length",
                                                "args": [
                                                  {
                                                    "type": "call",
                                                    "fun": "$",
                                                    "args": [
                                                      {
                                                        "type": "name",
                                                        "value": "queue"
                                                      },
                                                      {
                                                        "type": "name",
                                                        "value": "operations"
                                                      }
                                                    ]
                                                  }
                                                ]
                                              },
                                              {
                                                "type": "literal",
                                                "value": 1
                                              }
                                            ]
                                          }
                                        ]
                                      }
                                    ]
                                  },
                                  {
                                    "type": "call",
                                    "fun": "<-",
                                    "args": [
                                      {
                                        "type": "call",
                                        "fun": "[[",
                                        "args": [
                                          {
                                            "type": "call",
                                            "fun": "$",
                                            "args": [
                                              {
                                                "type": "name",
                                                "value": "queue"
                                              },
                                              {
                                                "type": "name",
                                                "value": "operations"
                                              }
                                            ]
                                          },
                                          {
                                            "type": "name",
                                            "value": "op_id"
                                          }
                                        ]
                                      },
                                      {
                                        "type": "call",
                                        "fun": "list",
                                        "args": {
                                          "id": {
                                            "type": "name",
                                            "value": "op_id"
                                          },
                                          "user_id": {
                                            "type": "name",
                                            "value": "user_id"
                                          },
                                          "operation": {
                                            "type": "name",
                                            "value": "operation"
                                          },
                                          "params": {
                                            "type": "name",
                                            "value": "params"
                                          },
                                          "status": {
                                            "type": "literal",
                                            "value": "pending"
                                          },
                                          "created_at": {
                                            "type": "call",
                                            "fun": "Sys.time",
                                            "args": []
                                          }
                                        }
                                      }
                                    ]
                                  },
                                  {
                                    "type": "call",
                                    "fun": "<-",
                                    "args": [
                                      {
                                        "type": "call",
                                        "fun": "$",
                                        "args": [
                                          {
                                            "type": "name",
                                            "value": "queue"
                                          },
                                          {
                                            "type": "name",
                                            "value": "lock"
                                          }
                                        ]
                                      },
                                      {
                                        "type": "literal",
                                        "value": 0
                                      }
                                    ]
                                  },
                                  {
                                    "type": "call",
                                    "fun": "return",
                                    "args": [
                                      {
                                        "type": "name",
                                        "value": "op_id"
                                      }
                                    ]
                                  }
                                ]
                              },
                              {
                                "type": "NULL",
                                "value": []
                              }
                            ]
                          }
                        ]
                      },
                      {
                        "type": "call",
                        "fun": "<-",
                        "args": [
                          {
                            "type": "name",
                            "value": "process_operations"
                          },
                          {
                            "type": "call",
                            "fun": "function",
                            "args": [
                              {
                                "type": "NULL",
                                "value": []
                              },
                              {
                                "type": "call",
                                "fun": "{",
                                "args": [
                                  {
                                    "type": "call",
                                    "fun": "if",
                                    "args": [
                                      {
                                        "type": "call",
                                        "fun": "$",
                                        "args": [
                                          {
                                            "type": "name",
                                            "value": "queue"
                                          },
                                          {
                                            "type": "name",
                                            "value": "processing"
                                          }
                                        ]
                                      },
                                      {
                                        "type": "call",
                                        "fun": "{",
                                        "args": [
                                          {
                                            "type": "call",
                                            "fun": "return",
                                            "args": [
                                              {
                                                "type": "literal",
                                                "value": false
                                              }
                                            ]
                                          }
                                        ]
                                      }
                                    ]
                                  },
                                  {
                                    "type": "call",
                                    "fun": "<-",
                                    "args": [
                                      {
                                        "type": "call",
                                        "fun": "$",
                                        "args": [
                                          {
                                            "type": "name",
                                            "value": "queue"
                                          },
                                          {
                                            "type": "name",
                                            "value": "processing"
                                          }
                                        ]
                                      },
                                      {
                                        "type": "literal",
                                        "value": true
                                      }
                                    ]
                                  },
                                  {
                                    "type": "call",
                                    "fun": "for",
                                    "args": [
                                      {
                                        "type": "name",
                                        "value": "op_id"
                                      },
                                      {
                                        "type": "call",
                                        "fun": "names",
                                        "args": [
                                          {
                                            "type": "call",
                                            "fun": "$",
                                            "args": [
                                              {
                                                "type": "name",
                                                "value": "queue"
                                              },
                                              {
                                                "type": "name",
                                                "value": "operations"
                                              }
                                            ]
                                          }
                                        ]
                                      },
                                      {
                                        "type": "call",
                                        "fun": "{",
                                        "args": [
                                          {
                                            "type": "call",
                                            "fun": "<-",
                                            "args": [
                                              {
                                                "type": "name",
                                                "value": "op"
                                              },
                                              {
                                                "type": "call",
                                                "fun": "[[",
                                                "args": [
                                                  {
                                                    "type": "call",
                                                    "fun": "$",
                                                    "args": [
                                                      {
                                                        "type": "name",
                                                        "value": "queue"
                                                      },
                                                      {
                                                        "type": "name",
                                                        "value": "operations"
                                                      }
                                                    ]
                                                  },
                                                  {
                                                    "type": "name",
                                                    "value": "op_id"
                                                  }
                                                ]
                                              }
                                            ]
                                          },
                                          {
                                            "type": "call",
                                            "fun": "if",
                                            "args": [
                                              {
                                                "type": "call",
                                                "fun": "==",
                                                "args": [
                                                  {
                                                    "type": "call",
                                                    "fun": "$",
                                                    "args": [
                                                      {
                                                        "type": "name",
                                                        "value": "op"
                                                      },
                                                      {
                                                        "type": "name",
                                                        "value": "status"
                                                      }
                                                    ]
                                                  },
                                                  {
                                                    "type": "literal",
                                                    "value": "pending"
                                                  }
                                                ]
                                              },
                                              {
                                                "type": "call",
                                                "fun": "{",
                                                "args": [
                                                  {
                                                    "type": "call",
                                                    "fun": "<-",
                                                    "args": [
                                                      {
                                                        "type": "call",
                                                        "fun": "$",
                                                        "args": [
                                                          {
                                                            "type": "call",
                                                            "fun": "[[",
                                                            "args": [
                                                              {
                                                                "type": "call",
                                                                "fun": "$",
                                                                "args": [
                                                                  {
                                                                    "type": "name",
                                                                    "value": "queue"
                                                                  },
                                                                  {
                                                                    "type": "name",
                                                                    "value": "operations"
                                                                  }
                                                                ]
                                                              },
                                                              {
                                                                "type": "name",
                                                                "value": "op_id"
                                                              }
                                                            ]
                                                          },
                                                          {
                                                            "type": "name",
                                                            "value": "status"
                                                          }
                                                        ]
                                                      },
                                                      {
                                                        "type": "literal",
                                                        "value": "processing"
                                                      }
                                                    ]
                                                  },
                                                  {
                                                    "type": "call",
                                                    "fun": "Sys.sleep",
                                                    "args": [
                                                      {
                                                        "type": "literal",
                                                        "value": 0.01
                                                      }
                                                    ]
                                                  },
                                                  {
                                                    "type": "call",
                                                    "fun": "<-",
                                                    "args": [
                                                      {
                                                        "type": "call",
                                                        "fun": "$",
                                                        "args": [
                                                          {
                                                            "type": "call",
                                                            "fun": "[[",
                                                            "args": [
                                                              {
                                                                "type": "call",
                                                                "fun": "$",
                                                                "args": [
                                                                  {
                                                                    "type": "name",
                                                                    "value": "queue"
                                                                  },
                                                                  {
                                                                    "type": "name",
                                                                    "value": "operations"
                                                                  }
                                                                ]
                                                              },
                                                              {
                                                                "type": "name",
                                                                "value": "op_id"
                                                              }
                                                            ]
                                                          },
                                                          {
                                                            "type": "name",
                                                            "value": "status"
                                                          }
                                                        ]
                                                      },
                                                      {
                                                        "type": "literal",
                                                        "value": "complete"
                                                      }
                                                    ]
                                                  },
                                                  {
                                                    "type": "call",
                                                    "fun": "<-",
                                                    "args": [
                                                      {
                                                        "type": "call",
                                                        "fun": "$",
                                                        "args": [
                                                          {
                                                            "type": "call",
                                                            "fun": "[[",
                                                            "args": [
                                                              {
                                                                "type": "call",
                                                                "fun": "$",
                                                                "args": [
                                                                  {
                                                                    "type": "name",
                                                                    "value": "queue"
                                                                  },
                                                                  {
                                                                    "type": "name",
                                                                    "value": "operations"
                                                                  }
                                                                ]
                                                              },
                                                              {
                                                                "type": "name",
                                                                "value": "op_id"
                                                              }
                                                            ]
                                                          },
                                                          {
                                                            "type": "name",
                                                            "value": "completed_at"
                                                          }
                                                        ]
                                                      },
                                                      {
                                                        "type": "call",
                                                        "fun": "Sys.time",
                                                        "args": []
                                                      }
                                                    ]
                                                  }
                                                ]
                                              }
                                            ]
                                          }
                                        ]
                                      }
                                    ]
                                  },
                                  {
                                    "type": "call",
                                    "fun": "<-",
                                    "args": [
                                      {
                                        "type": "call",
                                        "fun": "$",
                                        "args": [
                                          {
                                            "type": "name",
                                            "value": "queue"
                                          },
                                          {
                                            "type": "name",
                                            "value": "processing"
                                          }
                                        ]
                                      },
                                      {
                                        "type": "literal",
                                        "value": false
                                      }
                                    ]
                                  },
                                  {
                                    "type": "call",
                                    "fun": "return",
                                    "args": [
                                      {
                                        "type": "literal",
                                        "value": true
                                      }
                                    ]
                                  }
                                ]
                              },
                              {
                                "type": "NULL",
                                "value": []
                              }
                            ]
                          }
                        ]
                      },
                      {
                        "type": "call",
                        "fun": "<-",
                        "args": [
                          {
                            "type": "name",
                            "value": "get_status"
                          },
                          {
                            "type": "call",
                            "fun": "function",
                            "args": [
                              {
                                "type": "pairlist",
                                "value": ""
                              },
                              {
                                "type": "call",
                                "fun": "{",
                                "args": [
                                  {
                                    "type": "call",
                                    "fun": "if",
                                    "args": [
                                      {
                                        "type": "call",
                                        "fun": "!",
                                        "args": [
                                          {
                                            "type": "call",
                                            "fun": "%in%",
                                            "args": [
                                              {
                                                "type": "name",
                                                "value": "op_id"
                                              },
                                              {
                                                "type": "call",
                                                "fun": "names",
                                                "args": [
                                                  {
                                                    "type": "call",
                                                    "fun": "$",
                                                    "args": [
                                                      {
                                                        "type": "name",
                                                        "value": "queue"
                                                      },
                                                      {
                                                        "type": "name",
                                                        "value": "operations"
                                                      }
                                                    ]
                                                  }
                                                ]
                                              }
                                            ]
                                          }
                                        ]
                                      },
                                      {
                                        "type": "call",
                                        "fun": "{",
                                        "args": [
                                          {
                                            "type": "call",
                                            "fun": "return",
                                            "args": [
                                              {
                                                "type": "NULL",
                                                "value": []
                                              }
                                            ]
                                          }
                                        ]
                                      }
                                    ]
                                  },
                                  {
                                    "type": "call",
                                    "fun": "return",
                                    "args": [
                                      {
                                        "type": "call",
                                        "fun": "$",
                                        "args": [
                                          {
                                            "type": "call",
                                            "fun": "[[",
                                            "args": [
                                              {
                                                "type": "call",
                                                "fun": "$",
                                                "args": [
                                                  {
                                                    "type": "name",
                                                    "value": "queue"
                                                  },
                                                  {
                                                    "type": "name",
                                                    "value": "operations"
                                                  }
                                                ]
                                              },
                                              {
                                                "type": "name",
                                                "value": "op_id"
                                              }
                                            ]
                                          },
                                          {
                                            "type": "name",
                                            "value": "status"
                                          }
                                        ]
                                      }
                                    ]
                                  }
                                ]
                              },
                              {
                                "type": "NULL",
                                "value": []
                              }
                            ]
                          }
                        ]
                      },
                      {
                        "type": "call",
                        "fun": "return",
                        "args": [
                          {
                            "type": "call",
                            "fun": "list",
                            "args": {
                              "add": {
                                "type": "name",
                                "value": "add_operation"
                              },
                              "process": {
                                "type": "name",
                                "value": "process_operations"
                              },
                              "status": {
                                "type": "name",
                                "value": "get_status"
                              }
                            }
                          }
                        ]
                      }
                    ]
                  },
                  {
                    "type": "NULL",
                    "value": []
                  }
                ]
              }
            ]
          },
          {
            "type": "call",
            "fun": "<-",
            "args": [
              {
                "type": "name",
                "value": "opqueue"
              },
              {
                "type": "call",
                "fun": "create_operation_queue",
                "args": []
              }
            ]
          },
          {
            "type": "call",
            "fun": "<-",
            "args": [
              {
                "type": "name",
                "value": "op1"
              },
              {
                "type": "call",
                "fun": ["$", "opqueue", "add"],
                "args": [
                  {
                    "type": "literal",
                    "value": "user1"
                  },
                  {
                    "type": "literal",
                    "value": "simulation"
                  },
                  {
                    "type": "call",
                    "fun": "list",
                    "args": {
                      "model": {
                        "type": "literal",
                        "value": "1C"
                      }
                    }
                  }
                ]
              }
            ]
          },
          {
            "type": "call",
            "fun": "<-",
            "args": [
              {
                "type": "name",
                "value": "op2"
              },
              {
                "type": "call",
                "fun": ["$", "opqueue", "add"],
                "args": [
                  {
                    "type": "literal",
                    "value": "user2"
                  },
                  {
                    "type": "literal",
                    "value": "analysis"
                  },
                  {
                    "type": "call",
                    "fun": "list",
                    "args": {
                      "type": {
                        "type": "literal",
                        "value": "AUC"
                      }
                    }
                  }
                ]
              }
            ]
          },
          {
            "type": "call",
            "fun": "<-",
            "args": [
              {
                "type": "name",
                "value": "op3"
              },
              {
                "type": "call",
                "fun": ["$", "opqueue", "add"],
                "args": [
                  {
                    "type": "literal",
                    "value": "user1"
                  },
                  {
                    "type": "literal",
                    "value": "export"
                  },
                  {
                    "type": "call",
                    "fun": "list",
                    "args": {
                      "format": {
                        "type": "literal",
                        "value": "csv"
                      }
                    }
                  }
                ]
              }
            ]
          },
          {
            "type": "call",
            "fun": "expect_equal",
            "args": [
              {
                "type": "call",
                "fun": ["$", "opqueue", "status"],
                "args": [
                  {
                    "type": "name",
                    "value": "op1"
                  }
                ]
              },
              {
                "type": "literal",
                "value": "pending"
              }
            ]
          },
          {
            "type": "call",
            "fun": "expect_equal",
            "args": [
              {
                "type": "call",
                "fun": ["$", "opqueue", "status"],
                "args": [
                  {
                    "type": "name",
                    "value": "op2"
                  }
                ]
              },
              {
                "type": "literal",
                "value": "pending"
              }
            ]
          },
          {
            "type": "call",
            "fun": "expect_equal",
            "args": [
              {
                "type": "call",
                "fun": ["$", "opqueue", "status"],
                "args": [
                  {
                    "type": "name",
                    "value": "op3"
                  }
                ]
              },
              {
                "type": "literal",
                "value": "pending"
              }
            ]
          },
          {
            "type": "call",
            "fun": "<-",
            "args": [
              {
                "type": "name",
                "value": "success"
              },
              {
                "type": "call",
                "fun": ["$", "opqueue", "process"],
                "args": []
              }
            ]
          },
          {
            "type": "call",
            "fun": "expect_true",
            "args": [
              {
                "type": "name",
                "value": "success"
              }
            ]
          },
          {
            "type": "call",
            "fun": "expect_equal",
            "args": [
              {
                "type": "call",
                "fun": ["$", "opqueue", "status"],
                "args": [
                  {
                    "type": "name",
                    "value": "op1"
                  }
                ]
              },
              {
                "type": "literal",
                "value": "complete"
              }
            ]
          },
          {
            "type": "call",
            "fun": "expect_equal",
            "args": [
              {
                "type": "call",
                "fun": ["$", "opqueue", "status"],
                "args": [
                  {
                    "type": "name",
                    "value": "op2"
                  }
                ]
              },
              {
                "type": "literal",
                "value": "complete"
              }
            ]
          },
          {
            "type": "call",
            "fun": "expect_equal",
            "args": [
              {
                "type": "call",
                "fun": ["$", "opqueue", "status"],
                "args": [
                  {
                    "type": "name",
                    "value": "op3"
                  }
                ]
              },
              {
                "type": "literal",
                "value": "complete"
              }
            ]
          }
        ]
      }
    ]
  },
  {
    "type": "call",
    "fun": "test_that",
    "args": [
      {
        "type": "literal",
        "value": "Application logging captures all critical events"
      },
      {
        "type": "call",
        "fun": "{",
        "args": [
          {
            "type": "call",
            "fun": "<-",
            "args": [
              {
                "type": "name",
                "value": "create_logger"
              },
              {
                "type": "call",
                "fun": "function",
                "args": [
                  {
                    "type": "pairlist",
                    "value": "NULL"
                  },
                  {
                    "type": "call",
                    "fun": "{",
                    "args": [
                      {
                        "type": "call",
                        "fun": "<-",
                        "args": [
                          {
                            "type": "name",
                            "value": "logs"
                          },
                          {
                            "type": "call",
                            "fun": "list",
                            "args": []
                          }
                        ]
                      },
                      {
                        "type": "call",
                        "fun": "<-",
                        "args": [
                          {
                            "type": "name",
                            "value": "log_event"
                          },
                          {
                            "type": "call",
                            "fun": "function",
                            "args": [
                              {
                                "type": "pairlist",
                                "value": ["", "", "NULL"]
                              },
                              {
                                "type": "call",
                                "fun": "{",
                                "args": [
                                  {
                                    "type": "call",
                                    "fun": "<-",
                                    "args": [
                                      {
                                        "type": "name",
                                        "value": "log_entry"
                                      },
                                      {
                                        "type": "call",
                                        "fun": "list",
                                        "args": {
                                          "timestamp": {
                                            "type": "call",
                                            "fun": "Sys.time",
                                            "args": []
                                          },
                                          "level": {
                                            "type": "name",
                                            "value": "level"
                                          },
                                          "message": {
                                            "type": "name",
                                            "value": "message"
                                          },
                                          "data": {
                                            "type": "name",
                                            "value": "data"
                                          }
                                        }
                                      }
                                    ]
                                  },
                                  {
                                    "type": "call",
                                    "fun": "<<-",
                                    "args": [
                                      {
                                        "type": "name",
                                        "value": "logs"
                                      },
                                      {
                                        "type": "call",
                                        "fun": "append",
                                        "args": [
                                          {
                                            "type": "name",
                                            "value": "logs"
                                          },
                                          {
                                            "type": "call",
                                            "fun": "list",
                                            "args": [
                                              {
                                                "type": "name",
                                                "value": "log_entry"
                                              }
                                            ]
                                          }
                                        ]
                                      }
                                    ]
                                  },
                                  {
                                    "type": "call",
                                    "fun": "if",
                                    "args": [
                                      {
                                        "type": "call",
                                        "fun": "!",
                                        "args": [
                                          {
                                            "type": "call",
                                            "fun": "is.null",
                                            "args": [
                                              {
                                                "type": "name",
                                                "value": "log_file"
                                              }
                                            ]
                                          }
                                        ]
                                      },
                                      {
                                        "type": "call",
                                        "fun": "{",
                                        "args": [
                                          {
                                            "type": "call",
                                            "fun": "<-",
                                            "args": [
                                              {
                                                "type": "name",
                                                "value": "log_line"
                                              },
                                              {
                                                "type": "call",
                                                "fun": "sprintf",
                                                "args": [
                                                  {
                                                    "type": "literal",
                                                    "value": "[%s] %s: %s"
                                                  },
                                                  {
                                                    "type": "call",
                                                    "fun": "format",
                                                    "args": [
                                                      {
                                                        "type": "call",
                                                        "fun": "$",
                                                        "args": [
                                                          {
                                                            "type": "name",
                                                            "value": "log_entry"
                                                          },
                                                          {
                                                            "type": "name",
                                                            "value": "timestamp"
                                                          }
                                                        ]
                                                      },
                                                      {
                                                        "type": "literal",
                                                        "value": "%Y-%m-%d %H:%M:%S"
                                                      }
                                                    ]
                                                  },
                                                  {
                                                    "type": "call",
                                                    "fun": "toupper",
                                                    "args": [
                                                      {
                                                        "type": "name",
                                                        "value": "level"
                                                      }
                                                    ]
                                                  },
                                                  {
                                                    "type": "name",
                                                    "value": "message"
                                                  }
                                                ]
                                              }
                                            ]
                                          }
                                        ]
                                      }
                                    ]
                                  },
                                  {
                                    "type": "call",
                                    "fun": "return",
                                    "args": [
                                      {
                                        "type": "literal",
                                        "value": true
                                      }
                                    ]
                                  }
                                ]
                              },
                              {
                                "type": "NULL",
                                "value": []
                              }
                            ]
                          }
                        ]
                      },
                      {
                        "type": "call",
                        "fun": "<-",
                        "args": [
                          {
                            "type": "name",
                            "value": "get_logs"
                          },
                          {
                            "type": "call",
                            "fun": "function",
                            "args": [
                              {
                                "type": "pairlist",
                                "value": ["NULL", "NULL"]
                              },
                              {
                                "type": "call",
                                "fun": "{",
                                "args": [
                                  {
                                    "type": "call",
                                    "fun": "<-",
                                    "args": [
                                      {
                                        "type": "name",
                                        "value": "filtered_logs"
                                      },
                                      {
                                        "type": "name",
                                        "value": "logs"
                                      }
                                    ]
                                  },
                                  {
                                    "type": "call",
                                    "fun": "if",
                                    "args": [
                                      {
                                        "type": "call",
                                        "fun": "!",
                                        "args": [
                                          {
                                            "type": "call",
                                            "fun": "is.null",
                                            "args": [
                                              {
                                                "type": "name",
                                                "value": "level"
                                              }
                                            ]
                                          }
                                        ]
                                      },
                                      {
                                        "type": "call",
                                        "fun": "{",
                                        "args": [
                                          {
                                            "type": "call",
                                            "fun": "<-",
                                            "args": [
                                              {
                                                "type": "name",
                                                "value": "filtered_logs"
                                              },
                                              {
                                                "type": "call",
                                                "fun": "Filter",
                                                "args": [
                                                  {
                                                    "type": "call",
                                                    "fun": "function",
                                                    "args": [
                                                      {
                                                        "type": "pairlist",
                                                        "value": ""
                                                      },
                                                      {
                                                        "type": "call",
                                                        "fun": "==",
                                                        "args": [
                                                          {
                                                            "type": "call",
                                                            "fun": "$",
                                                            "args": [
                                                              {
                                                                "type": "name",
                                                                "value": "x"
                                                              },
                                                              {
                                                                "type": "name",
                                                                "value": "level"
                                                              }
                                                            ]
                                                          },
                                                          {
                                                            "type": "name",
                                                            "value": "level"
                                                          }
                                                        ]
                                                      },
                                                      {
                                                        "type": "NULL",
                                                        "value": []
                                                      }
                                                    ]
                                                  },
                                                  {
                                                    "type": "name",
                                                    "value": "filtered_logs"
                                                  }
                                                ]
                                              }
                                            ]
                                          }
                                        ]
                                      }
                                    ]
                                  },
                                  {
                                    "type": "call",
                                    "fun": "if",
                                    "args": [
                                      {
                                        "type": "call",
                                        "fun": "!",
                                        "args": [
                                          {
                                            "type": "call",
                                            "fun": "is.null",
                                            "args": [
                                              {
                                                "type": "name",
                                                "value": "since"
                                              }
                                            ]
                                          }
                                        ]
                                      },
                                      {
                                        "type": "call",
                                        "fun": "{",
                                        "args": [
                                          {
                                            "type": "call",
                                            "fun": "<-",
                                            "args": [
                                              {
                                                "type": "name",
                                                "value": "filtered_logs"
                                              },
                                              {
                                                "type": "call",
                                                "fun": "Filter",
                                                "args": [
                                                  {
                                                    "type": "call",
                                                    "fun": "function",
                                                    "args": [
                                                      {
                                                        "type": "pairlist",
                                                        "value": ""
                                                      },
                                                      {
                                                        "type": "call",
                                                        "fun": ">=",
                                                        "args": [
                                                          {
                                                            "type": "call",
                                                            "fun": "$",
                                                            "args": [
                                                              {
                                                                "type": "name",
                                                                "value": "x"
                                                              },
                                                              {
                                                                "type": "name",
                                                                "value": "timestamp"
                                                              }
                                                            ]
                                                          },
                                                          {
                                                            "type": "name",
                                                            "value": "since"
                                                          }
                                                        ]
                                                      },
                                                      {
                                                        "type": "NULL",
                                                        "value": []
                                                      }
                                                    ]
                                                  },
                                                  {
                                                    "type": "name",
                                                    "value": "filtered_logs"
                                                  }
                                                ]
                                              }
                                            ]
                                          }
                                        ]
                                      }
                                    ]
                                  },
                                  {
                                    "type": "call",
                                    "fun": "return",
                                    "args": [
                                      {
                                        "type": "name",
                                        "value": "filtered_logs"
                                      }
                                    ]
                                  }
                                ]
                              },
                              {
                                "type": "NULL",
                                "value": []
                              }
                            ]
                          }
                        ]
                      },
                      {
                        "type": "call",
                        "fun": "<-",
                        "args": [
                          {
                            "type": "name",
                            "value": "clear_logs"
                          },
                          {
                            "type": "call",
                            "fun": "function",
                            "args": [
                              {
                                "type": "NULL",
                                "value": []
                              },
                              {
                                "type": "call",
                                "fun": "{",
                                "args": [
                                  {
                                    "type": "call",
                                    "fun": "<<-",
                                    "args": [
                                      {
                                        "type": "name",
                                        "value": "logs"
                                      },
                                      {
                                        "type": "call",
                                        "fun": "list",
                                        "args": []
                                      }
                                    ]
                                  }
                                ]
                              },
                              {
                                "type": "NULL",
                                "value": []
                              }
                            ]
                          }
                        ]
                      },
                      {
                        "type": "call",
                        "fun": "return",
                        "args": [
                          {
                            "type": "call",
                            "fun": "list",
                            "args": {
                              "log": {
                                "type": "name",
                                "value": "log_event"
                              },
                              "get": {
                                "type": "name",
                                "value": "get_logs"
                              },
                              "clear": {
                                "type": "name",
                                "value": "clear_logs"
                              }
                            }
                          }
                        ]
                      }
                    ]
                  },
                  {
                    "type": "NULL",
                    "value": []
                  }
                ]
              }
            ]
          },
          {
            "type": "call",
            "fun": "<-",
            "args": [
              {
                "type": "name",
                "value": "logger"
              },
              {
                "type": "call",
                "fun": "create_logger",
                "args": []
              }
            ]
          },
          {
            "type": "call",
            "fun": ["$", "logger", "log"],
            "args": [
              {
                "type": "literal",
                "value": "info"
              },
              {
                "type": "literal",
                "value": "Application started"
              }
            ]
          },
          {
            "type": "call",
            "fun": ["$", "logger", "log"],
            "args": [
              {
                "type": "literal",
                "value": "debug"
              },
              {
                "type": "literal",
                "value": "Loading configuration"
              },
              {
                "type": "call",
                "fun": "list",
                "args": {
                  "config_file": {
                    "type": "literal",
                    "value": "config.yml"
                  }
                }
              }
            ]
          },
          {
            "type": "call",
            "fun": ["$", "logger", "log"],
            "args": [
              {
                "type": "literal",
                "value": "warning"
              },
              {
                "type": "literal",
                "value": "High memory usage"
              },
              {
                "type": "call",
                "fun": "list",
                "args": {
                  "used_mb": {
                    "type": "literal",
                    "value": 512
                  }
                }
              }
            ]
          },
          {
            "type": "call",
            "fun": ["$", "logger", "log"],
            "args": [
              {
                "type": "literal",
                "value": "error"
              },
              {
                "type": "literal",
                "value": "Database connection failed"
              },
              {
                "type": "call",
                "fun": "list",
                "args": {
                  "error": {
                    "type": "literal",
                    "value": "timeout"
                  }
                }
              }
            ]
          },
          {
            "type": "call",
            "fun": "<-",
            "args": [
              {
                "type": "name",
                "value": "all_logs"
              },
              {
                "type": "call",
                "fun": ["$", "logger", "get"],
                "args": []
              }
            ]
          },
          {
            "type": "call",
            "fun": "expect_equal",
            "args": [
              {
                "type": "call",
                "fun": "length",
                "args": [
                  {
                    "type": "name",
                    "value": "all_logs"
                  }
                ]
              },
              {
                "type": "literal",
                "value": 4
              }
            ]
          },
          {
            "type": "call",
            "fun": "<-",
            "args": [
              {
                "type": "name",
                "value": "error_logs"
              },
              {
                "type": "call",
                "fun": ["$", "logger", "get"],
                "args": {
                  "level": {
                    "type": "literal",
                    "value": "error"
                  }
                }
              }
            ]
          },
          {
            "type": "call",
            "fun": "expect_equal",
            "args": [
              {
                "type": "call",
                "fun": "length",
                "args": [
                  {
                    "type": "name",
                    "value": "error_logs"
                  }
                ]
              },
              {
                "type": "literal",
                "value": 1
              }
            ]
          },
          {
            "type": "call",
            "fun": "expect_equal",
            "args": [
              {
                "type": "call",
                "fun": "$",
                "args": [
                  {
                    "type": "call",
                    "fun": "[[",
                    "args": [
                      {
                        "type": "name",
                        "value": "error_logs"
                      },
                      {
                        "type": "literal",
                        "value": 1
                      }
                    ]
                  },
                  {
                    "type": "name",
                    "value": "message"
                  }
                ]
              },
              {
                "type": "literal",
                "value": "Database connection failed"
              }
            ]
          },
          {
            "type": "call",
            "fun": "<-",
            "args": [
              {
                "type": "name",
                "value": "recent_time"
              },
              {
                "type": "call",
                "fun": "-",
                "args": [
                  {
                    "type": "call",
                    "fun": "Sys.time",
                    "args": []
                  },
                  {
                    "type": "literal",
                    "value": 60
                  }
                ]
              }
            ]
          },
          {
            "type": "call",
            "fun": "<-",
            "args": [
              {
                "type": "name",
                "value": "recent_logs"
              },
              {
                "type": "call",
                "fun": ["$", "logger", "get"],
                "args": {
                  "since": {
                    "type": "name",
                    "value": "recent_time"
                  }
                }
              }
            ]
          },
          {
            "type": "call",
            "fun": "expect_equal",
            "args": [
              {
                "type": "call",
                "fun": "length",
                "args": [
                  {
                    "type": "name",
                    "value": "recent_logs"
                  }
                ]
              },
              {
                "type": "literal",
                "value": 4
              }
            ]
          },
          {
            "type": "call",
            "fun": ["$", "logger", "clear"],
            "args": []
          },
          {
            "type": "call",
            "fun": "expect_equal",
            "args": [
              {
                "type": "call",
                "fun": "length",
                "args": [
                  {
                    "type": "call",
                    "fun": ["$", "logger", "get"],
                    "args": []
                  }
                ]
              },
              {
                "type": "literal",
                "value": 0
              }
            ]
          }
        ]
      }
    ]
  }
]
